/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/monaco-editor@0.33.0/esm/vs/editor/contrib/folding/browser/indentRangeProvider.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{computeIndentLevel}from"../../../common/model/utils.js";import{FoldingRegions,MAX_LINE_NUMBER}from"./foldingRanges.js";const MAX_FOLDING_REGIONS_FOR_INDENT_DEFAULT=5e3;export const ID_INDENT_PROVIDER="indent";export class IndentRangeProvider{constructor(e,n,t){this.editorModel=e,this.languageConfigurationService=n,this.maxFoldingRegions=t,this.id="indent"}dispose(){}compute(e,n){let t=this.languageConfigurationService.getLanguageConfiguration(this.editorModel.getLanguageId()).foldingRules,i=t&&!!t.offSide,s=t&&t.markers;return Promise.resolve(computeRanges(this.editorModel,i,s,this.maxFoldingRegions,n))}}export class RangesCollector{constructor(e,n){this._notifyTooManyRegions=n,this._startIndexes=[],this._endIndexes=[],this._indentOccurrences=[],this._length=0,this._foldingRangesLimit=e}insertFirst(e,n,t){if(e>MAX_LINE_NUMBER||n>MAX_LINE_NUMBER)return;let i=this._length;this._startIndexes[i]=e,this._endIndexes[i]=n,this._length++,t<1e3&&(this._indentOccurrences[t]=(this._indentOccurrences[t]||0)+1)}toIndentRanges(e){if(this._length<=this._foldingRangesLimit){let e=new Uint32Array(this._length),n=new Uint32Array(this._length);for(let t=this._length-1,i=0;t>=0;t--,i++)e[i]=this._startIndexes[t],n[i]=this._endIndexes[t];return new FoldingRegions(e,n)}{this._notifyTooManyRegions&&this._notifyTooManyRegions(this._foldingRangesLimit);let n=0,t=this._indentOccurrences.length;for(let e=0;e<this._indentOccurrences.length;e++){let i=this._indentOccurrences[e];if(i){if(i+n>this._foldingRangesLimit){t=e;break}n+=i}}const i=e.getOptions().tabSize;let s=new Uint32Array(this._foldingRangesLimit),o=new Uint32Array(this._foldingRangesLimit);for(let r=this._length-1,g=0;r>=0;r--){let l=this._startIndexes[r],d=e.getLineContent(l),h=computeIndentLevel(d,i);(h<t||h===t&&n++<this._foldingRangesLimit)&&(s[g]=l,o[g]=this._endIndexes[r],g++)}return new FoldingRegions(s,o)}}}export function computeRanges(e,n,t,i,s){const o=e.getOptions().tabSize;let r,g=new RangesCollector(i=null!=i?i:5e3,s);t&&(r=new RegExp(`(${t.start.source})|(?:${t.end.source})`));let l=[],d=e.getLineCount()+1;l.push({indent:-1,endAbove:d,line:d});for(let t=e.getLineCount();t>0;t--){let i,s=e.getLineContent(t),d=computeIndentLevel(s,o),h=l[l.length-1];if(-1!==d){if(r&&(i=s.match(r))){if(!i[1]){l.push({indent:-2,endAbove:t,line:t});continue}{let e=l.length-1;for(;e>0&&-2!==l[e].indent;)e--;if(e>0){l.length=e+1,h=l[e],g.insertFirst(t,h.line,d),h.line=t,h.indent=d,h.endAbove=t;continue}}}if(h.indent>d){do{l.pop(),h=l[l.length-1]}while(h.indent>d);let e=h.endAbove-1;e-t>=1&&g.insertFirst(t,e,d)}h.indent===d?h.endAbove=t:l.push({indent:d,endAbove:t,line:t})}else n&&(h.endAbove=t)}return g.toIndentRanges(e)}
//# sourceMappingURL=/sm/caba6fd6b0f6bffa82da7aa068705aa4bae8aa031c175afd257c0dc1fae175cb.map