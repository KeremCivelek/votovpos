/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/monaco-editor@0.33.0/esm/vs/editor/contrib/codeAction/browser/codeAction.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __awaiter=this&&this.__awaiter||function(o,e,t,n){return new(t||(t=Promise))((function(i,r){function c(o){try{a(n.next(o))}catch(o){r(o)}}function s(o){try{a(n.throw(o))}catch(o){r(o)}}function a(o){var e;o.done?i(o.value):(e=o.value,e instanceof t?e:new t((function(o){o(e)}))).then(c,s)}a((n=n.apply(o,e||[])).next())}))};import{coalesce,equals,flatten,isNonEmptyArray}from"../../../../base/common/arrays.js";import{CancellationToken}from"../../../../base/common/cancellation.js";import{illegalArgument,isCancellationError,onUnexpectedExternalError}from"../../../../base/common/errors.js";import{Disposable,DisposableStore}from"../../../../base/common/lifecycle.js";import{URI}from"../../../../base/common/uri.js";import{TextModelCancellationTokenSource}from"../../editorState/browser/editorState.js";import{Range}from"../../../common/core/range.js";import{Selection}from"../../../common/core/selection.js";import{IModelService}from"../../../common/services/model.js";import{CommandsRegistry}from"../../../../platform/commands/common/commands.js";import{Progress}from"../../../../platform/progress/common/progress.js";import{CodeActionKind,filtersAction,mayIncludeActionsOfKind}from"./types.js";import{ILanguageFeaturesService}from"../../../common/services/languageFeatures.js";export const codeActionCommandId="editor.action.codeAction";export const refactorCommandId="editor.action.refactor";export const sourceActionCommandId="editor.action.sourceAction";export const organizeImportsCommandId="editor.action.organizeImports";export const fixAllCommandId="editor.action.fixAll";export class CodeActionItem{constructor(o,e){this.action=o,this.provider=e}resolve(o){var e;return __awaiter(this,void 0,void 0,(function*(){if((null===(e=this.provider)||void 0===e?void 0:e.resolveCodeAction)&&!this.action.edit){let e;try{e=yield this.provider.resolveCodeAction(this.action,o)}catch(o){onUnexpectedExternalError(o)}e&&(this.action.edit=e.edit)}return this}))}}class ManagedCodeActionSet extends Disposable{constructor(o,e,t){super(),this.documentation=e,this._register(t),this.allActions=[...o].sort(ManagedCodeActionSet.codeActionsComparator),this.validActions=this.allActions.filter((({action:o})=>!o.disabled))}static codeActionsComparator({action:o},{action:e}){return o.isPreferred&&!e.isPreferred?-1:!o.isPreferred&&e.isPreferred?1:isNonEmptyArray(o.diagnostics)?isNonEmptyArray(e.diagnostics)?o.diagnostics[0].message.localeCompare(e.diagnostics[0].message):-1:isNonEmptyArray(e.diagnostics)?1:0}get hasAutoFix(){return this.validActions.some((({action:o})=>!!o.kind&&CodeActionKind.QuickFix.contains(new CodeActionKind(o.kind))&&!!o.isPreferred))}}const emptyCodeActionsResponse={actions:[],documentation:void 0};export function getCodeActions(o,e,t,n,i,r){var c;const s=n.filter||{},a={only:null===(c=s.include)||void 0===c?void 0:c.value,trigger:n.type},d=new TextModelCancellationTokenSource(e,r),l=getCodeActionProviders(o,e,s),m=new DisposableStore,u=l.map((o=>__awaiter(this,void 0,void 0,(function*(){try{i.report(o);const n=yield o.provideCodeActions(e,t,a,d.token);if(n&&m.add(n),d.token.isCancellationRequested)return emptyCodeActionsResponse;const r=((null==n?void 0:n.actions)||[]).filter((o=>o&&filtersAction(s,o))),c=getDocumentation(o,r,s.include);return{actions:r.map((e=>new CodeActionItem(e,o))),documentation:c}}catch(o){if(isCancellationError(o))throw o;return onUnexpectedExternalError(o),emptyCodeActionsResponse}})))),f=o.onDidChange((()=>{const t=o.all(e);equals(t,l)||d.cancel()}));return Promise.all(u).then((o=>{const e=flatten(o.map((o=>o.actions))),t=coalesce(o.map((o=>o.documentation)));return new ManagedCodeActionSet(e,t,m)})).finally((()=>{f.dispose(),d.dispose()}))}function getCodeActionProviders(o,e,t){return o.all(e).filter((o=>!o.providedCodeActionKinds||o.providedCodeActionKinds.some((o=>mayIncludeActionsOfKind(t,new CodeActionKind(o))))))}function getDocumentation(o,e,t){if(!o.documentation)return;const n=o.documentation.map((o=>({kind:new CodeActionKind(o.kind),command:o.command})));if(t){let o;for(const e of n)e.kind.contains(t)&&(o?o.kind.contains(e.kind)&&(o=e):o=e);if(o)return null==o?void 0:o.command}for(const o of e)if(o.kind)for(const e of n)if(e.kind.contains(new CodeActionKind(o.kind)))return e.command}CommandsRegistry.registerCommand("_executeCodeActionProvider",(function(o,e,t,n,i){return __awaiter(this,void 0,void 0,(function*(){if(!(e instanceof URI))throw illegalArgument();const{codeActionProvider:r}=o.get(ILanguageFeaturesService),c=o.get(IModelService).getModel(e);if(!c)throw illegalArgument();const s=Selection.isISelection(t)?Selection.liftSelection(t):Range.isIRange(t)?c.validateRange(t):void 0;if(!s)throw illegalArgument();const a="string"==typeof n?new CodeActionKind(n):void 0,d=yield getCodeActions(r,c,s,{type:1,filter:{includeSourceActions:!0,include:a}},Progress.None,CancellationToken.None),l=[],m=Math.min(d.validActions.length,"number"==typeof i?i:0);for(let o=0;o<m;o++)l.push(d.validActions[o].resolve(CancellationToken.None));try{return yield Promise.all(l),d.validActions.map((o=>o.action))}finally{setTimeout((()=>d.dispose()),100)}}))}));
//# sourceMappingURL=/sm/ddd8a9941de634142d20481bac3c3cf9aef4b1f945aa8480133061a0bedc50f8.map