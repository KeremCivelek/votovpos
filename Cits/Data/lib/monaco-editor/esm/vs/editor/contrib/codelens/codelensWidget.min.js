/**
 * Minified by jsDelivr using Terser v5.7.1.
 * Original file: /npm/monaco-editor@0.27.0/esm/vs/editor/contrib/codelens/codelensWidget.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import"./codelensWidget.css";import*as dom from"../../../base/browser/dom.js";import{Range}from"../../common/core/range.js";import{ModelDecorationOptions}from"../../common/model/textModel.js";import{editorCodeLensForeground}from"../../common/view/editorColorRegistry.js";import{editorActiveLinkForeground}from"../../../platform/theme/common/colorRegistry.js";import{registerThemingParticipant}from"../../../platform/theme/common/themeService.js";import{renderLabelWithIcons}from"../../../base/browser/ui/iconLabel/iconLabels.js";class CodeLensViewZone{constructor(t,e,o){this.afterLineNumber=t,this.heightInPx=e,this._onHeight=o,this.suppressMouseDown=!0,this.domNode=document.createElement("div")}onComputedHeight(t){void 0===this._lastHeight?this._lastHeight=t:this._lastHeight!==t&&(this._lastHeight=t,this._onHeight())}}class CodeLensContentWidget{constructor(t,e,o){this.allowEditorOverflow=!1,this.suppressMouseDown=!0,this._commands=new Map,this._isEmpty=!0,this._editor=t,this._id="codelens.widget-"+CodeLensContentWidget._idPool++,this.updatePosition(o),this._domNode=document.createElement("span"),this._domNode.className=`codelens-decoration ${e}`}withCommands(t,e){this._commands.clear();let o=[],i=!1;for(let e=0;e<t.length;e++){const s=t[e];if(s&&(i=!0,s.command)){const i=renderLabelWithIcons(s.command.title.trim());s.command.id?(o.push(dom.$("a",{id:String(e),title:s.command.tooltip},...i)),this._commands.set(String(e),s.command)):o.push(dom.$("span",{title:s.command.tooltip},...i)),e+1<t.length&&o.push(dom.$("span",void 0," | "))}}i?(dom.reset(this._domNode,...o),this._isEmpty&&e&&this._domNode.classList.add("fadein"),this._isEmpty=!1):dom.reset(this._domNode,dom.$("span",void 0,"no commands"))}getCommand(t){return t.parentElement===this._domNode?this._commands.get(t.id):void 0}getId(){return this._id}getDomNode(){return this._domNode}updatePosition(t){const e=this._editor.getModel().getLineFirstNonWhitespaceColumn(t);this._widgetPosition={position:{lineNumber:t,column:e},preference:[1]}}getPosition(){return this._widgetPosition||null}}CodeLensContentWidget._idPool=0;export class CodeLensHelper{constructor(){this._removeDecorations=[],this._addDecorations=[],this._addDecorationsCallbacks=[]}addDecoration(t,e){this._addDecorations.push(t),this._addDecorationsCallbacks.push(e)}removeDecoration(t){this._removeDecorations.push(t)}commit(t){let e=t.deltaDecorations(this._removeDecorations,this._addDecorations);for(let t=0,o=e.length;t<o;t++)this._addDecorationsCallbacks[t](e[t])}}export class CodeLensWidget{constructor(t,e,o,i,s,n,d){let r;this._isDisposed=!1,this._editor=e,this._className=o,this._data=t,this._decorationIds=[];let a=[];this._data.forEach(((t,e)=>{t.symbol.command&&a.push(t.symbol),i.addDecoration({range:t.symbol.range,options:ModelDecorationOptions.EMPTY},(t=>this._decorationIds[e]=t)),r=r?Range.plusRange(r,t.symbol.range):Range.lift(t.symbol.range)})),this._viewZone=new CodeLensViewZone(r.startLineNumber-1,n,d),this._viewZoneId=s.addZone(this._viewZone),a.length>0&&(this._createContentWidgetIfNecessary(),this._contentWidget.withCommands(a,!1))}_createContentWidgetIfNecessary(){this._contentWidget?this._editor.layoutContentWidget(this._contentWidget):(this._contentWidget=new CodeLensContentWidget(this._editor,this._className,this._viewZone.afterLineNumber+1),this._editor.addContentWidget(this._contentWidget))}dispose(t,e){this._decorationIds.forEach(t.removeDecoration,t),this._decorationIds=[],e&&e.removeZone(this._viewZoneId),this._contentWidget&&(this._editor.removeContentWidget(this._contentWidget),this._contentWidget=void 0),this._isDisposed=!0}isDisposed(){return this._isDisposed}isValid(){return this._decorationIds.some(((t,e)=>{const o=this._editor.getModel().getDecorationRange(t),i=this._data[e].symbol;return!(!o||Range.isEmpty(i.range)!==o.isEmpty())}))}updateCodeLensSymbols(t,e){this._decorationIds.forEach(e.removeDecoration,e),this._decorationIds=[],this._data=t,this._data.forEach(((t,o)=>{e.addDecoration({range:t.symbol.range,options:ModelDecorationOptions.EMPTY},(t=>this._decorationIds[o]=t))}))}updateHeight(t,e){this._viewZone.heightInPx=t,e.layoutZone(this._viewZoneId),this._contentWidget&&this._editor.layoutContentWidget(this._contentWidget)}computeIfNecessary(t){if(!this._viewZone.domNode.hasAttribute("monaco-visible-view-zone"))return null;for(let e=0;e<this._decorationIds.length;e++){const o=t.getDecorationRange(this._decorationIds[e]);o&&(this._data[e].symbol.range=o)}return this._data}updateCommands(t){this._createContentWidgetIfNecessary(),this._contentWidget.withCommands(t,!0);for(let e=0;e<this._data.length;e++){const o=t[e];if(o){const{symbol:t}=this._data[e];t.command=o.command||t.command}}}getCommand(t){var e;return null===(e=this._contentWidget)||void 0===e?void 0:e.getCommand(t)}getLineNumber(){const t=this._editor.getModel().getDecorationRange(this._decorationIds[0]);return t?t.startLineNumber:-1}update(t){if(this.isValid()){const e=this._editor.getModel().getDecorationRange(this._decorationIds[0]);e&&(this._viewZone.afterLineNumber=e.startLineNumber-1,t.layoutZone(this._viewZoneId),this._contentWidget&&(this._contentWidget.updatePosition(e.startLineNumber),this._editor.layoutContentWidget(this._contentWidget)))}}getItems(){return this._data}}registerThemingParticipant(((t,e)=>{const o=t.getColor(editorCodeLensForeground);o&&(e.addRule(`.monaco-editor .codelens-decoration { color: ${o}; }`),e.addRule(`.monaco-editor .codelens-decoration .codicon { color: ${o}; }`));const i=t.getColor(editorActiveLinkForeground);i&&(e.addRule(`.monaco-editor .codelens-decoration > a:hover { color: ${i} !important; }`),e.addRule(`.monaco-editor .codelens-decoration > a:hover .codicon { color: ${i} !important; }`))}));
//# sourceMappingURL=/sm/8d3871d4c6012247262e63e42bab01f8276aba541d29fec40a79a01693e4864f.map