/**
 * Minified by jsDelivr using Terser v5.7.1.
 * Original file: /npm/monaco-editor@0.27.0/esm/vs/editor/contrib/inlineCompletions/ghostTextWidget.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var _a,__decorate=this&&this.__decorate||function(e,t,o,i){var n,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,i);else for(var d=e.length-1;d>=0;d--)(n=e[d])&&(r=(s<3?n(r):s>3?n(t,o,r):n(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},__param=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};import"./ghostText.css";import*as dom from"../../../base/browser/dom.js";import{Disposable,DisposableStore,toDisposable}from"../../../base/common/lifecycle.js";import{Range}from"../../common/core/range.js";import{ICodeEditorService}from"../../browser/services/codeEditorService.js";import*as strings from"../../../base/common/strings.js";import{RenderLineInput,renderViewLine}from"../../common/viewLayout/viewLineRenderer.js";import{EditorFontLigatures}from"../../common/config/editorOptions.js";import{createStringBuilder}from"../../common/core/stringBuilder.js";import{Configuration}from"../../browser/config/configuration.js";import{LineTokens}from"../../common/core/lineTokens.js";import{Position}from"../../common/core/position.js";import{IThemeService,registerThemingParticipant}from"../../../platform/theme/common/themeService.js";import{ghostTextBorder,ghostTextForeground}from"../../common/view/editorColorRegistry.js";import{RGBA,Color}from"../../../base/common/color.js";import{CursorColumns}from"../../common/controller/cursorCommon.js";import{LineDecoration}from"../../common/viewLayout/lineDecorations.js";import{IContextKeyService}from"../../../platform/contextkey/common/contextkey.js";import{IInstantiationService}from"../../../platform/instantiation/common/instantiation.js";const ttPolicy=null===(_a=window.trustedTypes)||void 0===_a?void 0:_a.createPolicy("editorGhostText",{createHTML:e=>e});let GhostTextWidget=class extends Disposable{constructor(e,t,o){super(),this.editor=e,this.model=t,this.instantiationService=o,this.disposed=!1,this.partsWidget=this._register(this.instantiationService.createInstance(DecorationsWidget,this.editor)),this.additionalLinesWidget=this._register(new AdditionalLinesWidget(this.editor)),this.viewMoreContentWidget=void 0,this._register(this.editor.onDidChangeConfiguration((e=>{(e.hasChanged(27)||e.hasChanged(104)||e.hasChanged(87)||e.hasChanged(81)||e.hasChanged(42)||e.hasChanged(41)||e.hasChanged(57))&&this.update()}))),this._register(toDisposable((()=>{var e;this.disposed=!0,this.update(),null===(e=this.viewMoreContentWidget)||void 0===e||e.dispose(),this.viewMoreContentWidget=void 0}))),this._register(t.onDidChange((()=>{this.update()}))),this.update()}shouldShowHoverAtViewZone(e){return this.additionalLinesWidget.viewZoneId===e}update(){var e;const t=this.model.ghostText;if(!this.editor.hasModel()||!t||this.disposed)return this.partsWidget.clear(),void this.additionalLinesWidget.clear();const o=new Array,i=new Array;function n(e,t){if(i.length>0){const o=i[i.length-1];t&&o.decorations.push(new LineDecoration(o.content.length+1,o.content.length+1+e[0].length,t,0)),o.content+=e[0],e=e.slice(1)}for(const o of e)i.push({content:o,decorations:t?[new LineDecoration(1,o.length+1,t,0)]:[]})}const s=this.editor.getModel().getLineContent(t.lineNumber);let r;this.editor.getModel().getLineTokens(t.lineNumber);let d=0;for(const e of t.parts){let t=e.lines;void 0===r?(o.push({column:e.column,text:t[0]}),t=t.slice(1)):n([s.substring(d,e.column-1)],void 0),t.length>0&&(n(t,"ghost-text"),void 0===r&&e.column<=s.length&&(r=e.column)),d=e.column-1}void 0!==r&&n([s.substring(d)],void 0),this.partsWidget.setParts(t.lineNumber,o,void 0!==r?{column:r,length:s.length+1-r}:void 0),this.additionalLinesWidget.updateLines(t.lineNumber,i,t.additionalReservedLineCount),t.parts.some((e=>e.lines.length<0))?this.viewMoreContentWidget=this.renderViewMoreLines(new Position(t.lineNumber,this.editor.getModel().getLineMaxColumn(t.lineNumber)),"",0):(null===(e=this.viewMoreContentWidget)||void 0===e||e.dispose(),this.viewMoreContentWidget=void 0)}renderViewMoreLines(e,t,o){const i=this.editor.getOption(41),n=document.createElement("div");n.className="suggest-preview-additional-widget",Configuration.applyFontInfoSlow(n,i);const s=document.createElement("span");s.className="content-spacer",s.append(t),n.append(s);const r=document.createElement("span");r.className="content-newline suggest-preview-text",r.append("⏎  "),n.append(r);const d=new DisposableStore,a=document.createElement("div");return a.className="button suggest-preview-text",a.append(`+${o} lines…`),d.add(dom.addStandardDisposableListener(a,"mousedown",(e=>{var t;null===(t=this.model)||void 0===t||t.setExpanded(!0),e.preventDefault(),this.editor.focus()}))),n.append(a),new ViewMoreLinesContentWidget(this.editor,e,n,d)}};GhostTextWidget=__decorate([__param(2,IInstantiationService)],GhostTextWidget);export{GhostTextWidget};let DecorationsWidget=class{constructor(e,t,o,i){this.editor=e,this.codeEditorService=t,this.themeService=o,this.contextKeyService=i,this.decorationIds=[],this.disposableStore=new DisposableStore}dispose(){this.clear(),this.disposableStore.dispose()}clear(){this.editor.deltaDecorations(this.decorationIds,[]),this.disposableStore.clear()}setParts(e,t,o){this.disposableStore.clear();const i=this.themeService.getColorTheme(),n=i.getColor(ghostTextForeground);let s,r;n&&(s=String(n.rgba.a),r=Color.Format.CSS.format(opaque(n)));const d=i.getColor(ghostTextBorder);let a;d&&(a=`2px dashed ${d}`);const c=this.editor.getModel();if(!c)return;const{tabSize:l}=c.getOptions(),h=c.getLineContent(e)||"";let g=0,p="";const m=new Array;o&&m.push({range:Range.fromPositions(new Position(e,o.column),new Position(e,o.column+o.length)),options:{inlineClassName:"ghost-text-hidden",description:"ghost-text-hidden"}});const u=this.contextKeyService.getContextKeyValue("config.editor.useInjectedText"),v=void 0===u||!!u;this.decorationIds=this.editor.deltaDecorations(this.decorationIds,t.map((t=>{p+=h.substring(g,t.column-1),g=t.column-1;const o=v?t.text:this.renderSingleLineText(t.text,p,l,!1),i=this.disposableStore.add(registerDecorationType(this.codeEditorService,"ghost-text","0-ghost-text-",{after:{contentText:o,opacity:s,color:r,border:a}}));return{range:Range.fromPositions(new Position(e,t.column)),options:v?{description:"ghost-text",after:{content:o,inlineClassName:"ghost-text-decoration"}}:Object.assign({},i.resolve())}})).concat(m))}renderSingleLineText(e,t,o,i){const n=t+e,s=CursorColumns.visibleColumnsByColumns(n,o);let r="",d=t.length+1;for(const t of e){if("\t"===t){const e=s[d+1]-s[d];if(i){r+="→";for(let t=1;t<e;t++)r+=" "}else for(let t=0;t<e;t++)r+=" "}else r+=" "===t?i?"·":" ":t;d+=1}return r}};function opaque(e){const{r:t,b:o,g:i}=e.rgba;return new Color(new RGBA(t,i,o,255))}DecorationsWidget=__decorate([__param(1,ICodeEditorService),__param(2,IThemeService),__param(3,IContextKeyService)],DecorationsWidget);class AdditionalLinesWidget{constructor(e){this.editor=e,this._viewZoneId=void 0}get viewZoneId(){return this._viewZoneId}dispose(){this.clear()}clear(){this.editor.changeViewZones((e=>{this._viewZoneId&&(e.removeZone(this._viewZoneId),this._viewZoneId=void 0)}))}updateLines(e,t,o){const i=this.editor.getModel();if(!i)return;const{tabSize:n}=i.getOptions();this.editor.changeViewZones((i=>{this._viewZoneId&&(i.removeZone(this._viewZoneId),this._viewZoneId=void 0);const s=Math.max(t.length,o);if(s>0){const o=document.createElement("div");renderLines(o,n,t,this.editor.getOptions()),this._viewZoneId=i.addZone({afterLineNumber:e,heightInLines:s,domNode:o})}}))}}function renderLines(e,t,o,i){const n=i.get(27),s=i.get(104),r=i.get(81),d=i.get(42),a=i.get(41),c=i.get(57),l=createStringBuilder(1e4);l.appendASCIIString('<div class="suggest-preview-text">');for(let e=0,i=o.length;e<i;e++){const i=o[e],h=i.content;l.appendASCIIString('<div class="view-line'),l.appendASCIIString('" style="top:'),l.appendASCIIString(String(e*c)),l.appendASCIIString('px;width:1000000px;">');const g=strings.isBasicASCII(h),p=strings.containsRTL(h),m=LineTokens.createEmpty(h);renderViewLine(new RenderLineInput(a.isMonospace&&!n,a.canUseHalfwidthRightwardsArrow,h,!1,g,p,0,m,i.decorations,t,0,a.spaceWidth,a.middotWidth,a.wsmiddotWidth,s,"none",r,d!==EditorFontLigatures.OFF,null),l),l.appendASCIIString("</div>")}l.appendASCIIString("</div>"),Configuration.applyFontInfoSlow(e,a);const h=l.build(),g=ttPolicy?ttPolicy.createHTML(h):h;e.innerHTML=g}let keyCounter=0;function registerDecorationType(e,t,o,i){const n=o+keyCounter++;return e.registerDecorationType(t,n,i),{dispose(){e.removeDecorationType(n)},resolve:()=>e.resolveDecorationOptions(n,!0)}}class ViewMoreLinesContentWidget extends Disposable{constructor(e,t,o,i){super(),this.editor=e,this.position=t,this.domNode=o,this.allowEditorOverflow=!1,this.suppressMouseDown=!1,this._register(i),this._register(toDisposable((()=>{this.editor.removeContentWidget(this)}))),this.editor.addContentWidget(this)}getId(){return"editor.widget.viewMoreLinesWidget"}getDomNode(){return this.domNode}getPosition(){return{position:this.position,preference:[0]}}}registerThemingParticipant(((e,t)=>{const o=e.getColor(ghostTextForeground);if(o){const e=String(o.rgba.a),i=Color.Format.CSS.format(opaque(o));t.addRule(`.monaco-editor .ghost-text-decoration { opacity: ${e}; color: ${i}; }`),t.addRule(`.monaco-editor .suggest-preview-text .ghost-text { opacity: ${e}; color: ${i}; }`)}const i=e.getColor(ghostTextBorder);i&&t.addRule(`.monaco-editor .suggest-preview-text .ghost-text { border: 2px dashed ${i}; }`)}));
//# sourceMappingURL=/sm/27697ef178d3abc39817fb190ad51c82c6b6507bb11e91b6718ce4cd733a5d71.map