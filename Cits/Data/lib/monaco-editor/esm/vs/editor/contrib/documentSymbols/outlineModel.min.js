/**
 * Minified by jsDelivr using Terser v5.7.1.
 * Original file: /npm/monaco-editor@0.27.0/esm/vs/editor/contrib/documentSymbols/outlineModel.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{equals}from"../../../base/common/arrays.js";import{CancellationTokenSource}from"../../../base/common/cancellation.js";import{onUnexpectedExternalError}from"../../../base/common/errors.js";import{LRUCache}from"../../../base/common/map.js";import{Range}from"../../common/core/range.js";import{DocumentSymbolProviderRegistry}from"../../common/modes.js";import{Iterable}from"../../../base/common/iterator.js";import{LanguageFeatureRequestDelays}from"../../common/modes/languageFeatureRegistry.js";export class TreeElement{remove(){this.parent&&this.parent.children.delete(this.id)}static findId(e,t){let n;"string"==typeof e?n=`${t.id}/${e}`:(n=`${t.id}/${e.name}`,void 0!==t.children.get(n)&&(n=`${t.id}/${e.name}_${e.range.startLineNumber}_${e.range.startColumn}`));let r=n;for(let e=0;void 0!==t.children.get(r);e++)r=`${n}_${e}`;return r}static empty(e){return 0===e.children.size}}export class OutlineElement extends TreeElement{constructor(e,t,n){super(),this.id=e,this.parent=t,this.symbol=n,this.children=new Map}}export class OutlineGroup extends TreeElement{constructor(e,t,n,r){super(),this.id=e,this.parent=t,this.label=n,this.order=r,this.children=new Map}}export class OutlineModel extends TreeElement{constructor(e){super(),this.uri=e,this.id="root",this.parent=void 0,this._groups=new Map,this.children=new Map,this.id="root",this.parent=void 0}static create(e,t){let n=this._keys.for(e,!0),r=OutlineModel._requests.get(n);if(!r){let t=new CancellationTokenSource;r={promiseCnt:0,source:t,promise:OutlineModel._create(e,t.token),model:void 0},OutlineModel._requests.set(n,r);const o=Date.now();r.promise.then((()=>{this._requestDurations.update(e,Date.now()-o)}))}return r.model?Promise.resolve(r.model):(r.promiseCnt+=1,t.onCancellationRequested((()=>{0==--r.promiseCnt&&(r.source.cancel(),OutlineModel._requests.delete(n))})),new Promise(((e,t)=>{r.promise.then((t=>{r.model=t,e(t)}),(e=>{OutlineModel._requests.delete(n),t(e)}))})))}static _create(e,t){const n=new CancellationTokenSource(t),r=new OutlineModel(e.uri),o=DocumentSymbolProviderRegistry.ordered(e),s=o.map(((t,o)=>{var s;let i=TreeElement.findId(`provider_${o}`,r),l=new OutlineGroup(i,r,null!==(s=t.displayName)&&void 0!==s?s:"Unknown Outline Provider",o);return Promise.resolve(t.provideDocumentSymbols(e,n.token)).then((e=>{for(const t of e||[])OutlineModel._makeOutlineElement(t,l);return l}),(e=>(onUnexpectedExternalError(e),l))).then((e=>{TreeElement.empty(e)?e.remove():r._groups.set(i,e)}))})),i=DocumentSymbolProviderRegistry.onDidChange((()=>{const t=DocumentSymbolProviderRegistry.ordered(e);equals(t,o)||n.cancel()}));return Promise.all(s).then((()=>n.token.isCancellationRequested&&!t.isCancellationRequested?OutlineModel._create(e,t):r._compact())).finally((()=>{i.dispose()}))}static _makeOutlineElement(e,t){let n=TreeElement.findId(e,t),r=new OutlineElement(n,t,e);if(e.children)for(const t of e.children)OutlineModel._makeOutlineElement(t,r);t.children.set(r.id,r)}_compact(){let e=0;for(const[t,n]of this._groups)0===n.children.size?this._groups.delete(t):e+=1;if(1!==e)this.children=this._groups;else{let e=Iterable.first(this._groups.values());for(let[,t]of e.children)t.parent=this,this.children.set(t.id,t)}return this}getTopLevelSymbols(){const e=[];for(const t of this.children.values())t instanceof OutlineElement?e.push(t.symbol):e.push(...Iterable.map(t.children.values(),(e=>e.symbol)));return e.sort(((e,t)=>Range.compareRangesUsingStarts(e.range,t.range)))}asListOfDocumentSymbols(){const e=this.getTopLevelSymbols(),t=[];return OutlineModel._flattenDocumentSymbols(t,e,""),t.sort(((e,t)=>Range.compareRangesUsingStarts(e.range,t.range)))}static _flattenDocumentSymbols(e,t,n){for(const r of t)e.push({kind:r.kind,tags:r.tags,name:r.name,detail:r.detail,containerName:r.containerName||n,range:r.range,selectionRange:r.selectionRange,children:void 0}),r.children&&OutlineModel._flattenDocumentSymbols(e,r.children,r.name)}}OutlineModel._requestDurations=new LanguageFeatureRequestDelays(DocumentSymbolProviderRegistry,350),OutlineModel._requests=new LRUCache(9,.75),OutlineModel._keys=new class{constructor(){this._counter=1,this._data=new WeakMap}for(e,t){return`${e.id}/${t?e.getVersionId():""}/${this._hash(DocumentSymbolProviderRegistry.all(e))}`}_hash(e){let t="";for(const n of e){let e=this._data.get(n);void 0===e&&(e=this._counter++,this._data.set(n,e)),t+=e}return t}};
//# sourceMappingURL=/sm/2b18bce132ae654027d7775afa6b73419ec81bf50b52f6accd24019612a40b66.map