/**
 * Minified by jsDelivr using Terser v5.7.1.
 * Original file: /npm/monaco-editor@0.27.0/esm/vs/editor/contrib/hover/modesContentHover.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __decorate=this&&this.__decorate||function(t,e,i,o){var s,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var h=t.length-1;h>=0;h--)(s=t[h])&&(r=(n<3?s(r):n>3?s(e,i,r):s(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r},__param=this&&this.__param||function(t,e){return function(i,o){e(i,o,t)}},__awaiter=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))((function(s,n){function r(t){try{a(o.next(t))}catch(t){n(t)}}function h(t){try{a(o.throw(t))}catch(t){n(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,h)}a((o=o.apply(t,e||[])).next())}))};import*as dom from"../../../base/browser/dom.js";import{DisposableStore,Disposable}from"../../../base/common/lifecycle.js";import{Position}from"../../common/core/position.js";import{Range}from"../../common/core/range.js";import{ModelDecorationOptions}from"../../common/model/textModel.js";import{TokenizationRegistry}from"../../common/modes.js";import{HoverOperation}from"./hoverOperation.js";import{coalesce,flatten}from"../../../base/common/arrays.js";import{Widget}from"../../../base/browser/ui/widget.js";import{HoverWidget,HoverAction}from"../../../base/browser/ui/hover/hoverWidget.js";import{MarkerHoverParticipant}from"./markerHoverParticipant.js";import{IInstantiationService}from"../../../platform/instantiation/common/instantiation.js";import{MarkdownHoverParticipant}from"./markdownHoverParticipant.js";import{InlineCompletionsHoverParticipant}from"../inlineCompletions/inlineCompletionsHoverParticipant.js";import{ColorHoverParticipant}from"./colorHoverParticipant.js";import{IKeybindingService}from"../../../platform/keybinding/common/keybinding.js";import{HoverRangeAnchor}from"./hoverTypes.js";const $=dom.$;let EditorHoverStatusBar=class extends Disposable{constructor(t){super(),this._keybindingService=t,this._hasContent=!1,this.hoverElement=$("div.hover-row.status-bar"),this.actionsElement=dom.append(this.hoverElement,$("div.actions"))}get hasContent(){return this._hasContent}addAction(t){const e=this._keybindingService.lookupKeybinding(t.commandId),i=e?e.getLabel():null;return this._hasContent=!0,this._register(HoverAction.render(this.actionsElement,t,i))}append(t){const e=dom.append(this.actionsElement,t);return this._hasContent=!0,e}};EditorHoverStatusBar=__decorate([__param(0,IKeybindingService)],EditorHoverStatusBar);class ModesContentComputer{constructor(t,e){this._participants=e,this._editor=t,this._result=[],this._anchor=null}setAnchor(t){this._anchor=t,this._result=[]}clearResult(){this._result=[]}static _getLineDecorations(t,e){if(1!==e.type)return[];const i=t.getModel(),o=e.range.startLineNumber,s=i.getLineMaxColumn(o);return t.getLineDecorations(o).filter((t=>{if(t.options.isWholeLine)return!0;const i=t.range.startLineNumber===o?t.range.startColumn:1,n=t.range.endLineNumber===o?t.range.endColumn:s;return!(i>e.range.startColumn||e.range.endColumn>n)}))}computeAsync(t){return __awaiter(this,void 0,void 0,(function*(){const e=this._anchor;if(!this._editor.hasModel()||!e)return Promise.resolve([]);const i=ModesContentComputer._getLineDecorations(this._editor,e),o=yield Promise.all(this._participants.map((o=>this._computeAsync(o,i,e,t))));return flatten(o)}))}_computeAsync(t,e,i,o){return __awaiter(this,void 0,void 0,(function*(){return t.computeAsync?t.computeAsync(i,e,o):[]}))}computeSync(){if(!this._editor.hasModel()||!this._anchor)return[];const t=ModesContentComputer._getLineDecorations(this._editor,this._anchor);let e=[];for(const i of this._participants)e=e.concat(i.computeSync(this._anchor,t));return coalesce(e)}onResult(t,e){this._result=e?t.concat(this._result):this._result.concat(t)}getResult(){return this._result.slice(0)}getResultWithLoadingMessage(){if(this._anchor)for(const t of this._participants)if(t.createLoadingMessage){const e=t.createLoadingMessage(this._anchor);if(e)return this._result.slice(0).concat([e])}return this._result.slice(0)}}let ModesContentHoverWidget=class t extends Widget{constructor(e,i,o,s){super(),this._hoverVisibleKey=i,this._keybindingService=s,this.allowEditorOverflow=!0,this._participants=[o.createInstance(ColorHoverParticipant,e,this),o.createInstance(MarkdownHoverParticipant,e,this),o.createInstance(InlineCompletionsHoverParticipant,e,this),o.createInstance(MarkerHoverParticipant,e,this)],this._hover=this._register(new HoverWidget),this._id=t.ID,this._editor=e,this._isVisible=!1,this._stoleFocus=!1,this._renderDisposable=null,this.onkeydown(this._hover.containerDomNode,(t=>{t.equals(9)&&this.hide()})),this._register(this._editor.onDidChangeConfiguration((t=>{t.hasChanged(41)&&this._updateFont()}))),this._editor.onDidLayoutChange((()=>this.layout())),this.layout(),this._editor.addContentWidget(this),this._showAtPosition=null,this._showAtRange=null,this._stoleFocus=!1,this._messages=[],this._lastAnchor=null,this._computer=new ModesContentComputer(this._editor,this._participants),this._highlightDecorations=[],this._isChangingDecorations=!1,this._shouldFocus=!1,this._colorPicker=null,this._hoverOperation=new HoverOperation(this._computer,(t=>this._withResult(t,!0)),null,(t=>this._withResult(t,!1)),this._editor.getOption(51).delay),this._register(dom.addStandardDisposableListener(this.getDomNode(),dom.EventType.FOCUS,(()=>{this._colorPicker&&this.getDomNode().classList.add("colorpicker-hover")}))),this._register(dom.addStandardDisposableListener(this.getDomNode(),dom.EventType.BLUR,(()=>{this.getDomNode().classList.remove("colorpicker-hover")}))),this._register(e.onDidChangeConfiguration((()=>{this._hoverOperation.setHoverTime(this._editor.getOption(51).delay)}))),this._register(TokenizationRegistry.onDidChange((()=>{this._isVisible&&this._lastAnchor&&this._messages.length>0&&(this._hover.contentsDomNode.textContent="",this._renderMessages(this._lastAnchor,this._messages))})))}dispose(){this._hoverOperation.cancel(),this._editor.removeContentWidget(this),super.dispose()}getId(){return this._id}getDomNode(){return this._hover.containerDomNode}_shouldShowAt(t){const e=t.target.type;if(6===e)return!0;if(7===e){const e=this._editor.getOption(41).typicalHalfwidthCharacterWidth/2,i=t.target.detail;if(i&&!i.isAfterLines&&"number"==typeof i.horizontalDistanceToText&&i.horizontalDistanceToText<e)return!0}return!1}maybeShowAt(t){var e;const i=[];for(const e of this._participants)if("function"==typeof e.suggestHoverAnchor){const o=e.suggestHoverAnchor(t);o&&i.push(o)}if(this._shouldShowAt(t)&&t.target.range){const o=[...(null===(e=t.target.element)||void 0===e?void 0:e.classList.values())||[]].find((t=>t.startsWith("ced-colorBox")))&&t.target.range.endColumn-t.target.range.startColumn==1?new Range(t.target.range.startLineNumber,t.target.range.startColumn+1,t.target.range.endLineNumber,t.target.range.endColumn+1):t.target.range;i.push(new HoverRangeAnchor(0,o))}return 0!==i.length&&(i.sort(((t,e)=>e.priority-t.priority)),this._startShowingAt(i[0],0,!1),!0)}_showAt(t,e,i){this._showAtPosition=t,this._showAtRange=e,this._hoverVisibleKey.set(!0),this._isVisible=!0,this._hover.containerDomNode.classList.toggle("hidden",!this._isVisible),this._editor.layoutContentWidget(this),this._editor.render(),this._stoleFocus=i,i&&this._hover.containerDomNode.focus()}getPosition(){return this._isVisible?{position:this._showAtPosition,range:this._showAtRange,preference:[1,2]}:null}_updateFont(){Array.prototype.slice.call(this._hover.contentsDomNode.getElementsByClassName("code")).forEach((t=>this._editor.applyFontInfo(t)))}_updateContents(t){this._hover.contentsDomNode.textContent="",this._hover.contentsDomNode.appendChild(t),this._updateFont(),this._editor.layoutContentWidget(this),this._hover.onContentsChanged()}layout(){const t=Math.max(this._editor.getLayoutInfo().height/4,250),{fontSize:e,lineHeight:i}=this._editor.getOption(41);this._hover.contentsDomNode.style.fontSize=`${e}px`,this._hover.contentsDomNode.style.lineHeight=`${i}px`,this._hover.contentsDomNode.style.maxHeight=`${t}px`,this._hover.contentsDomNode.style.maxWidth=`${Math.max(.66*this._editor.getLayoutInfo().width,500)}px`}onModelDecorationsChanged(){this._isChangingDecorations||this._isVisible&&(this._hoverOperation.cancel(),this._computer.clearResult(),this._colorPicker||this._hoverOperation.start(0))}startShowingAtRange(t,e,i){this._startShowingAt(new HoverRangeAnchor(0,t),e,i)}_startShowingAt(t,e,i){if(!this._lastAnchor||!this._lastAnchor.equals(t)){if(this._hoverOperation.cancel(),this._isVisible)if(this._showAtPosition&&this._lastAnchor&&t.canAdoptVisibleHover(this._lastAnchor,this._showAtPosition)){const e=this._messages.filter((e=>e.isValidForHoverAnchor(t)));if(0===e.length)this.hide();else{if(e.length===this._messages.length)return;this._renderMessages(t,e)}}else this.hide();this._lastAnchor=t,this._computer.setAnchor(t),this._shouldFocus=i,this._hoverOperation.start(e)}}hide(){this._lastAnchor=null,this._hoverOperation.cancel(),this._isVisible&&(setTimeout((()=>{this._isVisible||this._hoverVisibleKey.set(!1)}),0),this._isVisible=!1,this._hover.containerDomNode.classList.toggle("hidden",!this._isVisible),this._editor.layoutContentWidget(this),this._stoleFocus&&this._editor.focus()),this._isChangingDecorations=!0,this._highlightDecorations=this._editor.deltaDecorations(this._highlightDecorations,[]),this._isChangingDecorations=!1,this._renderDisposable&&(this._renderDisposable.dispose(),this._renderDisposable=null),this._colorPicker=null}isColorPickerVisible(){return!!this._colorPicker}setColorPicker(t){this._colorPicker=t}onContentsChanged(){this._hover.onContentsChanged()}_withResult(t,e){this._messages=t,this._lastAnchor&&this._messages.length>0?this._renderMessages(this._lastAnchor,this._messages):e&&this.hide()}_renderMessages(e,i){this._renderDisposable&&(this._renderDisposable.dispose(),this._renderDisposable=null),this._colorPicker=null;let o=1073741824,s=i[0].range,n=null,r=document.createDocumentFragment();const h=new DisposableStore,a=new Map;for(const t of i){o=Math.min(o,t.range.startColumn),s=Range.plusRange(s,t.range),t.forceShowAtRange&&(n=t.range),a.has(t.owner)||a.set(t.owner,[]);a.get(t.owner).push(t)}const c=h.add(new EditorHoverStatusBar(this._keybindingService));for(const[t,e]of a)h.add(t.renderHoverParts(e,r,c));c.hasContent&&r.appendChild(c.hoverElement),this._renderDisposable=h,r.hasChildNodes()&&(n?this._showAt(n.getStartPosition(),n,this._shouldFocus):this._showAt(new Position(e.range.startLineNumber,o),s,this._shouldFocus),this._updateContents(r)),this._colorPicker&&this._colorPicker.layout(),this._isChangingDecorations=!0,this._highlightDecorations=this._editor.deltaDecorations(this._highlightDecorations,s?[{range:s,options:t._DECORATION_OPTIONS}]:[]),this._isChangingDecorations=!1}};ModesContentHoverWidget.ID="editor.contrib.modesContentHoverWidget",ModesContentHoverWidget._DECORATION_OPTIONS=ModelDecorationOptions.register({description:"content-hover-highlight",className:"hoverHighlight"}),ModesContentHoverWidget=__decorate([__param(2,IInstantiationService),__param(3,IKeybindingService)],ModesContentHoverWidget);export{ModesContentHoverWidget};
//# sourceMappingURL=/sm/bc7169d722ccfa8551d53cfd799df3d9485acc1df152b297ccfa4bc119122a9a.map