/**
 * Minified by jsDelivr using Terser v5.7.1.
 * Original file: /npm/monaco-editor@0.27.0/esm/vs/editor/contrib/links/getLinks.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __awaiter=this&&this.__awaiter||function(e,o,n,r){return new(n||(n=Promise))((function(i,s){function t(e){try{a(r.next(e))}catch(e){s(e)}}function l(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){var o;e.done?i(e.value):(o=e.value,o instanceof n?o:new n((function(e){e(o)}))).then(t,l)}a((r=r.apply(e,o||[])).next())}))};import{CancellationToken}from"../../../base/common/cancellation.js";import{onUnexpectedExternalError}from"../../../base/common/errors.js";import{URI}from"../../../base/common/uri.js";import{Range}from"../../common/core/range.js";import{LinkProviderRegistry}from"../../common/modes.js";import{IModelService}from"../../common/services/modelService.js";import{CommandsRegistry}from"../../../platform/commands/common/commands.js";import{isDisposable,DisposableStore}from"../../../base/common/lifecycle.js";import{coalesce}from"../../../base/common/arrays.js";import{assertType}from"../../../base/common/types.js";export class Link{constructor(e,o){this._link=e,this._provider=o}toJSON(){return{range:this.range,url:this.url,tooltip:this.tooltip}}get range(){return this._link.range}get url(){return this._link.url}get tooltip(){return this._link.tooltip}resolve(e){return __awaiter(this,void 0,void 0,(function*(){return this._link.url?this._link.url:"function"==typeof this._provider.resolveLink?Promise.resolve(this._provider.resolveLink(this._link,e)).then((o=>(this._link=o||this._link,this._link.url?this.resolve(e):Promise.reject(new Error("missing"))))):Promise.reject(new Error("missing"))}))}}export class LinksList{constructor(e){this._disposables=new DisposableStore;let o=[];for(const[n,r]of e){const e=n.links.map((e=>new Link(e,r)));o=LinksList._union(o,e),isDisposable(n)&&this._disposables.add(n)}this.links=o}dispose(){this._disposables.dispose(),this.links.length=0}static _union(e,o){let n,r,i,s,t=[];for(n=0,i=0,r=e.length,s=o.length;n<r&&i<s;){const r=e[n],s=o[i];if(Range.areIntersectingOrTouching(r.range,s.range)){n++;continue}Range.compareRangesUsingStarts(r.range,s.range)<0?(t.push(r),n++):(t.push(s),i++)}for(;n<r;n++)t.push(e[n]);for(;i<s;i++)t.push(o[i]);return t}}export function getLinks(e,o){const n=[],r=LinkProviderRegistry.ordered(e).reverse().map(((r,i)=>Promise.resolve(r.provideLinks(e,o)).then((e=>{e&&(n[i]=[e,r])}),onUnexpectedExternalError)));return Promise.all(r).then((()=>{const e=new LinksList(coalesce(n));return o.isCancellationRequested?(e.dispose(),new LinksList([])):e}))}CommandsRegistry.registerCommand("_executeLinkProvider",((e,...o)=>__awaiter(void 0,void 0,void 0,(function*(){let[n,r]=o;assertType(n instanceof URI),"number"!=typeof r&&(r=0);const i=e.get(IModelService).getModel(n);if(!i)return[];const s=yield getLinks(i,CancellationToken.None);if(!s)return[];for(let e=0;e<Math.min(r,s.links.length);e++)yield s.links[e].resolve(CancellationToken.None);const t=s.links.slice(0);return s.dispose(),t}))));
//# sourceMappingURL=/sm/dba8f678fe7cfa3231d166bb5b964b5ce4107d4b9613f7efc17fa432db710f77.map