/**
 * Minified by jsDelivr using Terser v5.7.1.
 * Original file: /npm/monaco-editor@0.27.0/esm/vs/editor/contrib/hover/markerHoverParticipant.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __decorate=this&&this.__decorate||function(e,r,o,t){var n,i=arguments.length,s=i<3?r:null===t?t=Object.getOwnPropertyDescriptor(r,o):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,r,o,t);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(r,o,s):n(r,o))||s);return i>3&&s&&Object.defineProperty(r,o,s),s},__param=this&&this.__param||function(e,r){return function(o,t){r(o,t,e)}};import*as nls from"../../../nls.js";import*as dom from"../../../base/browser/dom.js";import{toDisposable,DisposableStore,Disposable}from"../../../base/common/lifecycle.js";import{Range}from"../../common/core/range.js";import{isNonEmptyArray}from"../../../base/common/arrays.js";import{IMarkerData,MarkerSeverity}from"../../../platform/markers/common/markers.js";import{basename}from"../../../base/common/resources.js";import{IMarkerDecorationsService}from"../../common/services/markersDecorationService.js";import{onUnexpectedError}from"../../../base/common/errors.js";import{IOpenerService}from"../../../platform/opener/common/opener.js";import{MarkerController,NextMarkerAction}from"../gotoError/gotoError.js";import{createCancelablePromise,disposableTimeout}from"../../../base/common/async.js";import{getCodeActions}from"../codeAction/codeAction.js";import{QuickFixAction,QuickFixController}from"../codeAction/codeActionCommands.js";import{CodeActionKind}from"../codeAction/types.js";import{Progress}from"../../../platform/progress/common/progress.js";import{registerThemingParticipant}from"../../../platform/theme/common/themeService.js";import{textLinkActiveForeground,textLinkForeground}from"../../../platform/theme/common/colorRegistry.js";const $=dom.$;export class MarkerHover{constructor(e,r,o){this.owner=e,this.range=r,this.marker=o}isValidForHoverAnchor(e){return 1===e.type&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}}const markerCodeActionTrigger={type:1,filter:{include:CodeActionKind.QuickFix}};let MarkerHoverParticipant=class{constructor(e,r,o,t){this._editor=e,this._hover=r,this._markerDecorationsService=o,this._openerService=t,this.recentMarkerCodeActionsInfo=void 0}computeSync(e,r){if(!this._editor.hasModel()||1!==e.type)return[];const o=this._editor.getModel(),t=e.range.startLineNumber,n=o.getLineMaxColumn(t),i=[];for(const s of r){const r=s.range.startLineNumber===t?s.range.startColumn:1,a=s.range.endLineNumber===t?s.range.endColumn:n,c=this._markerDecorationsService.getMarker(o.uri,s);if(!c)continue;const m=new Range(e.range.startLineNumber,r,e.range.startLineNumber,a);i.push(new MarkerHover(this,m,c))}return i}renderHoverParts(e,r,o){if(!e.length)return Disposable.None;const t=new DisposableStore;e.forEach((e=>r.appendChild(this.renderMarkerHover(e,t))));const n=1===e.length?e[0]:e.sort(((e,r)=>MarkerSeverity.compare(e.marker.severity,r.marker.severity)))[0];return this.renderMarkerStatusbar(n,o,t),t}renderMarkerHover(e,r){const o=$("div.hover-row"),t=dom.append(o,$("div.marker.hover-contents")),{source:n,message:i,code:s,relatedInformation:a}=e.marker;this._editor.applyFontInfo(t);const c=dom.append(t,$("span"));if(c.style.whiteSpace="pre-wrap",c.innerText=i,n||s)if(s&&"string"!=typeof s){const e=$("span");if(n){dom.append(e,$("span")).innerText=n}const o=dom.append(e,$("a.code-link"));o.setAttribute("href",s.target.toString()),r.add(dom.addDisposableListener(o,"click",(e=>{this._openerService.open(s.target,{allowCommands:!0}),e.preventDefault(),e.stopPropagation()})));dom.append(o,$("span")).innerText=s.value;const i=dom.append(t,e);i.style.opacity="0.6",i.style.paddingLeft="6px"}else{const e=dom.append(t,$("span"));e.style.opacity="0.6",e.style.paddingLeft="6px",e.innerText=n&&s?`${n}(${s})`:n||`(${s})`}if(isNonEmptyArray(a))for(const{message:e,resource:o,startLineNumber:n,startColumn:i}of a){const s=dom.append(t,$("div"));s.style.marginTop="8px";const a=dom.append(s,$("a"));a.innerText=`${basename(o)}(${n}, ${i}): `,a.style.cursor="pointer",r.add(dom.addDisposableListener(a,"click",(e=>{e.stopPropagation(),e.preventDefault(),this._openerService&&this._openerService.open(o,{fromUserGesture:!0,editorOptions:{selection:{startLineNumber:n,startColumn:i}}}).catch(onUnexpectedError)})));const c=dom.append(s,$("span"));c.innerText=e,this._editor.applyFontInfo(c)}return o}renderMarkerStatusbar(e,r,o){if(e.marker.severity!==MarkerSeverity.Error&&e.marker.severity!==MarkerSeverity.Warning&&e.marker.severity!==MarkerSeverity.Info||r.addAction({label:nls.localize("view problem","View Problem"),commandId:NextMarkerAction.ID,run:()=>{this._hover.hide(),MarkerController.get(this._editor).showAtMarker(e.marker),this._editor.focus()}}),!this._editor.getOption(79)){const t=r.append($("div"));this.recentMarkerCodeActionsInfo&&(IMarkerData.makeKey(this.recentMarkerCodeActionsInfo.marker)===IMarkerData.makeKey(e.marker)?this.recentMarkerCodeActionsInfo.hasCodeActions||(t.textContent=nls.localize("noQuickFixes","No quick fixes available")):this.recentMarkerCodeActionsInfo=void 0);const n=this.recentMarkerCodeActionsInfo&&!this.recentMarkerCodeActionsInfo.hasCodeActions?Disposable.None:o.add(disposableTimeout((()=>t.textContent=nls.localize("checkingForQuickFixes","Checking for quick fixes...")),200));t.textContent||(t.textContent=String.fromCharCode(160));const i=this.getCodeActions(e.marker);o.add(toDisposable((()=>i.cancel()))),i.then((i=>{if(n.dispose(),this.recentMarkerCodeActionsInfo={marker:e.marker,hasCodeActions:i.validActions.length>0},!this.recentMarkerCodeActionsInfo.hasCodeActions)return i.dispose(),void(t.textContent=nls.localize("noQuickFixes","No quick fixes available"));t.style.display="none";let s=!1;o.add(toDisposable((()=>{s||i.dispose()}))),r.addAction({label:nls.localize("quick fixes","Quick Fix..."),commandId:QuickFixAction.Id,run:e=>{s=!0;const r=QuickFixController.get(this._editor),o=dom.getDomNodePagePosition(e);this._hover.hide(),r.showCodeActions(markerCodeActionTrigger,i,{x:o.left+6,y:o.top+o.height+6})}})}))}}getCodeActions(e){return createCancelablePromise((r=>getCodeActions(this._editor.getModel(),new Range(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn),markerCodeActionTrigger,Progress.None,r)))}};MarkerHoverParticipant=__decorate([__param(2,IMarkerDecorationsService),__param(3,IOpenerService)],MarkerHoverParticipant);export{MarkerHoverParticipant};registerThemingParticipant(((e,r)=>{const o=e.getColor(textLinkForeground);o&&r.addRule(`.monaco-hover .hover-contents a.code-link span { color: ${o}; }`);const t=e.getColor(textLinkActiveForeground);t&&r.addRule(`.monaco-hover .hover-contents a.code-link span:hover { color: ${t}; }`)}));
//# sourceMappingURL=/sm/225bdca0ac94caf4176f437b122cad43d4bcdec02eff8482f2520205120b0b59.map