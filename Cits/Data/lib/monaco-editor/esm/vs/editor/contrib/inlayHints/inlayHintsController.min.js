/**
 * Minified by jsDelivr using Terser v5.7.1.
 * Original file: /npm/monaco-editor@0.27.0/esm/vs/editor/contrib/inlayHints/inlayHintsController.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __decorate=this&&this.__decorate||function(e,o,t,i){var s,r=arguments.length,n=r<3?o:null===i?i=Object.getOwnPropertyDescriptor(o,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,o,t,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(r<3?s(n):r>3?s(o,t,n):s(o,t))||n);return r>3&&n&&Object.defineProperty(o,t,n),n},__param=this&&this.__param||function(e,o){return function(t,i){o(t,i,e)}},__awaiter=this&&this.__awaiter||function(e,o,t,i){return new(t||(t=Promise))((function(s,r){function n(e){try{d(i.next(e))}catch(e){r(e)}}function a(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var o;e.done?s(e.value):(o=e.value,o instanceof t?o:new t((function(e){e(o)}))).then(n,a)}d((i=i.apply(e,o||[])).next())}))};import{RunOnceScheduler}from"../../../base/common/async.js";import{onUnexpectedExternalError}from"../../../base/common/errors.js";import{hash}from"../../../base/common/hash.js";import{DisposableStore,toDisposable}from"../../../base/common/lifecycle.js";import{registerEditorContribution}from"../../browser/editorExtensions.js";import{ICodeEditorService}from"../../browser/services/codeEditorService.js";import{InlayHintsProviderRegistry}from"../../common/modes.js";import{flatten}from"../../../base/common/arrays.js";import{editorInlayHintForeground,editorInlayHintBackground}from"../../../platform/theme/common/colorRegistry.js";import{CancellationToken,CancellationTokenSource}from"../../../base/common/cancellation.js";import{IThemeService}from"../../../platform/theme/common/themeService.js";import{Range}from"../../common/core/range.js";import{LanguageFeatureRequestDelays}from"../../common/modes/languageFeatureRegistry.js";import{CommandsRegistry}from"../../../platform/commands/common/commands.js";import{URI}from"../../../base/common/uri.js";import{assertType}from"../../../base/common/types.js";import{ITextModelService}from"../../common/services/resolverService.js";import{Position}from"../../common/core/position.js";import{IConfigurationService}from"../../../platform/configuration/common/configuration.js";const MAX_DECORATORS=500;export function getInlayHints(e,o,t){return __awaiter(this,void 0,void 0,(function*(){const i=[],s=InlayHintsProviderRegistry.ordered(e).reverse(),r=flatten(s.map((s=>o.map((o=>Promise.resolve(s.provideInlayHints(e,o,t)).then((e=>{e&&i.push({list:e,provider:s})}),(e=>{onUnexpectedExternalError(e)})))))));return yield Promise.all(r),i}))}let InlayHintsController=class{constructor(e,o,t,i){this._editor=e,this._codeEditorService=o,this._themeService=t,this._configurationService=i,this._disposables=new DisposableStore,this._sessionDisposables=new DisposableStore,this._getInlayHintsDelays=new LanguageFeatureRequestDelays(InlayHintsProviderRegistry,25,2500),this._decorationsTypeIds=[],this._decorationIds=[],this._disposables.add(InlayHintsProviderRegistry.onDidChange((()=>this._update()))),this._disposables.add(t.onDidColorThemeChange((()=>this._update()))),this._disposables.add(e.onDidChangeModel((()=>this._update()))),this._disposables.add(e.onDidChangeModelLanguage((()=>this._update()))),this._disposables.add(e.onDidChangeConfiguration((e=>{e.hasChanged(125)&&this._update()}))),this._update()}dispose(){this._sessionDisposables.dispose(),this._removeAllDecorations(),this._disposables.dispose()}_update(){if(this._sessionDisposables.clear(),!this._editor.getOption(125).enabled)return void this._removeAllDecorations();const e=this._editor.getModel();if(!e||!InlayHintsProviderRegistry.has(e))return void this._removeAllDecorations();const o=new RunOnceScheduler((()=>__awaiter(this,void 0,void 0,(function*(){const t=Date.now(),i=new CancellationTokenSource;this._sessionDisposables.add(toDisposable((()=>i.dispose(!0))));const s=this._editor.getVisibleRangesPlusViewportAboveBelow(),r=yield getInlayHints(e,s,i.token),n=this._getInlayHintsDelays.update(e,Date.now()-t);o.delay=n,this._updateHintsDecorators(r)}))),this._getInlayHintsDelays.get(e));this._sessionDisposables.add(o),this._sessionDisposables.add(this._editor.onDidChangeModelContent((()=>o.schedule()))),this._disposables.add(this._editor.onDidScrollChange((()=>o.schedule()))),o.schedule();const t=new DisposableStore;this._sessionDisposables.add(t);for(const i of InlayHintsProviderRegistry.all(e))"function"==typeof i.onDidChangeInlayHints&&t.add(i.onDidChangeInlayHints((()=>o.schedule())))}_updateHintsDecorators(e){const{fontSize:o,fontFamily:t}=this._getLayoutInfo(),i=this._themeService.getColorTheme().getColor(editorInlayHintBackground),s=this._themeService.getColorTheme().getColor(editorInlayHintForeground),r=[],n=[],a="--inlayHintsFontFamily";this._editor.getContainerDomNode().style.setProperty(a,t);const d=this._configurationService.getValue("editor.useInjectedText"),c=void 0===d||!!d;for(const{list:t}of e)for(let e=0;e<t.length&&n.length<500;e++){const{text:d,position:l,whitespaceBefore:m,whitespaceAfter:h}=t[e],p=m?o/3|0:0,_=h?o/3|0:0,f={contentText:fixSpace(d),backgroundColor:`${i}`,color:`${s}`,margin:`0px ${_}px 0px ${p}px`,fontSize:`${o}px`,fontFamily:`var(${a})`,padding:`0px ${o/4|0}px`,borderRadius:(o/4|0)+"px"},g="inlayHints-"+hash(f).toString(16);this._codeEditorService.registerDecorationType("inlay-hints-controller",g,c?{beforeInjectedText:Object.assign(Object.assign({},f),{affectsLetterSpacing:!0})}:{before:f},void 0,this._editor),r.push(g);const y=this._codeEditorService.resolveDecorationOptions(g,!0);n.push({range:Range.fromPositions(l),options:y})}this._decorationsTypeIds.forEach(this._codeEditorService.removeDecorationType,this._codeEditorService),this._decorationsTypeIds=r,this._decorationIds=this._editor.deltaDecorations(this._decorationIds,n)}_getLayoutInfo(){const e=this._editor.getOption(125),o=this._editor.getOption(43);let t=e.fontSize;(!t||t<5||t>o)&&(t=.9*o|0);return{fontSize:t,fontFamily:e.fontFamily||this._editor.getOption(40)}}_removeAllDecorations(){this._decorationIds=this._editor.deltaDecorations(this._decorationIds,[]),this._decorationsTypeIds.forEach(this._codeEditorService.removeDecorationType,this._codeEditorService),this._decorationsTypeIds=[]}};InlayHintsController.ID="editor.contrib.InlayHints",InlayHintsController=__decorate([__param(1,ICodeEditorService),__param(2,IThemeService),__param(3,IConfigurationService)],InlayHintsController);export{InlayHintsController};function fixSpace(e){return e.replace(/[ \t]/g,"Â ")}registerEditorContribution(InlayHintsController.ID,InlayHintsController),CommandsRegistry.registerCommand("_executeInlayHintProvider",((e,...o)=>__awaiter(void 0,void 0,void 0,(function*(){const[t,i]=o;assertType(URI.isUri(t)),assertType(Range.isIRange(i));const s=yield e.get(ITextModelService).createModelReference(t);try{const e=yield getInlayHints(s.object.textEditorModel,[Range.lift(i)],CancellationToken.None);return flatten(e.map((e=>e.list))).sort(((e,o)=>Position.compare(e.position,o.position)))}finally{s.dispose()}}))));
//# sourceMappingURL=/sm/4b36b7a91d3cb97af09761129fe9eda81cfa1a43f7b151ade01614b368b9ec94.map