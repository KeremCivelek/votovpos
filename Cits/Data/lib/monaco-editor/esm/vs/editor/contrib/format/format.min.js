/**
 * Minified by jsDelivr using Terser v5.7.1.
 * Original file: /npm/monaco-editor@0.27.0/esm/vs/editor/contrib/format/format.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __awaiter=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{m(n.next(e))}catch(e){i(e)}}function a(e){try{m(n.throw(e))}catch(e){i(e)}}function m(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}m((n=n.apply(e,t||[])).next())}))};import{alert}from"../../../base/browser/ui/aria/aria.js";import{asArray,isNonEmptyArray}from"../../../base/common/arrays.js";import{CancellationToken}from"../../../base/common/cancellation.js";import{illegalArgument,onUnexpectedExternalError}from"../../../base/common/errors.js";import{URI}from"../../../base/common/uri.js";import{EditorStateCancellationTokenSource,TextModelCancellationTokenSource}from"../../browser/core/editorState.js";import{isCodeEditor}from"../../browser/editorBrowser.js";import{Position}from"../../common/core/position.js";import{Range}from"../../common/core/range.js";import{Selection}from"../../common/core/selection.js";import{DocumentFormattingEditProviderRegistry,DocumentRangeFormattingEditProviderRegistry,OnTypeFormattingEditProviderRegistry}from"../../common/modes.js";import{IEditorWorkerService}from"../../common/services/editorWorkerService.js";import{IModelService}from"../../common/services/modelService.js";import{FormattingEdit}from"./formattingEdit.js";import*as nls from"../../../nls.js";import{ExtensionIdentifier}from"../../../platform/extensions/common/extensions.js";import{IInstantiationService}from"../../../platform/instantiation/common/instantiation.js";import{LinkedList}from"../../../base/common/linkedList.js";import{CommandsRegistry}from"../../../platform/commands/common/commands.js";import{assertType}from"../../../base/common/types.js";import{Iterable}from"../../../base/common/iterator.js";export function alertFormattingEdits(e){if(!(e=e.filter((e=>e.range))).length)return;let{range:t}=e[0];for(let o=1;o<e.length;o++)t=Range.plusRange(t,e[o].range);const{startLineNumber:o,endLineNumber:n}=t;o===n?1===e.length?alert(nls.localize("hint11","Made 1 formatting edit on line {0}",o)):alert(nls.localize("hintn1","Made {0} formatting edits on line {1}",e.length,o)):1===e.length?alert(nls.localize("hint1n","Made 1 formatting edit between lines {0} and {1}",o,n)):alert(nls.localize("hintnn","Made {0} formatting edits between lines {1} and {2}",e.length,o,n))}export function getRealAndSyntheticDocumentFormattersOrdered(e){const t=[],o=new Set,n=DocumentFormattingEditProviderRegistry.ordered(e);for(const e of n)t.push(e),e.extensionId&&o.add(ExtensionIdentifier.toKey(e.extensionId));const r=DocumentRangeFormattingEditProviderRegistry.ordered(e);for(const e of r){if(e.extensionId){if(o.has(ExtensionIdentifier.toKey(e.extensionId)))continue;o.add(ExtensionIdentifier.toKey(e.extensionId))}t.push({displayName:e.displayName,extensionId:e.extensionId,provideDocumentFormattingEdits:(t,o,n)=>e.provideDocumentRangeFormattingEdits(t,t.getFullModelRange(),o,n)})}return t}export class FormattingConflicts{static setFormatterSelector(e){return{dispose:FormattingConflicts._selectors.unshift(e)}}static select(e,t,o){return __awaiter(this,void 0,void 0,(function*(){if(0===e.length)return;const n=Iterable.first(FormattingConflicts._selectors);return n?yield n(e,t,o):void 0}))}}FormattingConflicts._selectors=new LinkedList;export function formatDocumentRangesWithSelectedProvider(e,t,o,n,r,i){return __awaiter(this,void 0,void 0,(function*(){const s=e.get(IInstantiationService),a=isCodeEditor(t)?t.getModel():t,m=DocumentRangeFormattingEditProviderRegistry.ordered(a),d=yield FormattingConflicts.select(m,a,n);d&&(r.report(d),yield s.invokeFunction(formatDocumentRangesWithProvider,d,t,o,i))}))}export function formatDocumentRangesWithProvider(e,t,o,n,r){return __awaiter(this,void 0,void 0,(function*(){const i=e.get(IEditorWorkerService);let s,a;isCodeEditor(o)?(s=o.getModel(),a=new EditorStateCancellationTokenSource(o,5,void 0,r)):(s=o,a=new TextModelCancellationTokenSource(o,r));let m=[],d=0;for(let e of asArray(n).sort(Range.compareRangesUsingStarts))d>0&&Range.areIntersectingOrTouching(m[d-1],e)?m[d-1]=Range.fromPositions(m[d-1].getStartPosition(),e.getEndPosition()):d=m.push(e);const c=e=>__awaiter(this,void 0,void 0,(function*(){return(yield t.provideDocumentRangeFormattingEdits(s,e,s.getFormattingOptions(),a.token))||[]})),l=(e,t)=>{if(!e.length||!t.length)return!1;const o=e.reduce(((e,t)=>Range.plusRange(e,t.range)),e[0].range);if(!t.some((e=>Range.intersectRanges(o,e.range))))return!1;for(let o of e)for(let e of t)if(Range.intersectRanges(o.range,e.range))return!0;return!1},g=[],u=[];try{for(let e of m){if(a.token.isCancellationRequested)return!0;u.push(yield c(e))}for(let e=0;e<m.length;++e)for(let t=e+1;t<m.length;++t){if(a.token.isCancellationRequested)return!0;if(l(u[e],u[t])){const o=Range.plusRange(m[e],m[t]),n=yield c(o);m.splice(t,1),m.splice(e,1),m.push(o),u.splice(t,1),u.splice(e,1),u.push(n),e=0,t=0}}for(let e of u){if(a.token.isCancellationRequested)return!0;const t=yield i.computeMoreMinimalEdits(s.uri,e);t&&g.push(...t)}}finally{a.dispose()}if(0===g.length)return!1;if(isCodeEditor(o))FormattingEdit.execute(o,g,!0),alertFormattingEdits(g),o.revealPositionInCenterIfOutsideViewport(o.getPosition(),1);else{const[{range:e}]=g,t=new Selection(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn);s.pushEditOperations([t],g.map((e=>({text:e.text,range:Range.lift(e.range),forceMoveMarkers:!0}))),(e=>{for(const{range:o}of e)if(Range.areIntersectingOrTouching(o,t))return[new Selection(o.startLineNumber,o.startColumn,o.endLineNumber,o.endColumn)];return null}))}return!0}))}export function formatDocumentWithSelectedProvider(e,t,o,n,r){return __awaiter(this,void 0,void 0,(function*(){const i=e.get(IInstantiationService),s=isCodeEditor(t)?t.getModel():t,a=getRealAndSyntheticDocumentFormattersOrdered(s),m=yield FormattingConflicts.select(a,s,o);m&&(n.report(m),yield i.invokeFunction(formatDocumentWithProvider,m,t,o,r))}))}export function formatDocumentWithProvider(e,t,o,n,r){return __awaiter(this,void 0,void 0,(function*(){const i=e.get(IEditorWorkerService);let s,a,m;isCodeEditor(o)?(s=o.getModel(),a=new EditorStateCancellationTokenSource(o,5,void 0,r)):(s=o,a=new TextModelCancellationTokenSource(o,r));try{const e=yield t.provideDocumentFormattingEdits(s,s.getFormattingOptions(),a.token);if(m=yield i.computeMoreMinimalEdits(s.uri,e),a.token.isCancellationRequested)return!0}finally{a.dispose()}if(!m||0===m.length)return!1;if(isCodeEditor(o))FormattingEdit.execute(o,m,2!==n),2!==n&&(alertFormattingEdits(m),o.revealPositionInCenterIfOutsideViewport(o.getPosition(),1));else{const[{range:e}]=m,t=new Selection(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn);s.pushEditOperations([t],m.map((e=>({text:e.text,range:Range.lift(e.range),forceMoveMarkers:!0}))),(e=>{for(const{range:o}of e)if(Range.areIntersectingOrTouching(o,t))return[new Selection(o.startLineNumber,o.startColumn,o.endLineNumber,o.endColumn)];return null}))}return!0}))}export function getDocumentRangeFormattingEditsUntilResult(e,t,o,n,r){return __awaiter(this,void 0,void 0,(function*(){const i=DocumentRangeFormattingEditProviderRegistry.ordered(t);for(const s of i){let i=yield Promise.resolve(s.provideDocumentRangeFormattingEdits(t,o,n,r)).catch(onUnexpectedExternalError);if(isNonEmptyArray(i))return yield e.computeMoreMinimalEdits(t.uri,i)}}))}export function getDocumentFormattingEditsUntilResult(e,t,o,n){return __awaiter(this,void 0,void 0,(function*(){const r=getRealAndSyntheticDocumentFormattersOrdered(t);for(const i of r){let r=yield Promise.resolve(i.provideDocumentFormattingEdits(t,o,n)).catch(onUnexpectedExternalError);if(isNonEmptyArray(r))return yield e.computeMoreMinimalEdits(t.uri,r)}}))}export function getOnTypeFormattingEdits(e,t,o,n,r){const i=OnTypeFormattingEditProviderRegistry.ordered(t);return 0===i.length||i[0].autoFormatTriggerCharacters.indexOf(n)<0?Promise.resolve(void 0):Promise.resolve(i[0].provideOnTypeFormattingEdits(t,o,n,r,CancellationToken.None)).catch(onUnexpectedExternalError).then((o=>e.computeMoreMinimalEdits(t.uri,o)))}CommandsRegistry.registerCommand("_executeFormatRangeProvider",(function(e,...t){const[o,n,r]=t;assertType(URI.isUri(o)),assertType(Range.isIRange(n));const i=e.get(IModelService).getModel(o);if(!i)throw illegalArgument("resource");return getDocumentRangeFormattingEditsUntilResult(e.get(IEditorWorkerService),i,Range.lift(n),r,CancellationToken.None)})),CommandsRegistry.registerCommand("_executeFormatDocumentProvider",(function(e,...t){const[o,n]=t;assertType(URI.isUri(o));const r=e.get(IModelService).getModel(o);if(!r)throw illegalArgument("resource");return getDocumentFormattingEditsUntilResult(e.get(IEditorWorkerService),r,n,CancellationToken.None)})),CommandsRegistry.registerCommand("_executeFormatOnTypeProvider",(function(e,...t){const[o,n,r,i]=t;assertType(URI.isUri(o)),assertType(Position.isIPosition(n)),assertType("string"==typeof r);const s=e.get(IModelService).getModel(o);if(!s)throw illegalArgument("resource");return getOnTypeFormattingEdits(e.get(IEditorWorkerService),s,Position.lift(n),r,i)}));
//# sourceMappingURL=/sm/a3a2985abd6ca906b15d4c9abbe9fa638f8f4ac354da8e55960dc0cb330fa85a.map