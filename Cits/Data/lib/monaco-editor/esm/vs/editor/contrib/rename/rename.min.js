/**
 * Minified by jsDelivr using Terser v5.7.1.
 * Original file: /npm/monaco-editor@0.27.0/esm/vs/editor/contrib/rename/rename.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __decorate=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},__param=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}},__awaiter=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(r,n){function s(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))};import*as nls from"../../../nls.js";import{onUnexpectedError}from"../../../base/common/errors.js";import{ContextKeyExpr}from"../../../platform/contextkey/common/contextkey.js";import{IEditorProgressService}from"../../../platform/progress/common/progress.js";import{registerEditorAction,registerEditorContribution,EditorAction,EditorCommand,registerEditorCommand,registerModelAndPositionCommand}from"../../browser/editorExtensions.js";import{EditorContextKeys}from"../../common/editorContextKeys.js";import{RenameInputField,CONTEXT_RENAME_INPUT_VISIBLE}from"./renameInputField.js";import{RenameProviderRegistry}from"../../common/modes.js";import{Position}from"../../common/core/position.js";import{alert}from"../../../base/browser/ui/aria/aria.js";import{Range}from"../../common/core/range.js";import{MessageController}from"../message/messageController.js";import{EditorStateCancellationTokenSource}from"../../browser/core/editorState.js";import{INotificationService}from"../../../platform/notification/common/notification.js";import{IBulkEditService,ResourceEdit}from"../../browser/services/bulkEditService.js";import{URI}from"../../../base/common/uri.js";import{ICodeEditorService}from"../../browser/services/codeEditorService.js";import{CancellationToken,CancellationTokenSource}from"../../../base/common/cancellation.js";import{DisposableStore}from"../../../base/common/lifecycle.js";import{IdleValue,raceCancellation}from"../../../base/common/async.js";import{ILogService}from"../../../platform/log/common/log.js";import{IInstantiationService}from"../../../platform/instantiation/common/instantiation.js";import{Registry}from"../../../platform/registry/common/platform.js";import{Extensions}from"../../../platform/configuration/common/configurationRegistry.js";import{ITextResourceConfigurationService}from"../../common/services/textResourceConfigurationService.js";import{assertType}from"../../../base/common/types.js";class RenameSkeleton{constructor(e,t){this.model=e,this.position=t,this._providerRenameIdx=0,this._providers=RenameProviderRegistry.ordered(e)}hasProvider(){return this._providers.length>0}resolveRenameLocation(e){return __awaiter(this,void 0,void 0,(function*(){const t=[];for(this._providerRenameIdx=0;this._providerRenameIdx<this._providers.length;this._providerRenameIdx++){const o=this._providers[this._providerRenameIdx];if(!o.resolveRenameLocation)break;let i=yield o.resolveRenameLocation(this.model,this.position,e);if(i){if(!i.rejectReason)return i;t.push(i.rejectReason)}}const o=this.model.getWordAtPosition(this.position);return o?{range:new Range(this.position.lineNumber,o.startColumn,this.position.lineNumber,o.endColumn),text:o.word,rejectReason:t.length>0?t.join("\n"):void 0}:{range:Range.fromPositions(this.position),text:"",rejectReason:t.length>0?t.join("\n"):void 0}}))}provideRenameEdits(e,t){return __awaiter(this,void 0,void 0,(function*(){return this._provideRenameEdits(e,this._providerRenameIdx,[],t)}))}_provideRenameEdits(e,t,o,i){return __awaiter(this,void 0,void 0,(function*(){const r=this._providers[t];if(!r)return{edits:[],rejectReason:o.join("\n")};const n=yield r.provideRenameEdits(this.model,this.position,e,i);return n?n.rejectReason?this._provideRenameEdits(e,t+1,o.concat(n.rejectReason),i):n:this._provideRenameEdits(e,t+1,o.concat(nls.localize("no result","No result.")),i)}))}}export function rename(e,t,o){return __awaiter(this,void 0,void 0,(function*(){const i=new RenameSkeleton(e,t),r=yield i.resolveRenameLocation(CancellationToken.None);return(null==r?void 0:r.rejectReason)?{edits:[],rejectReason:r.rejectReason}:i.provideRenameEdits(o,CancellationToken.None)}))}let RenameController=class e{constructor(e,t,o,i,r,n,s){this.editor=e,this._instaService=t,this._notificationService=o,this._bulkEditService=i,this._progressService=r,this._logService=n,this._configService=s,this._dispoableStore=new DisposableStore,this._cts=new CancellationTokenSource,this._renameInputField=this._dispoableStore.add(new IdleValue((()=>this._dispoableStore.add(this._instaService.createInstance(RenameInputField,this.editor,["acceptRenameInput","acceptRenameInputWithPreview"])))))}static get(t){return t.getContribution(e.ID)}dispose(){this._dispoableStore.dispose(),this._cts.dispose(!0)}run(){return __awaiter(this,void 0,void 0,(function*(){if(this._cts.dispose(!0),!this.editor.hasModel())return;const e=this.editor.getPosition(),t=new RenameSkeleton(this.editor.getModel(),e);if(!t.hasProvider())return;let o;this._cts=new EditorStateCancellationTokenSource(this.editor,5);try{const e=t.resolveRenameLocation(this._cts.token);this._progressService.showWhile(e,250),o=yield e}catch(t){return void MessageController.get(this.editor).showMessage(t||nls.localize("resolveRenameLocationFailed","An unknown error occurred while resolving rename location"),e)}if(!o)return;if(o.rejectReason)return void MessageController.get(this.editor).showMessage(o.rejectReason,e);if(this._cts.token.isCancellationRequested)return;this._cts.dispose(),this._cts=new EditorStateCancellationTokenSource(this.editor,5,o.range);let i=this.editor.getSelection(),r=0,n=o.text.length;Range.isEmpty(i)||Range.spansMultipleLines(i)||!Range.containsRange(o.range,i)||(r=Math.max(0,i.startColumn-o.range.startColumn),n=Math.min(o.range.endColumn,i.endColumn)-o.range.startColumn);const s=this._bulkEditService.hasPreviewHandler()&&this._configService.getValue(this.editor.getModel().uri,"editor.rename.enablePreview"),a=yield this._renameInputField.value.getInput(o.range,o.text,r,n,s,this._cts.token);if("boolean"==typeof a)return void(a&&this.editor.focus());this.editor.focus();const c=raceCancellation(t.provideRenameEdits(a.newName,this._cts.token),this._cts.token).then((e=>__awaiter(this,void 0,void 0,(function*(){e&&this.editor.hasModel()&&(e.rejectReason?this._notificationService.info(e.rejectReason):this._bulkEditService.apply(ResourceEdit.convert(e),{editor:this.editor,showPreview:a.wantsPreview,label:nls.localize("label","Renaming '{0}'",null==o?void 0:o.text),quotableLabel:nls.localize("quotableLabel","Renaming {0}",null==o?void 0:o.text)}).then((e=>{e.ariaSummary&&alert(nls.localize("aria","Successfully renamed '{0}' to '{1}'. Summary: {2}",o.text,a.newName,e.ariaSummary))})).catch((e=>{this._notificationService.error(nls.localize("rename.failedApply","Rename failed to apply edits")),this._logService.error(e)})))}))),(e=>{this._notificationService.error(nls.localize("rename.failed","Rename failed to compute edits")),this._logService.error(e)}));return this._progressService.showWhile(c,250),c}))}acceptRenameInput(e){this._renameInputField.value.acceptInput(e)}cancelRenameInput(){this._renameInputField.value.cancelInput(!0)}};RenameController.ID="editor.contrib.renameController",RenameController=__decorate([__param(1,IInstantiationService),__param(2,INotificationService),__param(3,IBulkEditService),__param(4,IEditorProgressService),__param(5,ILogService),__param(6,ITextResourceConfigurationService)],RenameController);export class RenameAction extends EditorAction{constructor(){super({id:"editor.action.rename",label:nls.localize("rename.label","Rename Symbol"),alias:"Rename Symbol",precondition:ContextKeyExpr.and(EditorContextKeys.writable,EditorContextKeys.hasRenameProvider),kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:60,weight:100},contextMenuOpts:{group:"1_modification",order:1.1}})}runCommand(e,t){const o=e.get(ICodeEditorService),[i,r]=Array.isArray(t)&&t||[void 0,void 0];return URI.isUri(i)&&Position.isIPosition(r)?o.openCodeEditor({resource:i},o.getActiveCodeEditor()).then((e=>{e&&(e.setPosition(r),e.invokeWithinContext((t=>(this.reportTelemetry(t,e),this.run(t,e)))))}),onUnexpectedError):super.runCommand(e,t)}run(e,t){const o=RenameController.get(t);return o?o.run():Promise.resolve()}}registerEditorContribution(RenameController.ID,RenameController),registerEditorAction(RenameAction);const RenameCommand=EditorCommand.bindToContribution(RenameController.get);registerEditorCommand(new RenameCommand({id:"acceptRenameInput",precondition:CONTEXT_RENAME_INPUT_VISIBLE,handler:e=>e.acceptRenameInput(!1),kbOpts:{weight:199,kbExpr:EditorContextKeys.focus,primary:3}})),registerEditorCommand(new RenameCommand({id:"acceptRenameInputWithPreview",precondition:ContextKeyExpr.and(CONTEXT_RENAME_INPUT_VISIBLE,ContextKeyExpr.has("config.editor.rename.enablePreview")),handler:e=>e.acceptRenameInput(!0),kbOpts:{weight:199,kbExpr:EditorContextKeys.focus,primary:1027}})),registerEditorCommand(new RenameCommand({id:"cancelRenameInput",precondition:CONTEXT_RENAME_INPUT_VISIBLE,handler:e=>e.cancelRenameInput(),kbOpts:{weight:199,kbExpr:EditorContextKeys.focus,primary:9,secondary:[1033]}})),registerModelAndPositionCommand("_executeDocumentRenameProvider",(function(e,t,...o){const[i]=o;return assertType("string"==typeof i),rename(e,t,i)})),Registry.as(Extensions.Configuration).registerConfiguration({id:"editor",properties:{"editor.rename.enablePreview":{scope:5,description:nls.localize("enablePreview","Enable/disable the ability to preview changes before renaming"),default:!0,type:"boolean"}}});
//# sourceMappingURL=/sm/b65a72867480c0467620e4d3c10cead42f68aa9b82b7f47b60dc4a90fb649865.map