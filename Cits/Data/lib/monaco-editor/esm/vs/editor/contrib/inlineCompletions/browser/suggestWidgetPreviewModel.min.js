/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/monaco-editor@0.33.0/esm/vs/editor/contrib/inlineCompletions/browser/suggestWidgetPreviewModel.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __decorate=this&&this.__decorate||function(e,t,i,n){var o,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(s<3?o(r):s>3?o(t,i,r):o(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},__param=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}},__awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{a(n.next(e))}catch(e){s(e)}}function l(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,l)}a((n=n.apply(e,t||[])).next())}))};import{createCancelablePromise,RunOnceScheduler}from"../../../../base/common/async.js";import{onUnexpectedError}from"../../../../base/common/errors.js";import{MutableDisposable,toDisposable}from"../../../../base/common/lifecycle.js";import{InlineCompletionTriggerKind}from"../../../common/languages.js";import{ILanguageFeaturesService}from"../../../common/services/languageFeatures.js";import{BaseGhostTextWidgetModel,GhostText}from"./ghostText.js";import{minimizeInlineCompletion,provideInlineCompletions,UpdateOperation}from"./inlineCompletionsModel.js";import{inlineCompletionToGhostText}from"./inlineCompletionToGhostText.js";import{SuggestWidgetInlineCompletionProvider}from"./suggestWidgetInlineCompletionProvider.js";let SuggestWidgetPreviewModel=class extends BaseGhostTextWidgetModel{constructor(e,t,i){super(e),this.cache=t,this.languageFeaturesService=i,this.suggestionInlineCompletionSource=this._register(new SuggestWidgetInlineCompletionProvider(this.editor,(()=>{var e,t;return null===(t=null===(e=this.cache.value)||void 0===e?void 0:e.completions[0])||void 0===t?void 0:t.toLiveInlineCompletion()}))),this.updateOperation=this._register(new MutableDisposable),this.updateCacheSoon=this._register(new RunOnceScheduler((()=>this.updateCache()),50)),this.minReservedLineCount=0,this._register(this.suggestionInlineCompletionSource.onDidChange((()=>{this.updateCacheSoon.schedule();this.suggestionInlineCompletionSource.state||(this.minReservedLineCount=0);const e=this.ghostText;e&&(this.minReservedLineCount=Math.max(this.minReservedLineCount,sum(e.parts.map((e=>e.lines.length-1))))),this.minReservedLineCount>=1?this.suggestionInlineCompletionSource.forceRenderingAbove():this.suggestionInlineCompletionSource.stopForceRenderingAbove(),this.onDidChangeEmitter.fire()}))),this._register(this.cache.onDidChange((()=>{this.onDidChangeEmitter.fire()}))),this._register(this.editor.onDidChangeCursorPosition((e=>{this.minReservedLineCount=0,this.updateCacheSoon.schedule(),this.onDidChangeEmitter.fire()}))),this._register(toDisposable((()=>this.suggestionInlineCompletionSource.stopForceRenderingAbove())))}get isActive(){return void 0!==this.suggestionInlineCompletionSource.state}isSuggestionPreviewEnabled(){return this.editor.getOption(106).preview}updateCache(){return __awaiter(this,void 0,void 0,(function*(){const e=this.suggestionInlineCompletionSource.state;if(!e||!e.selectedItem)return;const t={text:e.selectedItem.normalizedInlineCompletion.text,range:e.selectedItem.normalizedInlineCompletion.range,isSnippetText:e.selectedItem.isSnippetText,completionKind:e.selectedItem.completionItemKind},i=this.editor.getPosition(),n=createCancelablePromise((e=>__awaiter(this,void 0,void 0,(function*(){let n;try{n=yield provideInlineCompletions(this.languageFeaturesService.inlineCompletionsProvider,i,this.editor.getModel(),{triggerKind:InlineCompletionTriggerKind.Automatic,selectedSuggestionInfo:t},e)}catch(e){return void onUnexpectedError(e)}e.isCancellationRequested||(this.cache.setValue(this.editor,n,InlineCompletionTriggerKind.Automatic),this.onDidChangeEmitter.fire())})))),o=new UpdateOperation(n,InlineCompletionTriggerKind.Automatic);this.updateOperation.value=o,yield n,this.updateOperation.value===o&&this.updateOperation.clear()}))}get ghostText(){var e,t,i;const n=this.isSuggestionPreviewEnabled(),o=minimizeInlineCompletion(this.editor.getModel(),null===(t=null===(e=this.cache.value)||void 0===e?void 0:e.completions[0])||void 0===t?void 0:t.toLiveInlineCompletion()),s=this.suggestionInlineCompletionSource.state,r=minimizeInlineCompletion(this.editor.getModel(),null===(i=null==s?void 0:s.selectedItem)||void 0===i?void 0:i.normalizedInlineCompletion),l=o&&r&&o.text.startsWith(r.text)&&o.range.equalsRange(r.range);if(!n&&!l)return;const a=l?o:r||o,d=l?a.text.length-r.text.length:0;return this.toGhostText(a,d)}toGhostText(e,t){const i=this.editor.getOptions().get(106).previewMode;return e?inlineCompletionToGhostText(e,this.editor.getModel(),i,this.editor.getPosition(),t)||new GhostText(e.range.endLineNumber,[],this.minReservedLineCount):void 0}};SuggestWidgetPreviewModel=__decorate([__param(2,ILanguageFeaturesService)],SuggestWidgetPreviewModel);export{SuggestWidgetPreviewModel};function sum(e){return e.reduce(((e,t)=>e+t),0)}
//# sourceMappingURL=/sm/5aa311d57d6ac3b1c02a8def39ab7f8a575c0cb178db0bf9516063209eecf810.map