/**
 * Minified by jsDelivr using Terser v5.7.1.
 * Original file: /npm/monaco-editor@0.27.0/esm/vs/editor/contrib/viewportSemanticTokens/viewportSemanticTokens.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __decorate=this&&this.__decorate||function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},__param=this&&this.__param||function(e,t){return function(i,o){t(i,o,e)}};import{RunOnceScheduler,createCancelablePromise}from"../../../base/common/async.js";import{Disposable}from"../../../base/common/lifecycle.js";import{registerEditorContribution}from"../../browser/editorExtensions.js";import{DocumentRangeSemanticTokensProviderRegistry}from"../../common/modes.js";import{IModelService}from"../../common/services/modelService.js";import{toMultilineTokens2}from"../../common/services/semanticTokensProviderStyling.js";import{IThemeService}from"../../../platform/theme/common/themeService.js";import{IConfigurationService}from"../../../platform/configuration/common/configuration.js";import{isSemanticColoringEnabled,SEMANTIC_HIGHLIGHTING_SETTING_ID}from"../../common/services/modelServiceImpl.js";import{getDocumentRangeSemanticTokensProvider}from"../../common/services/getSemanticTokens.js";let ViewportSemanticTokensContribution=class extends Disposable{constructor(e,t,i,o){super(),this._modelService=t,this._themeService=i,this._configurationService=o,this._editor=e,this._tokenizeViewport=new RunOnceScheduler((()=>this._tokenizeViewportNow()),100),this._outstandingRequests=[],this._register(this._editor.onDidScrollChange((()=>{this._tokenizeViewport.schedule()}))),this._register(this._editor.onDidChangeModel((()=>{this._cancelAll(),this._tokenizeViewport.schedule()}))),this._register(this._editor.onDidChangeModelContent((e=>{this._cancelAll(),this._tokenizeViewport.schedule()}))),this._register(DocumentRangeSemanticTokensProviderRegistry.onDidChange((()=>{this._cancelAll(),this._tokenizeViewport.schedule()}))),this._register(this._configurationService.onDidChangeConfiguration((e=>{e.affectsConfiguration(SEMANTIC_HIGHLIGHTING_SETTING_ID)&&(this._cancelAll(),this._tokenizeViewport.schedule())}))),this._register(this._themeService.onDidColorThemeChange((()=>{this._cancelAll(),this._tokenizeViewport.schedule()})))}_cancelAll(){for(const e of this._outstandingRequests)e.cancel();this._outstandingRequests=[]}_removeOutstandingRequest(e){for(let t=0,i=this._outstandingRequests.length;t<i;t++)if(this._outstandingRequests[t]===e)return void this._outstandingRequests.splice(t,1)}_tokenizeViewportNow(){if(!this._editor.hasModel())return;const e=this._editor.getModel();if(e.hasCompleteSemanticTokens())return;if(!isSemanticColoringEnabled(e,this._themeService,this._configurationService))return void(e.hasSomeSemanticTokens()&&e.setSemanticTokens(null,!1));const t=getDocumentRangeSemanticTokensProvider(e);if(!t)return void(e.hasSomeSemanticTokens()&&e.setSemanticTokens(null,!1));const i=this._modelService.getSemanticTokensProviderStyling(t),o=this._editor.getVisibleRangesPlusViewportAboveBelow();this._outstandingRequests=this._outstandingRequests.concat(o.map((o=>this._requestRange(e,o,t,i))))}_requestRange(e,t,i,o){const n=e.getVersionId(),s=createCancelablePromise((o=>Promise.resolve(i.provideDocumentRangeSemanticTokens(e,t,o))));return s.then((i=>{i&&!e.isDisposed()&&e.getVersionId()===n&&e.setPartialSemanticTokens(t,toMultilineTokens2(i,o,e.getLanguageIdentifier()))})).then((()=>this._removeOutstandingRequest(s)),(()=>this._removeOutstandingRequest(s))),s}};ViewportSemanticTokensContribution.ID="editor.contrib.viewportSemanticTokens",ViewportSemanticTokensContribution=__decorate([__param(1,IModelService),__param(2,IThemeService),__param(3,IConfigurationService)],ViewportSemanticTokensContribution),registerEditorContribution(ViewportSemanticTokensContribution.ID,ViewportSemanticTokensContribution);
//# sourceMappingURL=/sm/59c71b827e53a8a04d2cece979e94a94e3d95082ec9e2d7694e5909662a01100.map