/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/monaco-editor@0.33.0/esm/vs/editor/common/model/guidesTextModelPart.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{ArrayQueue,findLast}from"../../../base/common/arrays.js";import*as strings from"../../../base/common/strings.js";import{CursorColumns}from"../core/cursorColumns.js";import{Range}from"../core/range.js";import{TextModelPart}from"./textModelPart.js";import{computeIndentLevel}from"./utils.js";import{HorizontalGuidesState,IndentGuide,IndentGuideHorizontalLine}from"../textModelGuides.js";export class GuidesTextModelPart extends TextModelPart{constructor(e,t){super(),this.textModel=e,this.languageConfigurationService=t}getLanguageConfiguration(e){return this.languageConfigurationService.getLanguageConfiguration(e)}_computeIndentLevel(e){return computeIndentLevel(this.textModel.getLineContent(e+1),this.textModel.getOptions().tabSize)}getActiveIndentGuide(e,t,n){this.assertNotDisposed();const i=this.textModel.getLineCount();if(e<1||e>i)throw new Error("Illegal value for lineNumber");const o=this.getLanguageConfiguration(this.textModel.getLanguageId()).foldingRules,s=Boolean(o&&o.offSide);let r=-2,l=-1,a=-2,u=-1;const d=e=>{if(-1!==r&&(-2===r||r>e-1)){r=-1,l=-1;for(let t=e-2;t>=0;t--){const e=this._computeIndentLevel(t);if(e>=0){r=t,l=e;break}}}if(-2===a){a=-1,u=-1;for(let t=e;t<i;t++){const e=this._computeIndentLevel(t);if(e>=0){a=t,u=e;break}}}};let g=-2,c=-1,m=-2,h=-1;const f=e=>{if(-2===g){g=-1,c=-1;for(let t=e-2;t>=0;t--){const e=this._computeIndentLevel(t);if(e>=0){g=t,c=e;break}}}if(-1!==m&&(-2===m||m<e-1)){m=-1,h=-1;for(let t=e;t<i;t++){const e=this._computeIndentLevel(t);if(e>=0){m=t,h=e;break}}}};let L=0,b=!0,v=0,C=!0,p=0,I=0;for(let o=0;b||C;o++){const r=e-o,m=e+o;o>1&&(r<1||r<t)&&(b=!1),o>1&&(m>i||m>n)&&(C=!1),o>5e4&&(b=!1,C=!1);let N=-1;if(b&&r>=1){const e=this._computeIndentLevel(r-1);e>=0?(a=r-1,u=e,N=Math.ceil(e/this.textModel.getOptions().indentSize)):(d(r),N=this._getIndentLevelForWhitespaceLine(s,l,u))}let M=-1;if(C&&m<=i){const e=this._computeIndentLevel(m-1);e>=0?(g=m-1,c=e,M=Math.ceil(e/this.textModel.getOptions().indentSize)):(f(m),M=this._getIndentLevelForWhitespaceLine(s,c,h))}if(0!==o){if(1===o){if(m<=i&&M>=0&&I+1===M){b=!1,L=m,v=m,p=M;continue}if(r>=1&&N>=0&&N-1===I){C=!1,L=r,v=r,p=N;continue}if(L=e,v=e,p=I,0===p)return{startLineNumber:L,endLineNumber:v,indent:p}}b&&(N>=p?L=r:b=!1),C&&(M>=p?v=m:C=!1)}else I=N}return{startLineNumber:L,endLineNumber:v,indent:p}}getLinesBracketGuides(e,t,n,i){var o,s,r,l,a;const u=[],d=this.textModel.bracketPairs.getBracketPairsInRangeWithMinIndentation(new Range(e,1,t,this.textModel.getLineMaxColumn(t)));let g;if(n&&d.length>0){const i=e<=n.lineNumber&&n.lineNumber<=t?d.filter((e=>Range.strictContainsPosition(e.range,n))):this.textModel.bracketPairs.getBracketPairsInRange(Range.fromPositions(n));g=null===(o=findLast(i,(e=>e.range.startLineNumber!==e.range.endLineNumber)))||void 0===o?void 0:o.range}const c=new ArrayQueue(d),m=new Array,h=new Array,f=new BracketPairGuidesClassNames;for(let n=e;n<=t;n++){let e=new Array;h.length>0&&(e=e.concat(h),h.length=0),u.push(e);for(const e of c.takeWhile((e=>e.openingBracketRange.startLineNumber<=n))||[]){if(e.range.startLineNumber===e.range.endLineNumber)continue;const t=Math.min(this.getVisibleColumnFromPosition(e.openingBracketRange.getStartPosition()),this.getVisibleColumnFromPosition(null!==(r=null===(s=e.closingBracketRange)||void 0===s?void 0:s.getStartPosition())&&void 0!==r?r:e.range.getEndPosition()),e.minVisibleColumnIndentation+1);let n=!1;if(e.closingBracketRange){strings.firstNonWhitespaceIndex(this.textModel.getLineContent(e.closingBracketRange.startLineNumber))<e.closingBracketRange.startColumn-1&&(n=!0)}const i=e.openingBracketRange.getStartPosition(),o=null!==(a=null===(l=e.closingBracketRange)||void 0===l?void 0:l.getStartPosition())&&void 0!==a?a:e.range.getEndPosition();void 0===e.closingBracketRange?m[e.nestingLevel]=null:m[e.nestingLevel]={nestingLevel:e.nestingLevel,guideVisibleColumn:t,start:i,visibleStartColumn:this.getVisibleColumnFromPosition(i),end:o,visibleEndColumn:this.getVisibleColumnFromPosition(o),bracketPair:e,renderHorizontalEndLineAtTheBottom:n}}for(const t of m){if(!t)continue;const o=g&&t.bracketPair.range.equalsRange(g),s=f.getInlineClassNameOfLevel(t.nestingLevel)+(i.highlightActive&&o?" "+f.activeClassName:"");(o&&i.horizontalGuides!==HorizontalGuidesState.Disabled||i.includeInactive&&i.horizontalGuides===HorizontalGuidesState.Enabled)&&(t.start.lineNumber===n&&t.guideVisibleColumn<t.visibleStartColumn&&e.push(new IndentGuide(t.guideVisibleColumn,s,new IndentGuideHorizontalLine(!1,t.start.column))),t.end.lineNumber===n+1&&t.guideVisibleColumn<t.visibleEndColumn&&h.push(new IndentGuide(t.guideVisibleColumn,s,new IndentGuideHorizontalLine(!t.renderHorizontalEndLineAtTheBottom,t.end.column))))}let t=Number.MAX_SAFE_INTEGER;for(let o=m.length-1;o>=0;o--){const s=m[o];if(!s)continue;const r=i.highlightActive&&g&&s.bracketPair.range.equalsRange(g),l=f.getInlineClassNameOfLevel(s.nestingLevel)+(r?" "+f.activeClassName:"");(r||i.includeInactive)&&s.renderHorizontalEndLineAtTheBottom&&s.end.lineNumber===n+1&&h.push(new IndentGuide(s.guideVisibleColumn,l,null)),s.end.lineNumber<=n||s.start.lineNumber>=n||(s.guideVisibleColumn>=t&&!r||(t=s.guideVisibleColumn,(r||i.includeInactive)&&e.push(new IndentGuide(s.guideVisibleColumn,l,null))))}e.sort(((e,t)=>e.visibleColumn-t.visibleColumn))}return u}getVisibleColumnFromPosition(e){return CursorColumns.visibleColumnFromColumn(this.textModel.getLineContent(e.lineNumber),e.column,this.textModel.getOptions().tabSize)+1}getLinesIndentGuides(e,t){this.assertNotDisposed();const n=this.textModel.getLineCount();if(e<1||e>n)throw new Error("Illegal value for startLineNumber");if(t<1||t>n)throw new Error("Illegal value for endLineNumber");const i=this.textModel.getOptions(),o=this.getLanguageConfiguration(this.textModel.getLanguageId()).foldingRules,s=Boolean(o&&o.offSide),r=new Array(t-e+1);let l=-2,a=-1,u=-2,d=-1;for(let o=e;o<=t;o++){const t=o-e,g=this._computeIndentLevel(o-1);if(g>=0)l=o-1,a=g,r[t]=Math.ceil(g/i.indentSize);else{if(-2===l){l=-1,a=-1;for(let e=o-2;e>=0;e--){const t=this._computeIndentLevel(e);if(t>=0){l=e,a=t;break}}}if(-1!==u&&(-2===u||u<o-1)){u=-1,d=-1;for(let e=o;e<n;e++){const t=this._computeIndentLevel(e);if(t>=0){u=e,d=t;break}}}r[t]=this._getIndentLevelForWhitespaceLine(s,a,d)}}return r}_getIndentLevelForWhitespaceLine(e,t,n){const i=this.textModel.getOptions();return-1===t||-1===n?0:t<n?1+Math.floor(t/i.indentSize):t===n||e?Math.ceil(n/i.indentSize):1+Math.floor(n/i.indentSize)}}export class BracketPairGuidesClassNames{constructor(){this.activeClassName="indent-active"}getInlineClassNameOfLevel(e){return"bracket-indent-guide lvl-"+e%30}}
//# sourceMappingURL=/sm/07566d68501c31669920d0fbf47a68027789313f5bde2eed232701ec97eacef9.map