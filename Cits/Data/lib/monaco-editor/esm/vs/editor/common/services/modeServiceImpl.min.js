/**
 * Minified by jsDelivr using Terser v5.7.1.
 * Original file: /npm/monaco-editor@0.27.0/esm/vs/editor/common/services/modeServiceImpl.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{Emitter}from"../../../base/common/event.js";import{Disposable}from"../../../base/common/lifecycle.js";import{FrankensteinMode}from"../modes/abstractMode.js";import{NULL_LANGUAGE_IDENTIFIER}from"../modes/nullMode.js";import{LanguagesRegistry}from"./languagesRegistry.js";import{firstOrDefault}from"../../../base/common/arrays.js";class LanguageSelection{constructor(e,t){let i;this._selector=t,this.languageIdentifier=this._selector(),this._onDidChange=new Emitter({onFirstListenerAdd:()=>{i=e((()=>this._evaluate()))},onLastListenerRemove:()=>{i.dispose()}}),this.onDidChange=this._onDidChange.event}_evaluate(){let e=this._selector();e.id!==this.languageIdentifier.id&&(this.languageIdentifier=e,this._onDidChange.fire(this.languageIdentifier))}}export class ModeServiceImpl extends Disposable{constructor(e=!1){super(),this._onDidCreateMode=this._register(new Emitter),this.onDidCreateMode=this._onDidCreateMode.event,this._onLanguagesMaybeChanged=this._register(new Emitter({leakWarningThreshold:200})),this.onLanguagesMaybeChanged=this._onLanguagesMaybeChanged.event,this._instantiatedModes={},this._registry=this._register(new LanguagesRegistry(!0,e)),this._register(this._registry.onDidChange((()=>this._onLanguagesMaybeChanged.fire())))}isRegisteredMode(e){return this._registry.isRegisteredMode(e)}getModeIdForLanguageName(e){return this._registry.getModeIdForLanguageNameLowercase(e)}getModeIdByFilepathOrFirstLine(e,t){const i=this._registry.getModeIdsFromFilepathOrFirstLine(e,t);return firstOrDefault(i,null)}getModeId(e){const t=this._registry.extractModeIds(e);return firstOrDefault(t,null)}getLanguageIdentifier(e){return this._registry.getLanguageIdentifier(e)}create(e){return new LanguageSelection(this.onLanguagesMaybeChanged,(()=>{const t=this.getModeId(e);return this._createModeAndGetLanguageIdentifier(t)}))}createByFilepathOrFirstLine(e,t){return new LanguageSelection(this.onLanguagesMaybeChanged,(()=>{const i=this.getModeIdByFilepathOrFirstLine(e,t);return this._createModeAndGetLanguageIdentifier(i)}))}_createModeAndGetLanguageIdentifier(e){const t=this.getLanguageIdentifier(e||"plaintext")||NULL_LANGUAGE_IDENTIFIER;return this._getOrCreateMode(t.language),t}triggerMode(e){const t=this.getModeId(e);this._getOrCreateMode(t||"plaintext")}_getOrCreateMode(e){if(!this._instantiatedModes.hasOwnProperty(e)){let t=this.getLanguageIdentifier(e)||NULL_LANGUAGE_IDENTIFIER;this._instantiatedModes[e]=new FrankensteinMode(t),this._onDidCreateMode.fire(this._instantiatedModes[e])}return this._instantiatedModes[e]}}
//# sourceMappingURL=/sm/1ba4dfa26174add92402daef285b38a4bd65cdc9adc8d8702cfb97d1eeeac42b.map