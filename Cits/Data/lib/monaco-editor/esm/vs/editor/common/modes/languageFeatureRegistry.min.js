/**
 * Minified by jsDelivr using Terser v5.7.1.
 * Original file: /npm/monaco-editor@0.27.0/esm/vs/editor/common/modes/languageFeatureRegistry.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{Emitter}from"../../../base/common/event.js";import{hash}from"../../../base/common/hash.js";import{toDisposable}from"../../../base/common/lifecycle.js";import{LRUCache}from"../../../base/common/map.js";import{MovingAverage}from"../../../base/common/numbers.js";import{score}from"./languageSelector.js";import{shouldSynchronizeModel}from"../services/modelService.js";function isExclusive(e){return"string"!=typeof e&&(Array.isArray(e)?e.every(isExclusive):!!e.exclusive)}export class LanguageFeatureRegistry{constructor(){this._clock=0,this._entries=[],this._onDidChange=new Emitter}get onDidChange(){return this._onDidChange.event}register(e,t){let r={selector:e,provider:t,_score:-1,_time:this._clock++};return this._entries.push(r),this._lastCandidate=void 0,this._onDidChange.fire(this._entries.length),toDisposable((()=>{if(r){let e=this._entries.indexOf(r);e>=0&&(this._entries.splice(e,1),this._lastCandidate=void 0,this._onDidChange.fire(this._entries.length),r=void 0)}}))}has(e){return this.all(e).length>0}all(e){if(!e)return[];this._updateScores(e);const t=[];for(let e of this._entries)e._score>0&&t.push(e.provider);return t}ordered(e){const t=[];return this._orderedForEach(e,(e=>t.push(e.provider))),t}orderedGroups(e){const t=[];let r,s;return this._orderedForEach(e,(e=>{r&&s===e._score?r.push(e.provider):(s=e._score,r=[e.provider],t.push(r))})),t}_orderedForEach(e,t){if(e){this._updateScores(e);for(const e of this._entries)e._score>0&&t(e)}}_updateScores(e){let t={uri:e.uri.toString(),language:e.getLanguageIdentifier().language};if(!this._lastCandidate||this._lastCandidate.language!==t.language||this._lastCandidate.uri!==t.uri){this._lastCandidate=t;for(let t of this._entries)if(t._score=score(t.selector,e.uri,e.getLanguageIdentifier().language,shouldSynchronizeModel(e)),isExclusive(t.selector)&&t._score>0){for(let e of this._entries)e._score=0;t._score=1e3;break}this._entries.sort(LanguageFeatureRegistry._compareByScoreAndTime)}}static _compareByScoreAndTime(e,t){return e._score<t._score?1:e._score>t._score?-1:e._time<t._time?1:e._time>t._time?-1:0}}export class LanguageFeatureRequestDelays{constructor(e,t,r=Number.MAX_SAFE_INTEGER){this._registry=e,this.min=t,this.max=r,this._cache=new LRUCache(50,.7)}_key(e){return e.id+hash(this._registry.all(e))}_clamp(e){return void 0===e?this.min:Math.min(this.max,Math.max(this.min,Math.floor(1.3*e)))}get(e){const t=this._key(e),r=this._cache.get(t);return this._clamp(null==r?void 0:r.value)}update(e,t){const r=this._key(e);let s=this._cache.get(r);return s||(s=new MovingAverage,this._cache.set(r,s)),s.update(t),this.get(e)}}
//# sourceMappingURL=/sm/a366b04a215c51771908570d2ffc60e77f5ba6c78107c7af5d0e401ed1b09813.map