/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/monaco-editor@0.33.0/esm/vs/editor/common/services/editorSimpleWorker.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function l(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}u((r=r.apply(e,t||[])).next())}))};import{stringDiff}from"../../../base/common/diff/diff.js";import{globals}from"../../../base/common/platform.js";import{URI}from"../../../base/common/uri.js";import{Position}from"../core/position.js";import{Range}from"../core/range.js";import{DiffComputer}from"../diff/diffComputer.js";import{MirrorTextModel as BaseMirrorModel}from"../model/mirrorTextModel.js";import{ensureValidWordDefinition,getWordAtText}from"../core/wordHelper.js";import{computeLinks}from"../languages/linkComputer.js";import{BasicInplaceReplace}from"../languages/supports/inplaceReplaceSupport.js";import{createMonacoBaseAPI}from"./editorBaseApi.js";import*as types from"../../../base/common/types.js";import{StopWatch}from"../../../base/common/stopwatch.js";import{UnicodeTextModelHighlighter}from"./unicodeTextModelHighlighter.js";export class MirrorModel extends BaseMirrorModel{get uri(){return this._uri}get eol(){return this._eol}getValue(){return this.getText()}getLinesContent(){return this._lines.slice(0)}getLineCount(){return this._lines.length}getLineContent(e){return this._lines[e-1]}getWordAtPosition(e,t){const n=getWordAtText(e.column,ensureValidWordDefinition(t),this._lines[e.lineNumber-1],0);return n?new Range(e.lineNumber,n.startColumn,e.lineNumber,n.endColumn):null}words(e){const t=this._lines,n=this._wordenize.bind(this);let r=0,o="",i=0,s=[];return{*[Symbol.iterator](){for(;;)if(i<s.length){const e=o.substring(s[i].start,s[i].end);i+=1,yield e}else{if(!(r<t.length))break;o=t[r],s=n(o,e),i=0,r+=1}}}}getLineWords(e,t){const n=this._lines[e-1],r=this._wordenize(n,t),o=[];for(const e of r)o.push({word:n.substring(e.start,e.end),startColumn:e.start+1,endColumn:e.end+1});return o}_wordenize(e,t){const n=[];let r;for(t.lastIndex=0;(r=t.exec(e))&&0!==r[0].length;)n.push({start:r.index,end:r.index+r[0].length});return n}getValueInRange(e){if((e=this._validateRange(e)).startLineNumber===e.endLineNumber)return this._lines[e.startLineNumber-1].substring(e.startColumn-1,e.endColumn-1);const t=this._eol,n=e.startLineNumber-1,r=e.endLineNumber-1,o=[];o.push(this._lines[n].substring(e.startColumn-1));for(let e=n+1;e<r;e++)o.push(this._lines[e]);return o.push(this._lines[r].substring(0,e.endColumn-1)),o.join(t)}offsetAt(e){return e=this._validatePosition(e),this._ensureLineStarts(),this._lineStarts.getPrefixSum(e.lineNumber-2)+(e.column-1)}positionAt(e){e=Math.floor(e),e=Math.max(0,e),this._ensureLineStarts();const t=this._lineStarts.getIndexOf(e),n=this._lines[t.index].length;return{lineNumber:1+t.index,column:1+Math.min(t.remainder,n)}}_validateRange(e){const t=this._validatePosition({lineNumber:e.startLineNumber,column:e.startColumn}),n=this._validatePosition({lineNumber:e.endLineNumber,column:e.endColumn});return t.lineNumber!==e.startLineNumber||t.column!==e.startColumn||n.lineNumber!==e.endLineNumber||n.column!==e.endColumn?{startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:n.lineNumber,endColumn:n.column}:e}_validatePosition(e){if(!Position.isIPosition(e))throw new Error("bad position");let{lineNumber:t,column:n}=e,r=!1;if(t<1)t=1,n=1,r=!0;else if(t>this._lines.length)t=this._lines.length,n=this._lines[t-1].length+1,r=!0;else{const e=this._lines[t-1].length+1;n<1?(n=1,r=!0):n>e&&(n=e,r=!0)}return r?{lineNumber:t,column:n}:e}}export class EditorSimpleWorker{constructor(e,t){this._host=e,this._models=Object.create(null),this._foreignModuleFactory=t,this._foreignModule=null}dispose(){this._models=Object.create(null)}_getModel(e){return this._models[e]}_getModels(){const e=[];return Object.keys(this._models).forEach((t=>e.push(this._models[t]))),e}acceptNewModel(e){this._models[e.url]=new MirrorModel(URI.parse(e.url),e.lines,e.EOL,e.versionId)}acceptModelChanged(e,t){if(!this._models[e])return;this._models[e].onEvents(t)}acceptRemovedModel(e){this._models[e]&&delete this._models[e]}computeUnicodeHighlights(e,t,n){return __awaiter(this,void 0,void 0,(function*(){const r=this._getModel(e);return r?UnicodeTextModelHighlighter.computeUnicodeHighlights(r,t,n):{ranges:[],hasMore:!1,ambiguousCharacterCount:0,invisibleCharacterCount:0,nonBasicAsciiCharacterCount:0}}))}computeDiff(e,t,n,r){return __awaiter(this,void 0,void 0,(function*(){const o=this._getModel(e),i=this._getModel(t);if(!o||!i)return null;const s=o.getLinesContent(),l=i.getLinesContent(),u=new DiffComputer(s,l,{shouldComputeCharChanges:!0,shouldPostProcessCharChanges:!0,shouldIgnoreTrimWhitespace:n,shouldMakePrettyDiff:!0,maxComputationTime:r}).computeDiff(),a=!(u.changes.length>0)&&this._modelsAreIdentical(o,i);return{quitEarly:u.quitEarly,identical:a,changes:u.changes}}))}_modelsAreIdentical(e,t){const n=e.getLineCount();if(n!==t.getLineCount())return!1;for(let r=1;r<=n;r++){if(e.getLineContent(r)!==t.getLineContent(r))return!1}return!0}computeMoreMinimalEdits(e,t){return __awaiter(this,void 0,void 0,(function*(){const n=this._getModel(e);if(!n)return t;const r=[];let o;t=t.slice(0).sort(((e,t)=>{if(e.range&&t.range)return Range.compareRangesUsingStarts(e.range,t.range);return(e.range?0:1)-(t.range?0:1)}));for(let{range:e,text:i,eol:s}of t){if("number"==typeof s&&(o=s),Range.isEmpty(e)&&!i)continue;const t=n.getValueInRange(e);if(i=i.replace(/\r\n|\n|\r/g,n.eol),t===i)continue;if(Math.max(i.length,t.length)>EditorSimpleWorker._diffLimit){r.push({range:e,text:i});continue}const l=stringDiff(t,i,!1),u=n.offsetAt(Range.lift(e).getStartPosition());for(const e of l){const t=n.positionAt(u+e.originalStart),o=n.positionAt(u+e.originalStart+e.originalLength),s={text:i.substr(e.modifiedStart,e.modifiedLength),range:{startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:o.lineNumber,endColumn:o.column}};n.getValueInRange(s.range)!==s.text&&r.push(s)}}return"number"==typeof o&&r.push({eol:o,text:"",range:{startLineNumber:0,startColumn:0,endLineNumber:0,endColumn:0}}),r}))}computeLinks(e){return __awaiter(this,void 0,void 0,(function*(){const t=this._getModel(e);return t?computeLinks(t):null}))}textualSuggest(e,t,n,r){return __awaiter(this,void 0,void 0,(function*(){const o=new StopWatch(!0),i=new RegExp(n,r),s=new Set;e:for(let n of e){const e=this._getModel(n);if(e)for(let n of e.words(i))if(n!==t&&isNaN(Number(n))&&(s.add(n),s.size>EditorSimpleWorker._suggestionsLimit))break e}return{words:Array.from(s),duration:o.elapsed()}}))}computeWordRanges(e,t,n,r){return __awaiter(this,void 0,void 0,(function*(){const o=this._getModel(e);if(!o)return Object.create(null);const i=new RegExp(n,r),s=Object.create(null);for(let e=t.startLineNumber;e<t.endLineNumber;e++){const t=o.getLineWords(e,i);for(const n of t){if(!isNaN(Number(n.word)))continue;let t=s[n.word];t||(t=[],s[n.word]=t),t.push({startLineNumber:e,startColumn:n.startColumn,endLineNumber:e,endColumn:n.endColumn})}}return s}))}navigateValueSet(e,t,n,r,o){return __awaiter(this,void 0,void 0,(function*(){const i=this._getModel(e);if(!i)return null;const s=new RegExp(r,o);t.startColumn===t.endColumn&&(t={startLineNumber:t.startLineNumber,startColumn:t.startColumn,endLineNumber:t.endLineNumber,endColumn:t.endColumn+1});const l=i.getValueInRange(t),u=i.getWordAtPosition({lineNumber:t.startLineNumber,column:t.startColumn},s);if(!u)return null;const a=i.getValueInRange(u);return BasicInplaceReplace.INSTANCE.navigateValueSet(t,l,u,a,n)}))}loadForeignModule(e,t,n){const r={host:types.createProxyObject(n,((e,t)=>this._host.fhr(e,t))),getMirrorModels:()=>this._getModels()};return this._foreignModuleFactory?(this._foreignModule=this._foreignModuleFactory(r,t),Promise.resolve(types.getAllMethodNames(this._foreignModule))):Promise.reject(new Error("Unexpected usage"))}fmr(e,t){if(!this._foreignModule||"function"!=typeof this._foreignModule[e])return Promise.reject(new Error("Missing requestHandler or method: "+e));try{return Promise.resolve(this._foreignModule[e].apply(this._foreignModule,t))}catch(e){return Promise.reject(e)}}}EditorSimpleWorker._diffLimit=1e5,EditorSimpleWorker._suggestionsLimit=1e4;export function create(e){return new EditorSimpleWorker(e,null)}"function"==typeof importScripts&&(globals.monaco=createMonacoBaseAPI());
//# sourceMappingURL=/sm/d9d6b348dc529113472f041b7d46892fec72a7cb6c685713f391bdd582f5c4e0.map