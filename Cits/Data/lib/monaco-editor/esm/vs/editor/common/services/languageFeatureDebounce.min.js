/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/monaco-editor@0.33.0/esm/vs/editor/common/services/languageFeatureDebounce.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var IdentityHash,__decorate=this&&this.__decorate||function(e,t,a,o){var r,n=arguments.length,i=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,a):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,a,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(i=(n<3?r(i):n>3?r(t,a,i):r(t,a))||i);return n>3&&i&&Object.defineProperty(t,a,i),i},__param=this&&this.__param||function(e,t){return function(a,o){t(a,o,e)}};import{doHash}from"../../../base/common/hash.js";import{LRUCache}from"../../../base/common/map.js";import{clamp,MovingAverage,SlidingWindowAverage}from"../../../base/common/numbers.js";import{registerSingleton}from"../../../platform/instantiation/common/extensions.js";import{createDecorator}from"../../../platform/instantiation/common/instantiation.js";import{ILogService}from"../../../platform/log/common/log.js";export const ILanguageFeatureDebounceService=createDecorator("ILanguageFeatureDebounceService");!function(e){const t=new WeakMap;let a=0;e.of=function(e){let o=t.get(e);return void 0===o&&(o=++a,t.set(e,o)),o}}(IdentityHash||(IdentityHash={}));class FeatureDebounceInformation{constructor(e,t,a,o,r,n){this._logService=e,this._name=t,this._registry=a,this._default=o,this._min=r,this._max=n,this._cache=new LRUCache(50,.7)}_key(e){return e.id+this._registry.all(e).reduce(((e,t)=>doHash(IdentityHash.of(t),e)),0)}get(e){const t=this._key(e),a=this._cache.get(t);return a?clamp(a.value,this._min,this._max):this.default()}update(e,t){const a=this._key(e);let o=this._cache.get(a);o||(o=new SlidingWindowAverage(6),this._cache.set(a,o));const r=clamp(o.update(t),this._min,this._max);return this._logService.trace(`[DEBOUNCE: ${this._name}] for ${e.uri.toString()} is ${r}ms`),r}_overall(){const e=new MovingAverage;for(const[,t]of this._cache)e.update(t.value);return e.value}default(){const e=0|this._overall()||this._default;return clamp(e,this._min,this._max)}}let LanguageFeatureDebounceService=class{constructor(e){this._logService=e,this._data=new Map}for(e,t,a){var o,r,n;const i=null!==(o=null==a?void 0:a.min)&&void 0!==o?o:50,s=null!==(r=null==a?void 0:a.max)&&void 0!==r?r:Math.pow(i,2),c=null!==(n=null==a?void 0:a.key)&&void 0!==n?n:void 0,u=`${IdentityHash.of(e)},${i}${c?","+c:""}`;let l=this._data.get(u);return l||(l=new FeatureDebounceInformation(this._logService,t,e,0|this._overallAverage()||1.5*i,i,s),this._data.set(u,l)),l}_overallAverage(){let e=new MovingAverage;for(let t of this._data.values())e.update(t.default());return e.value}};LanguageFeatureDebounceService=__decorate([__param(0,ILogService)],LanguageFeatureDebounceService);export{LanguageFeatureDebounceService};registerSingleton(ILanguageFeatureDebounceService,LanguageFeatureDebounceService,!0);
//# sourceMappingURL=/sm/77af49d5812dd702a609c955f8edf3dbc9fba01fd66c0b62e8653899f5088914.map