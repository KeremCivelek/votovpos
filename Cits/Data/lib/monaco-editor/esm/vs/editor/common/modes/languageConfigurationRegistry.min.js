/**
 * Minified by jsDelivr using Terser v5.7.1.
 * Original file: /npm/monaco-editor@0.27.0/esm/vs/editor/common/modes/languageConfigurationRegistry.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{Emitter}from"../../../base/common/event.js";import{toDisposable}from"../../../base/common/lifecycle.js";import*as strings from"../../../base/common/strings.js";import{DEFAULT_WORD_REGEXP,ensureValidWordDefinition}from"../model/wordHelper.js";import{IndentAction,AutoClosingPairs}from"./languageConfiguration.js";import{createScopedLineTokens}from"./supports.js";import{CharacterPairSupport}from"./supports/characterPair.js";import{BracketElectricCharacterSupport}from"./supports/electricCharacter.js";import{IndentRulesSupport}from"./supports/indentRules.js";import{OnEnterSupport}from"./supports/onEnter.js";import{RichEditBrackets}from"./supports/richEditBrackets.js";export class RichEditSupport{constructor(t,e){this._languageIdentifier=t,this._brackets=null,this._electricCharacter=null,this._conf=e,this._onEnterSupport=this._conf.brackets||this._conf.indentationRules||this._conf.onEnterRules?new OnEnterSupport(this._conf):null,this.comments=RichEditSupport._handleComments(this._conf),this.characterPair=new CharacterPairSupport(this._conf),this.wordDefinition=this._conf.wordPattern||DEFAULT_WORD_REGEXP,this.indentationRules=this._conf.indentationRules,this._conf.indentationRules?this.indentRulesSupport=new IndentRulesSupport(this._conf.indentationRules):this.indentRulesSupport=null,this.foldingRules=this._conf.folding||{}}get brackets(){return!this._brackets&&this._conf.brackets&&(this._brackets=new RichEditBrackets(this._languageIdentifier,this._conf.brackets)),this._brackets}get electricCharacter(){return this._electricCharacter||(this._electricCharacter=new BracketElectricCharacterSupport(this.brackets)),this._electricCharacter}onEnter(t,e,n,i){return this._onEnterSupport?this._onEnterSupport.onEnter(t,e,n,i):null}static _handleComments(t){let e=t.comments;if(!e)return null;let n={};if(e.lineComment&&(n.lineCommentToken=e.lineComment),e.blockComment){let[t,i]=e.blockComment;n.blockCommentStartToken=t,n.blockCommentEndToken=i}return n}}export class LanguageConfigurationChangeEvent{constructor(t){this.languageIdentifier=t}}class LanguageConfigurationEntry{constructor(t,e,n){this.configuration=t,this.priority=e,this.order=n}static cmp(t,e){return t.priority===e.priority?t.order-e.order:t.priority-e.priority}}class LanguageConfigurationEntries{constructor(t){this.languageIdentifier=t,this._resolved=null,this._entries=[],this._order=0,this._resolved=null}register(t,e){const n=new LanguageConfigurationEntry(t,e,++this._order);return this._entries.push(n),this._resolved=null,toDisposable((()=>{for(let t=0;t<this._entries.length;t++)if(this._entries[t]===n){this._entries.splice(t,1),this._resolved=null;break}}))}getRichEditSupport(){if(!this._resolved){const t=this._resolve();t&&(this._resolved=new RichEditSupport(this.languageIdentifier,t))}return this._resolved}_resolve(){if(0===this._entries.length)return null;this._entries.sort(LanguageConfigurationEntry.cmp);const t={};for(const e of this._entries){const n=e.configuration;t.comments=n.comments||t.comments,t.brackets=n.brackets||t.brackets,t.wordPattern=n.wordPattern||t.wordPattern,t.indentationRules=n.indentationRules||t.indentationRules,t.onEnterRules=n.onEnterRules||t.onEnterRules,t.autoClosingPairs=n.autoClosingPairs||t.autoClosingPairs,t.surroundingPairs=n.surroundingPairs||t.surroundingPairs,t.autoCloseBefore=n.autoCloseBefore||t.autoCloseBefore,t.folding=n.folding||t.folding,t.__electricCharacterSupport=n.__electricCharacterSupport||t.__electricCharacterSupport}return t}}export class LanguageConfigurationRegistryImpl{constructor(){this._entries2=new Map,this._onDidChange=new Emitter,this.onDidChange=this._onDidChange.event}register(t,e,n=0){let i=this._entries2.get(t.id);i||(i=new LanguageConfigurationEntries(t),this._entries2.set(t.id,i));const r=i.register(e,n);return this._onDidChange.fire(new LanguageConfigurationChangeEvent(t)),toDisposable((()=>{r.dispose(),this._onDidChange.fire(new LanguageConfigurationChangeEvent(t))}))}_getRichEditSupport(t){const e=this._entries2.get(t);return e?e.getRichEditSupport():null}getIndentationRules(t){const e=this._getRichEditSupport(t);return e&&e.indentationRules||null}_getElectricCharacterSupport(t){let e=this._getRichEditSupport(t);return e&&e.electricCharacter||null}getElectricCharacters(t){let e=this._getElectricCharacterSupport(t);return e?e.getElectricCharacters():[]}onElectricCharacter(t,e,n){let i=createScopedLineTokens(e,n-1),r=this._getElectricCharacterSupport(i.languageId);return r?r.onElectricCharacter(t,i,n-i.firstCharOffset):null}getComments(t){let e=this._getRichEditSupport(t);return e&&e.comments||null}_getCharacterPairSupport(t){let e=this._getRichEditSupport(t);return e&&e.characterPair||null}getAutoClosingPairs(t){const e=this._getCharacterPairSupport(t);return new AutoClosingPairs(e?e.getAutoClosingPairs():[])}getAutoCloseBeforeSet(t){let e=this._getCharacterPairSupport(t);return e?e.getAutoCloseBeforeSet():CharacterPairSupport.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED}getSurroundingPairs(t){let e=this._getCharacterPairSupport(t);return e?e.getSurroundingPairs():[]}shouldAutoClosePair(t,e,n){const i=createScopedLineTokens(e,n-1);return CharacterPairSupport.shouldAutoClosePair(t,i,n-i.firstCharOffset)}getWordDefinition(t){let e=this._getRichEditSupport(t);return ensureValidWordDefinition(e&&e.wordDefinition||null)}getFoldingRules(t){let e=this._getRichEditSupport(t);return e?e.foldingRules:{}}getIndentRulesSupport(t){let e=this._getRichEditSupport(t);return e&&e.indentRulesSupport||null}getPrecedingValidLine(t,e,n){let i=t.getLanguageIdAtPosition(e,0);if(e>1){let r,o=-1;for(r=e-1;r>=1;r--){if(t.getLanguageIdAtPosition(r,0)!==i)return o;let e=t.getLineContent(r);if(!n.shouldIgnore(e)&&!/^\s+$/.test(e)&&""!==e)return r;o=r}}return-1}getInheritIndentForLine(t,e,n,i=!0){if(t<4)return null;const r=this.getIndentRulesSupport(e.getLanguageIdentifier().id);if(!r)return null;if(n<=1)return{indentation:"",action:null};const o=this.getPrecedingValidLine(e,n,r);if(o<0)return null;if(o<1)return{indentation:"",action:null};const s=e.getLineContent(o);if(r.shouldIncrease(s)||r.shouldIndentNextLine(s))return{indentation:strings.getLeadingWhitespace(s),action:IndentAction.Indent,line:o};if(r.shouldDecrease(s))return{indentation:strings.getLeadingWhitespace(s),action:null,line:o};{if(1===o)return{indentation:strings.getLeadingWhitespace(e.getLineContent(o)),action:null,line:o};const t=o-1,n=r.getIndentMetadata(e.getLineContent(t));if(!(3&n)&&4&n){let n=0;for(let i=t-1;i>0;i--)if(!r.shouldIndentNextLine(e.getLineContent(i))){n=i;break}return{indentation:strings.getLeadingWhitespace(e.getLineContent(n+1)),action:null,line:n+1}}if(i)return{indentation:strings.getLeadingWhitespace(e.getLineContent(o)),action:null,line:o};for(let t=o;t>0;t--){const n=e.getLineContent(t);if(r.shouldIncrease(n))return{indentation:strings.getLeadingWhitespace(n),action:IndentAction.Indent,line:t};if(r.shouldIndentNextLine(n)){let n=0;for(let i=t-1;i>0;i--)if(!r.shouldIndentNextLine(e.getLineContent(t))){n=i;break}return{indentation:strings.getLeadingWhitespace(e.getLineContent(n+1)),action:null,line:n+1}}if(r.shouldDecrease(n))return{indentation:strings.getLeadingWhitespace(n),action:null,line:t}}return{indentation:strings.getLeadingWhitespace(e.getLineContent(1)),action:null,line:1}}}getGoodIndentForLine(t,e,n,i,r){if(t<4)return null;const o=this._getRichEditSupport(n);if(!o)return null;const s=this.getIndentRulesSupport(n);if(!s)return null;const a=this.getInheritIndentForLine(t,e,i),u=e.getLineContent(i);if(a){const n=a.line;if(void 0!==n){const i=o.onEnter(t,"",e.getLineContent(n),"");if(i){let t=strings.getLeadingWhitespace(e.getLineContent(n));return i.removeText&&(t=t.substring(0,t.length-i.removeText)),i.indentAction===IndentAction.Indent||i.indentAction===IndentAction.IndentOutdent?t=r.shiftIndent(t):i.indentAction===IndentAction.Outdent&&(t=r.unshiftIndent(t)),s.shouldDecrease(u)&&(t=r.unshiftIndent(t)),i.appendText&&(t+=i.appendText),strings.getLeadingWhitespace(t)}}return s.shouldDecrease(u)?a.action===IndentAction.Indent?a.indentation:r.unshiftIndent(a.indentation):a.action===IndentAction.Indent?r.shiftIndent(a.indentation):a.indentation}return null}getIndentForEnter(t,e,n,i){if(t<4)return null;e.forceTokenization(n.startLineNumber);const r=e.getLineTokens(n.startLineNumber),o=createScopedLineTokens(r,n.startColumn-1),s=o.getLineContent();let a,u,l=!1;if(o.firstCharOffset>0&&r.getLanguageId(0)!==o.languageId?(l=!0,a=s.substr(0,n.startColumn-1-o.firstCharOffset)):a=r.getLineContent().substring(0,n.startColumn-1),n.isEmpty())u=s.substr(n.startColumn-1-o.firstCharOffset);else{u=this.getScopedLineTokens(e,n.endLineNumber,n.endColumn).getLineContent().substr(n.endColumn-1-o.firstCharOffset)}const c=this.getIndentRulesSupport(o.languageId);if(!c)return null;const g=a,d=strings.getLeadingWhitespace(a),h={getLineTokens:t=>e.getLineTokens(t),getLanguageIdentifier:()=>e.getLanguageIdentifier(),getLanguageIdAtPosition:(t,n)=>e.getLanguageIdAtPosition(t,n),getLineContent:t=>t===n.startLineNumber?g:e.getLineContent(t)},p=strings.getLeadingWhitespace(r.getLineContent()),f=this.getInheritIndentForLine(t,h,n.startLineNumber+1);if(!f){const t=l?p:d;return{beforeEnter:t,afterEnter:t}}let C=l?p:f.indentation;return f.action===IndentAction.Indent&&(C=i.shiftIndent(C)),c.shouldDecrease(u)&&(C=i.unshiftIndent(C)),{beforeEnter:l?p:d,afterEnter:C}}getIndentActionForType(t,e,n,i,r){if(t<4)return null;const o=this.getScopedLineTokens(e,n.startLineNumber,n.startColumn);if(o.firstCharOffset)return null;const s=this.getIndentRulesSupport(o.languageId);if(!s)return null;const a=o.getLineContent(),u=a.substr(0,n.startColumn-1-o.firstCharOffset);let l;if(n.isEmpty())l=a.substr(n.startColumn-1-o.firstCharOffset);else{l=this.getScopedLineTokens(e,n.endLineNumber,n.endColumn).getLineContent().substr(n.endColumn-1-o.firstCharOffset)}if(!s.shouldDecrease(u+l)&&s.shouldDecrease(u+i+l)){const i=this.getInheritIndentForLine(t,e,n.startLineNumber,!1);if(!i)return null;let o=i.indentation;return i.action!==IndentAction.Indent&&(o=r.unshiftIndent(o)),o}return null}getIndentMetadata(t,e){const n=this.getIndentRulesSupport(t.getLanguageIdentifier().id);return n?e<1||e>t.getLineCount()?null:n.getIndentMetadata(t.getLineContent(e)):null}getEnterAction(t,e,n){const i=this.getScopedLineTokens(e,n.startLineNumber,n.startColumn),r=this._getRichEditSupport(i.languageId);if(!r)return null;const o=i.getLineContent(),s=o.substr(0,n.startColumn-1-i.firstCharOffset);let a;if(n.isEmpty())a=o.substr(n.startColumn-1-i.firstCharOffset);else{a=this.getScopedLineTokens(e,n.endLineNumber,n.endColumn).getLineContent().substr(n.endColumn-1-i.firstCharOffset)}let u="";if(n.startLineNumber>1&&0===i.firstCharOffset){const t=this.getScopedLineTokens(e,n.startLineNumber-1);t.languageId===i.languageId&&(u=t.getLineContent())}const l=r.onEnter(t,u,s,a);if(!l)return null;const c=l.indentAction;let g=l.appendText;const d=l.removeText||0;g?c===IndentAction.Indent&&(g="\t"+g):g=c===IndentAction.Indent||c===IndentAction.IndentOutdent?"\t":"";let h=this.getIndentationAtPosition(e,n.startLineNumber,n.startColumn);return d&&(h=h.substring(0,h.length-d)),{indentAction:c,appendText:g,removeText:d,indentation:h}}getIndentationAtPosition(t,e,n){const i=t.getLineContent(e);let r=strings.getLeadingWhitespace(i);return r.length>n-1&&(r=r.substring(0,n-1)),r}getScopedLineTokens(t,e,n){t.forceTokenization(e);const i=t.getLineTokens(e),r=void 0===n?t.getLineMaxColumn(e)-1:n-1;return createScopedLineTokens(i,r)}getBracketsSupport(t){const e=this._getRichEditSupport(t);return e&&e.brackets||null}}export const LanguageConfigurationRegistry=new LanguageConfigurationRegistryImpl;
//# sourceMappingURL=/sm/ef57553a9d891d6936cec684437570aa18de52b855550e8eece1ab248e9819de.map