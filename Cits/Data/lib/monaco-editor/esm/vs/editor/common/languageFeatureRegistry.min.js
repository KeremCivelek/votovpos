/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/monaco-editor@0.33.0/esm/vs/editor/common/languageFeatureRegistry.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{Emitter}from"../../base/common/event.js";import{toDisposable}from"../../base/common/lifecycle.js";import{shouldSynchronizeModel}from"./model.js";import{score}from"./languageSelector.js";function isExclusive(e){return"string"!=typeof e&&(Array.isArray(e)?e.every(isExclusive):!!e.exclusive)}export class LanguageFeatureRegistry{constructor(e){this._notebookTypeResolver=e,this._clock=0,this._entries=[],this._onDidChange=new Emitter,this.onDidChange=this._onDidChange.event}register(e,t){let r={selector:e,provider:t,_score:-1,_time:this._clock++};return this._entries.push(r),this._lastCandidate=void 0,this._onDidChange.fire(this._entries.length),toDisposable((()=>{if(r){const e=this._entries.indexOf(r);e>=0&&(this._entries.splice(e,1),this._lastCandidate=void 0,this._onDidChange.fire(this._entries.length),r=void 0)}}))}has(e){return this.all(e).length>0}all(e){if(!e)return[];this._updateScores(e);const t=[];for(let e of this._entries)e._score>0&&t.push(e.provider);return t}ordered(e){const t=[];return this._orderedForEach(e,(e=>t.push(e.provider))),t}orderedGroups(e){const t=[];let r,s;return this._orderedForEach(e,(e=>{r&&s===e._score?r.push(e.provider):(s=e._score,r=[e.provider],t.push(r))})),t}_orderedForEach(e,t){if(e){this._updateScores(e);for(const e of this._entries)e._score>0&&t(e)}}_updateScores(e){var t;const r=null===(t=this._notebookTypeResolver)||void 0===t?void 0:t.call(this,e.uri),s={uri:e.uri.toString(),language:e.getLanguageId(),notebookType:r};if(!this._lastCandidate||this._lastCandidate.language!==s.language||this._lastCandidate.uri!==s.uri||this._lastCandidate.notebookType!==s.notebookType){this._lastCandidate=s;for(let t of this._entries)if(t._score=score(t.selector,e.uri,e.getLanguageId(),shouldSynchronizeModel(e),r),isExclusive(t.selector)&&t._score>0){for(let e of this._entries)e._score=0;t._score=1e3;break}this._entries.sort(LanguageFeatureRegistry._compareByScoreAndTime)}}static _compareByScoreAndTime(e,t){return e._score<t._score?1:e._score>t._score?-1:e._time<t._time?1:e._time>t._time?-1:0}}
//# sourceMappingURL=/sm/f37c7a9f0393bfb2e22c276965219ea9af6e66ccdcbbec2b47e0008d5e2e37b6.map