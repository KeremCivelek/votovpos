/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/monaco-editor@0.33.0/esm/vs/editor/common/viewLayout/viewLineRenderer.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as strings from"../../../base/common/strings.js";import{createStringBuilder}from"../core/stringBuilder.js";import{LineDecoration,LineDecorationsNormalizer}from"./lineDecorations.js";class LinePart{constructor(e,t,n){this._linePartBrand=void 0,this.endIndex=e,this.type=t,this.metadata=n}isWhitespace(){return!!(1&this.metadata)}isPseudoAfter(){return!!(4&this.metadata)}}export class LineRange{constructor(e,t){this.startOffset=e,this.endOffset=t}equals(e){return this.startOffset===e.startOffset&&this.endOffset===e.endOffset}}export class RenderLineInput{constructor(e,t,n,r,i,s,a,o,c,h,l,d,p,f,u,g,C,I,L){this.useMonospaceOptimizations=e,this.canUseHalfwidthRightwardsArrow=t,this.lineContent=n,this.continuesWithWrappedLine=r,this.isBasicASCII=i,this.containsRTL=s,this.fauxIndentLength=a,this.lineTokens=o,this.lineDecorations=c.sort(LineDecoration.compare),this.tabSize=h,this.startVisibleColumn=l,this.spaceWidth=d,this.stopRenderingLineAfter=u,this.renderWhitespace="all"===g?4:"boundary"===g?1:"selection"===g?2:"trailing"===g?3:0,this.renderControlCharacters=C,this.fontLigatures=I,this.selectionsOnLine=L&&L.sort(((e,t)=>e.startOffset<t.startOffset?-1:1));Math.abs(f-d)<Math.abs(p-d)?(this.renderSpaceWidth=f,this.renderSpaceCharCode=11825):(this.renderSpaceWidth=p,this.renderSpaceCharCode=183)}sameSelection(e){if(null===this.selectionsOnLine)return null===e;if(null===e)return!1;if(e.length!==this.selectionsOnLine.length)return!1;for(let t=0;t<this.selectionsOnLine.length;t++)if(!this.selectionsOnLine[t].equals(e[t]))return!1;return!0}equals(e){return this.useMonospaceOptimizations===e.useMonospaceOptimizations&&this.canUseHalfwidthRightwardsArrow===e.canUseHalfwidthRightwardsArrow&&this.lineContent===e.lineContent&&this.continuesWithWrappedLine===e.continuesWithWrappedLine&&this.isBasicASCII===e.isBasicASCII&&this.containsRTL===e.containsRTL&&this.fauxIndentLength===e.fauxIndentLength&&this.tabSize===e.tabSize&&this.startVisibleColumn===e.startVisibleColumn&&this.spaceWidth===e.spaceWidth&&this.renderSpaceWidth===e.renderSpaceWidth&&this.renderSpaceCharCode===e.renderSpaceCharCode&&this.stopRenderingLineAfter===e.stopRenderingLineAfter&&this.renderWhitespace===e.renderWhitespace&&this.renderControlCharacters===e.renderControlCharacters&&this.fontLigatures===e.fontLigatures&&LineDecoration.equalsArr(this.lineDecorations,e.lineDecorations)&&this.lineTokens.equals(e.lineTokens)&&this.sameSelection(e.selectionsOnLine)}}export class DomPosition{constructor(e,t){this.partIndex=e,this.charIndex=t}}export class CharacterMapping{constructor(e,t){this.length=e,this._data=new Uint32Array(this.length),this._absoluteOffsets=new Uint32Array(this.length)}static getPartIndex(e){return(4294901760&e)>>>16}static getCharIndex(e){return(65535&e)>>>0}setColumnInfo(e,t,n,r){const i=(t<<16|n<<0)>>>0;this._data[e-1]=i,this._absoluteOffsets[e-1]=r+n}getAbsoluteOffset(e){return 0===this._absoluteOffsets.length?0:this._absoluteOffsets[e-1]}charOffsetToPartData(e){return 0===this.length?0:e<0?this._data[0]:e>=this.length?this._data[this.length-1]:this._data[e]}getDomPosition(e){const t=this.charOffsetToPartData(e-1),n=CharacterMapping.getPartIndex(t),r=CharacterMapping.getCharIndex(t);return new DomPosition(n,r)}getColumn(e,t){return this.partDataToCharOffset(e.partIndex,t,e.charIndex)+1}partDataToCharOffset(e,t,n){if(0===this.length)return 0;const r=(e<<16|n<<0)>>>0;let i=0,s=this.length-1;for(;i+1<s;){const e=i+s>>>1,t=this._data[e];if(t===r)return e;t>r?s=e:i=e}if(i===s)return i;const a=this._data[i],o=this._data[s];if(a===r)return i;if(o===r)return s;const c=CharacterMapping.getPartIndex(a),h=CharacterMapping.getCharIndex(a);let l;l=c!==CharacterMapping.getPartIndex(o)?t:CharacterMapping.getCharIndex(o);return n-h<=l-n?i:s}}export class RenderLineOutput{constructor(e,t,n){this._renderLineOutputBrand=void 0,this.characterMapping=e,this.containsRTL=t,this.containsForeignElements=n}}export function renderViewLine(e,t){if(0===e.lineContent.length){if(e.lineDecorations.length>0){t.appendASCIIString("<span>");let n=0,r=0,i=0;for(const s of e.lineDecorations)1!==s.type&&2!==s.type||(t.appendASCIIString('<span class="'),t.appendASCIIString(s.className),t.appendASCIIString('"></span>'),1===s.type&&(i|=1,n++),2===s.type&&(i|=2,r++));t.appendASCIIString("</span>");const s=new CharacterMapping(1,n+r);return s.setColumnInfo(1,n,0,0),new RenderLineOutput(s,!1,i)}return t.appendASCIIString("<span><span></span></span>"),new RenderLineOutput(new CharacterMapping(0,0),!1,0)}return _renderLine(resolveRenderLineInput(e),t)}export class RenderLineOutput2{constructor(e,t,n,r){this.characterMapping=e,this.html=t,this.containsRTL=n,this.containsForeignElements=r}}export function renderViewLine2(e){const t=createStringBuilder(1e4),n=renderViewLine(e,t);return new RenderLineOutput2(n.characterMapping,t.build(),n.containsRTL,n.containsForeignElements)}class ResolvedRenderLineInput{constructor(e,t,n,r,i,s,a,o,c,h,l,d,p,f,u){this.fontIsMonospace=e,this.canUseHalfwidthRightwardsArrow=t,this.lineContent=n,this.len=r,this.isOverflowing=i,this.parts=s,this.containsForeignElements=a,this.fauxIndentLength=o,this.tabSize=c,this.startVisibleColumn=h,this.containsRTL=l,this.spaceWidth=d,this.renderSpaceCharCode=p,this.renderWhitespace=f,this.renderControlCharacters=u}}function resolveRenderLineInput(e){const t=e.lineContent;let n,r;-1!==e.stopRenderingLineAfter&&e.stopRenderingLineAfter<t.length?(n=!0,r=e.stopRenderingLineAfter):(n=!1,r=t.length);let i=transformAndRemoveOverflowing(e.lineTokens,e.fauxIndentLength,r);e.renderControlCharacters&&!e.isBasicASCII&&(i=extractControlCharacters(t,i)),(4===e.renderWhitespace||1===e.renderWhitespace||2===e.renderWhitespace&&e.selectionsOnLine||3===e.renderWhitespace)&&(i=_applyRenderWhitespace(e,t,r,i));let s=0;if(e.lineDecorations.length>0){for(let t=0,n=e.lineDecorations.length;t<n;t++){const n=e.lineDecorations[t];3===n.type||1===n.type?s|=1:2===n.type&&(s|=2)}i=_applyInlineDecorations(t,r,i,e.lineDecorations)}return e.containsRTL||(i=splitLargeTokens(t,i,!e.isBasicASCII||e.fontLigatures)),new ResolvedRenderLineInput(e.useMonospaceOptimizations,e.canUseHalfwidthRightwardsArrow,t,r,n,i,s,e.fauxIndentLength,e.tabSize,e.startVisibleColumn,e.containsRTL,e.spaceWidth,e.renderSpaceCharCode,e.renderWhitespace,e.renderControlCharacters)}function transformAndRemoveOverflowing(e,t,n){const r=[];let i=0;t>0&&(r[i++]=new LinePart(t,"",0));for(let s=0,a=e.getCount();s<a;s++){const a=e.getEndOffset(s);if(a<=t)continue;const o=e.getClassName(s);if(a>=n){r[i++]=new LinePart(n,o,0);break}r[i++]=new LinePart(a,o,0)}return r}function splitLargeTokens(e,t,n){let r=0;const i=[];let s=0;if(n)for(let n=0,a=t.length;n<a;n++){const a=t[n],o=a.endIndex;if(r+50<o){const t=a.type,n=a.metadata;let c=-1,h=r;for(let a=r;a<o;a++)32===e.charCodeAt(a)&&(c=a),-1!==c&&a-h>=50&&(i[s++]=new LinePart(c+1,t,n),h=c+1,c=-1);h!==o&&(i[s++]=new LinePart(o,t,n))}else i[s++]=a;r=o}else for(let e=0,n=t.length;e<n;e++){const n=t[e],a=n.endIndex,o=a-r;if(o>50){const e=n.type,t=n.metadata,c=Math.ceil(o/50);for(let n=1;n<c;n++){const a=r+50*n;i[s++]=new LinePart(a,e,t)}i[s++]=new LinePart(a,e,t)}else i[s++]=n;r=a}return i}function isControlCharacter(e){return e<32?9!==e:127===e||(e>=8234&&e<=8238||e>=8294&&e<=8297||e>=8206&&e<=8207||1564===e)}function extractControlCharacters(e,t){const n=[];let r=new LinePart(0,"",0),i=0;for(const s of t){const t=s.endIndex;for(;i<t;i++){isControlCharacter(e.charCodeAt(i))&&(i>r.endIndex&&(r=new LinePart(i,s.type,s.metadata),n.push(r)),r=new LinePart(i+1,"mtkcontrol",s.metadata),n.push(r))}i>r.endIndex&&(r=new LinePart(t,s.type,s.metadata),n.push(r))}return n}function _applyRenderWhitespace(e,t,n,r){const i=e.continuesWithWrappedLine,s=e.fauxIndentLength,a=e.tabSize,o=e.startVisibleColumn,c=e.useMonospaceOptimizations,h=e.selectionsOnLine,l=1===e.renderWhitespace,d=3===e.renderWhitespace,p=e.renderSpaceWidth!==e.spaceWidth,f=[];let u=0,g=0,C=r[g].type,I=r[g].endIndex;const L=r.length;let S,w=!1,m=strings.firstNonWhitespaceIndex(t);-1===m?(w=!0,m=n,S=n):S=strings.lastNonWhitespaceIndex(t);let A=!1,O=0,x=h&&h[O],R=o%a;for(let e=s;e<n;e++){const i=t.charCodeAt(e);let o;if(x&&e>=x.endOffset&&(O++,x=h&&h[O]),e<m||e>S)o=!0;else if(9===i)o=!0;else if(32===i)if(l)if(A)o=!0;else{const r=e+1<n?t.charCodeAt(e+1):0;o=32===r||9===r}else o=!0;else o=!1;if(o&&h&&(o=!!x&&x.startOffset<=e&&x.endOffset>e),o&&d&&(o=w||e>S),A){if(!o||!c&&R>=a){if(p){for(let t=(u>0?f[u-1].endIndex:s)+1;t<=e;t++)f[u++]=new LinePart(t,"mtkw",1)}else f[u++]=new LinePart(e,"mtkw",1);R%=a}}else(e===I||o&&e>s)&&(f[u++]=new LinePart(e,C,0),R%=a);for(9===i?R=a:strings.isFullWidthCharacter(i)?R+=2:R++,A=o;e===I&&(g++,g<L);)C=r[g].type,I=r[g].endIndex}let W=!1;if(A)if(i&&l){const e=n>0?t.charCodeAt(n-1):0,r=n>1?t.charCodeAt(n-2):0;32===e&&32!==r&&9!==r||(W=!0)}else W=!0;if(W)if(p){for(let e=(u>0?f[u-1].endIndex:s)+1;e<=n;e++)f[u++]=new LinePart(e,"mtkw",1)}else f[u++]=new LinePart(n,"mtkw",1);else f[u++]=new LinePart(n,C,0);return f}function _applyInlineDecorations(e,t,n,r){r.sort(LineDecoration.compare);const i=LineDecorationsNormalizer.normalize(e,r),s=i.length;let a=0;const o=[];let c=0,h=0;for(let e=0,t=n.length;e<t;e++){const t=n[e],r=t.endIndex,l=t.type,d=t.metadata;for(;a<s&&i[a].startOffset<r;){const e=i[a];if(e.startOffset>h&&(h=e.startOffset,o[c++]=new LinePart(h,l,d)),!(e.endOffset+1<=r)){h=r,o[c++]=new LinePart(h,l+" "+e.className,d|e.metadata);break}h=e.endOffset+1,o[c++]=new LinePart(h,l+" "+e.className,d|e.metadata),a++}r>h&&(h=r,o[c++]=new LinePart(h,l,d))}const l=n[n.length-1].endIndex;if(a<s&&i[a].startOffset===l)for(;a<s&&i[a].startOffset===l;){const e=i[a];o[c++]=new LinePart(h,e.className,e.metadata),a++}return o}function _renderLine(e,t){const n=e.fontIsMonospace,r=e.canUseHalfwidthRightwardsArrow,i=e.containsForeignElements,s=e.lineContent,a=e.len,o=e.isOverflowing,c=e.parts,h=e.fauxIndentLength,l=e.tabSize,d=e.startVisibleColumn,p=e.containsRTL,f=e.spaceWidth,u=e.renderSpaceCharCode,g=e.renderWhitespace,C=e.renderControlCharacters,I=new CharacterMapping(a+1,c.length);let L=!1,S=0,w=d,m=0,A=0,O=0,x=0;p?t.appendASCIIString('<span dir="ltr">'):t.appendASCIIString("<span>");for(let e=0,o=c.length;e<o;e++){x+=O;const o=c[e],d=o.endIndex,p=o.type,R=0!==g&&o.isWhitespace(),W=R&&!n&&("mtkw"===p||!i),P=S===d&&o.isPseudoAfter();if(m=0,t.appendASCIIString('<span class="'),t.appendASCIIString(W?"mtkz":p),t.appendASCII(34),R){let n=0;{let e=S,t=w;for(;e<d;e++){const r=0|(9===s.charCodeAt(e)?l-t%l:1);n+=r,e>=h&&(t+=r)}}for(W&&(t.appendASCIIString(' style="width:'),t.appendASCIIString(String(f*n)),t.appendASCIIString('px"')),t.appendASCII(62);S<d;S++){I.setColumnInfo(S+1,e-A,m,x),A=0;let n;if(9===s.charCodeAt(S)){n=l-w%l|0,!r||n>1?t.write1(8594):t.write1(65515);for(let e=2;e<=n;e++)t.write1(160)}else n=1,t.write1(u);m+=n,S>=h&&(w+=n)}O=n}else{let n=0;for(t.appendASCII(62);S<d;S++){I.setColumnInfo(S+1,e-A,m,x),A=0;const r=s.charCodeAt(S);let i=1,a=1;switch(r){case 9:i=l-w%l,a=i;for(let e=1;e<=i;e++)t.write1(160);break;case 32:t.write1(160);break;case 60:t.appendASCIIString("&lt;");break;case 62:t.appendASCIIString("&gt;");break;case 38:t.appendASCIIString("&amp;");break;case 0:C?t.write1(9216):t.appendASCIIString("&#00;");break;case 65279:case 8232:case 8233:case 133:t.write1(65533);break;default:strings.isFullWidthCharacter(r)&&a++,C&&r<32?t.write1(9216+r):C&&127===r?t.write1(9249):C&&isControlCharacter(r)?(t.appendASCIIString("[U+"),t.appendASCIIString(to4CharHex(r)),t.appendASCIIString("]"),i=8):t.write1(r)}m+=i,n+=i,S>=h&&(w+=a)}O=n}P?A++:A=0,S>=a&&!L&&o.isPseudoAfter()&&(L=!0,I.setColumnInfo(S+1,e,m,x)),t.appendASCIIString("</span>")}return L||I.setColumnInfo(a+1,c.length-1,m,x),o&&t.appendASCIIString("<span>&hellip;</span>"),t.appendASCIIString("</span>"),new RenderLineOutput(I,p,i)}function to4CharHex(e){return e.toString(16).toUpperCase().padStart(4,"0")}
//# sourceMappingURL=/sm/71892b50ad2b7d3fc2c2fccd4b50d4ba3628ad169b2334187db17d093b2755c2.map