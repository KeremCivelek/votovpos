/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/monaco-editor@0.33.0/esm/vs/editor/common/viewModel/viewModelDecorations.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{Position}from"../core/position.js";import{Range}from"../core/range.js";import{InlineDecoration,ViewModelDecoration}from"../viewModel.js";import{filterValidationDecorations}from"../config/editorOptions.js";export class ViewModelDecorations{constructor(e,o,n,t,i){this.editorId=e,this.model=o,this.configuration=n,this._linesCollection=t,this._coordinatesConverter=i,this._decorationsCache=Object.create(null),this._cachedModelDecorationsResolver=null,this._cachedModelDecorationsResolverViewRange=null}_clearCachedModelDecorationsResolver(){this._cachedModelDecorationsResolver=null,this._cachedModelDecorationsResolverViewRange=null}dispose(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}reset(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}onModelDecorationsChanged(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}onLineMappingChanged(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}_getOrCreateViewModelDecoration(e){const o=e.id;let n=this._decorationsCache[o];if(!n){const t=e.range,i=e.options;let r;if(i.isWholeLine){const e=this._coordinatesConverter.convertModelPositionToViewPosition(new Position(t.startLineNumber,1),0),o=this._coordinatesConverter.convertModelPositionToViewPosition(new Position(t.endLineNumber,this.model.getLineMaxColumn(t.endLineNumber)),1);r=new Range(e.lineNumber,e.column,o.lineNumber,o.column)}else r=this._coordinatesConverter.convertModelRangeToViewRange(t,1);n=new ViewModelDecoration(r,i),this._decorationsCache[o]=n}return n}getDecorationsViewportData(e){let o=null!==this._cachedModelDecorationsResolver;return o=o&&e.equalsRange(this._cachedModelDecorationsResolverViewRange),o||(this._cachedModelDecorationsResolver=this._getDecorationsViewportData(e),this._cachedModelDecorationsResolverViewRange=e),this._cachedModelDecorationsResolver}_getDecorationsViewportData(e){const o=this._linesCollection.getDecorationsInRange(e,this.editorId,filterValidationDecorations(this.configuration.options)),n=e.startLineNumber,t=e.endLineNumber,i=[];let r=0;const s=[];for(let e=n;e<=t;e++)s[e-n]=[];for(let e=0,a=o.length;e<a;e++){const a=o[e],c=a.options;if(!isModelDecorationVisible(this.model,a))continue;const l=this._getOrCreateViewModelDecoration(a),d=l.range;if(i[r++]=l,c.inlineClassName){const e=new InlineDecoration(d,c.inlineClassName,c.inlineClassNameAffectsLetterSpacing?3:0),o=Math.max(n,d.startLineNumber),i=Math.min(t,d.endLineNumber);for(let t=o;t<=i;t++)s[t-n].push(e)}if(c.beforeContentClassName&&n<=d.startLineNumber&&d.startLineNumber<=t){const e=new InlineDecoration(new Range(d.startLineNumber,d.startColumn,d.startLineNumber,d.startColumn),c.beforeContentClassName,1);s[d.startLineNumber-n].push(e)}if(c.afterContentClassName&&n<=d.endLineNumber&&d.endLineNumber<=t){const e=new InlineDecoration(new Range(d.endLineNumber,d.endColumn,d.endLineNumber,d.endColumn),c.afterContentClassName,2);s[d.endLineNumber-n].push(e)}}return{decorations:i,inlineDecorations:s}}}export function isModelDecorationVisible(e,o){return(!o.options.hideInCommentTokens||!isModelDecorationInComment(e,o))&&(!o.options.hideInStringTokens||!isModelDecorationInString(e,o))}export function isModelDecorationInComment(e,o){return testTokensInRange(e,o.range,(e=>1===e))}export function isModelDecorationInString(e,o){return testTokensInRange(e,o.range,(e=>2===e))}function testTokensInRange(e,o,n){for(let t=o.startLineNumber;t<=o.endLineNumber;t++){const i=e.getLineTokens(t),r=t===o.startLineNumber,s=t===o.endLineNumber;let a=r?i.findTokenIndexAtOffset(o.startColumn-1):0;for(;a<i.getCount();){if(s){if(i.getStartOffset(a)>o.endColumn-1)break}if(!n(i.getStandardTokenType(a)))return!1;a++}}return!0}
//# sourceMappingURL=/sm/291f0cb526af1e9a6ff4e43cf4a9af0484a8dd27eb35ace4d05991513f912b30.map