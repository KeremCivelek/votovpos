/**
 * Minified by jsDelivr using Terser v5.7.1.
 * Original file: /npm/monaco-editor@0.27.0/esm/vs/editor/browser/config/configuration.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as browser from"../../../base/browser/browser.js";import{Emitter}from"../../../base/common/event.js";import{Disposable}from"../../../base/common/lifecycle.js";import*as platform from"../../../base/common/platform.js";import{CharWidthRequest,readCharWidths}from"./charWidthReader.js";import{ElementSizeObserver}from"./elementSizeObserver.js";import{CommonEditorConfiguration}from"../../common/config/commonEditorConfig.js";import{EditorFontLigatures}from"../../common/config/editorOptions.js";import{FontInfo}from"../../common/config/fontInfo.js";class CSSBasedConfigurationCache{constructor(){this._keys=Object.create(null),this._values=Object.create(null)}has(e){const t=e.getId();return!!this._values[t]}get(e){const t=e.getId();return this._values[t]}put(e,t){const i=e.getId();this._keys[i]=e,this._values[i]=t}remove(e){const t=e.getId();delete this._keys[t],delete this._values[t]}getValues(){return Object.keys(this._keys).map((e=>this._values[e]))}}export function clearAllFontInfos(){CSSBasedConfiguration.INSTANCE.clearCache()}class CSSBasedConfiguration extends Disposable{constructor(){super(),this._onDidChange=this._register(new Emitter),this.onDidChange=this._onDidChange.event,this._cache=new CSSBasedConfigurationCache,this._evictUntrustedReadingsTimeout=-1}dispose(){-1!==this._evictUntrustedReadingsTimeout&&(clearTimeout(this._evictUntrustedReadingsTimeout),this._evictUntrustedReadingsTimeout=-1),super.dispose()}clearCache(){this._cache=new CSSBasedConfigurationCache,this._onDidChange.fire()}_writeToCache(e,t){this._cache.put(e,t),t.isTrusted||-1!==this._evictUntrustedReadingsTimeout||(this._evictUntrustedReadingsTimeout=setTimeout((()=>{this._evictUntrustedReadingsTimeout=-1,this._evictUntrustedReadings()}),5e3))}_evictUntrustedReadings(){const e=this._cache.getValues();let t=!1;for(const i of e)i.isTrusted||(t=!0,this._cache.remove(i));t&&this._onDidChange.fire()}readConfiguration(e){if(!this._cache.has(e)){let t=CSSBasedConfiguration._actualReadConfiguration(e);(t.typicalHalfwidthCharacterWidth<=2||t.typicalFullwidthCharacterWidth<=2||t.spaceWidth<=2||t.maxDigitWidth<=2)&&(t=new FontInfo({zoomLevel:browser.getZoomLevel(),pixelRatio:browser.getPixelRatio(),fontFamily:t.fontFamily,fontWeight:t.fontWeight,fontSize:t.fontSize,fontFeatureSettings:t.fontFeatureSettings,lineHeight:t.lineHeight,letterSpacing:t.letterSpacing,isMonospace:t.isMonospace,typicalHalfwidthCharacterWidth:Math.max(t.typicalHalfwidthCharacterWidth,5),typicalFullwidthCharacterWidth:Math.max(t.typicalFullwidthCharacterWidth,5),canUseHalfwidthRightwardsArrow:t.canUseHalfwidthRightwardsArrow,spaceWidth:Math.max(t.spaceWidth,5),middotWidth:Math.max(t.middotWidth,5),wsmiddotWidth:Math.max(t.wsmiddotWidth,5),maxDigitWidth:Math.max(t.maxDigitWidth,5)},!1)),this._writeToCache(e,t)}return this._cache.get(e)}static createRequest(e,t,i,s){const r=new CharWidthRequest(e,t);return i.push(r),s&&s.push(r),r}static _actualReadConfiguration(e){const t=[],i=[],s=this.createRequest("n",0,t,i),r=this.createRequest("ｍ",0,t,null),a=this.createRequest(" ",0,t,i),o=this.createRequest("0",0,t,i),n=this.createRequest("1",0,t,i),h=this.createRequest("2",0,t,i),c=this.createRequest("3",0,t,i),d=this.createRequest("4",0,t,i),u=this.createRequest("5",0,t,i),l=this.createRequest("6",0,t,i),g=this.createRequest("7",0,t,i),m=this.createRequest("8",0,t,i),f=this.createRequest("9",0,t,i),p=this.createRequest("→",0,t,i),C=this.createRequest("￫",0,t,null),S=this.createRequest("·",0,t,i),w=this.createRequest(String.fromCharCode(11825),0,t,null);this.createRequest("|",0,t,i),this.createRequest("/",0,t,i),this.createRequest("-",0,t,i),this.createRequest("_",0,t,i),this.createRequest("i",0,t,i),this.createRequest("l",0,t,i),this.createRequest("m",0,t,i),this.createRequest("|",1,t,i),this.createRequest("_",1,t,i),this.createRequest("i",1,t,i),this.createRequest("l",1,t,i),this.createRequest("m",1,t,i),this.createRequest("n",1,t,i),this.createRequest("|",2,t,i),this.createRequest("_",2,t,i),this.createRequest("i",2,t,i),this.createRequest("l",2,t,i),this.createRequest("m",2,t,i),this.createRequest("n",2,t,i),readCharWidths(e,t);const R=Math.max(o.width,n.width,h.width,c.width,d.width,u.width,l.width,g.width,m.width,f.width);let _=e.fontFeatureSettings===EditorFontLigatures.OFF;const b=i[0].width;for(let e=1,t=i.length;_&&e<t;e++){const t=b-i[e].width;if(t<-.001||t>.001){_=!1;break}}let v=!0;_&&C.width!==b&&(v=!1),C.width>p.width&&(v=!1);const W=browser.getTimeSinceLastZoomLevelChanged()>2e3;return new FontInfo({zoomLevel:browser.getZoomLevel(),pixelRatio:browser.getPixelRatio(),fontFamily:e.fontFamily,fontWeight:e.fontWeight,fontSize:e.fontSize,fontFeatureSettings:e.fontFeatureSettings,lineHeight:e.lineHeight,letterSpacing:e.letterSpacing,isMonospace:_,typicalHalfwidthCharacterWidth:s.width,typicalFullwidthCharacterWidth:r.width,canUseHalfwidthRightwardsArrow:v,spaceWidth:a.width,middotWidth:S.width,wsmiddotWidth:w.width,maxDigitWidth:R},W)}}CSSBasedConfiguration.INSTANCE=new CSSBasedConfiguration;export class Configuration extends CommonEditorConfiguration{constructor(e,t,i=null,s){super(e,t),this.accessibilityService=s,this._elementSizeObserver=this._register(new ElementSizeObserver(i,t.dimension,(()=>this._recomputeOptions()))),this._register(CSSBasedConfiguration.INSTANCE.onDidChange((()=>this._recomputeOptions()))),this._validatedOptions.get(10)&&this._elementSizeObserver.startObserving(),this._register(browser.onDidChangeZoomLevel((e=>this._recomputeOptions()))),this._register(this.accessibilityService.onDidChangeScreenReaderOptimized((()=>this._recomputeOptions()))),this._recomputeOptions()}static applyFontInfoSlow(e,t){e.style.fontFamily=t.getMassagedFontFamily(),e.style.fontWeight=t.fontWeight,e.style.fontSize=t.fontSize+"px",e.style.fontFeatureSettings=t.fontFeatureSettings,e.style.lineHeight=t.lineHeight+"px",e.style.letterSpacing=t.letterSpacing+"px"}static applyFontInfo(e,t){e.setFontFamily(t.getMassagedFontFamily()),e.setFontWeight(t.fontWeight),e.setFontSize(t.fontSize),e.setFontFeatureSettings(t.fontFeatureSettings),e.setLineHeight(t.lineHeight),e.setLetterSpacing(t.letterSpacing)}observeReferenceElement(e){this._elementSizeObserver.observe(e)}updatePixelRatio(){this._recomputeOptions()}static _getExtraEditorClassName(){let e="";return browser.isSafari||browser.isWebkitWebView||(e+="no-user-select "),browser.isSafari&&(e+="no-minimap-shadow "),platform.isMacintosh&&(e+="mac "),e}_getEnvConfiguration(){return{extraEditorClassName:Configuration._getExtraEditorClassName(),outerWidth:this._elementSizeObserver.getWidth(),outerHeight:this._elementSizeObserver.getHeight(),emptySelectionClipboard:browser.isWebKit||browser.isFirefox,pixelRatio:browser.getPixelRatio(),zoomLevel:browser.getZoomLevel(),accessibilitySupport:this.accessibilityService.isScreenReaderOptimized()?2:this.accessibilityService.getAccessibilitySupport()}}readConfiguration(e){return CSSBasedConfiguration.INSTANCE.readConfiguration(e)}}
//# sourceMappingURL=/sm/2915abc98602b5f218200b028a34a533c9c9c195335ecbd21f27ee7103f6f6ed.map