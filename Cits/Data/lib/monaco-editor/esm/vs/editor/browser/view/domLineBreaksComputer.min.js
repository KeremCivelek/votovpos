/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/monaco-editor@0.33.0/esm/vs/editor/browser/view/domLineBreaksComputer.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var _a;import{createStringBuilder}from"../../common/core/stringBuilder.js";import*as strings from"../../../base/common/strings.js";import{applyFontInfo}from"../config/domFontInfo.js";import{LineInjectedText}from"../../common/textModelEvents.js";import{ModelLineProjectionData}from"../../common/modelLineProjectionData.js";const ttPolicy=null===(_a=window.trustedTypes)||void 0===_a?void 0:_a.createPolicy("domLineBreaksComputer",{createHTML:e=>e});export class DOMLineBreaksComputerFactory{static create(){return new DOMLineBreaksComputerFactory}constructor(){}createLineBreaksComputer(e,t,n,r){const i=[],o=[];return{addRequest:(e,t,n)=>{i.push(e),o.push(t)},finalize:()=>createLineBreaks(i,e,t,n,r,o)}}}function createLineBreaks(e,t,n,r,i,o){var a;function c(t){const n=o[t];if(n){const r=LineInjectedText.applyInjectedText(e[t],n),i=n.map((e=>e.options)),o=n.map((e=>e.column-1));return new ModelLineProjectionData(o,i,[r.length],[],0)}return null}if(-1===r){const t=[];for(let n=0,r=e.length;n<r;n++)t[n]=c(n);return t}const l=Math.round(r*t.typicalHalfwidthCharacterWidth),s=3===i?2:2===i?1:0,d=Math.round(n*s),p=Math.ceil(t.spaceWidth*d),u=document.createElement("div");applyFontInfo(u,t);const h=createStringBuilder(1e4),g=[],I=[],f=[],S=[],m=[];for(let r=0;r<e.length;r++){const a=LineInjectedText.applyInjectedText(e[r],o[r]);let c=0,s=0,d=l;if(0!==i)if(c=strings.firstNonWhitespaceIndex(a),-1===c)c=0;else{for(let e=0;e<c;e++){s+=9===a.charCodeAt(e)?n-s%n:1}const e=Math.ceil(t.spaceWidth*s);e+t.typicalFullwidthCharacterWidth>l?(c=0,s=0):d=l-e}const u=a.substr(c),C=renderLine(u,s,n,d,h,p);g[r]=c,I[r]=s,f[r]=u,S[r]=C[0],m[r]=C[1]}const C=h.build(),y=null!==(a=null==ttPolicy?void 0:ttPolicy.createHTML(C))&&void 0!==a?a:C;u.innerHTML=y,u.style.position="absolute",u.style.top="10000",u.style.wordWrap="break-word",document.body.appendChild(u);const A=document.createRange(),k=Array.prototype.slice.call(u.children,0),L=[];for(let t=0;t<e.length;t++){const e=readLineBreaks(A,k[t],f[t],S[t]);if(null===e){L[t]=c(t);continue}const n=g[t],r=I[t]+d,i=m[t],a=[];for(let t=0,n=e.length;t<n;t++)a[t]=i[e[t]];if(0!==n)for(let t=0,r=e.length;t<r;t++)e[t]+=n;let l,s;const p=o[t];p?(l=p.map((e=>e.options)),s=p.map((e=>e.column-1))):(l=null,s=null),L[t]=new ModelLineProjectionData(s,l,e,a,r)}return document.body.removeChild(u),L}function renderLine(e,t,n,r,i,o){if(0!==o){const e=String(o);i.appendASCIIString('<div style="text-indent: -'),i.appendASCIIString(e),i.appendASCIIString("px; padding-left: "),i.appendASCIIString(e),i.appendASCIIString("px; box-sizing: border-box; width:")}else i.appendASCIIString('<div style="width:');i.appendASCIIString(String(r)),i.appendASCIIString('px;">');const a=e.length;let c=t,l=0;const s=[],d=[];let p=0<a?e.charCodeAt(0):0;i.appendASCIIString("<span>");for(let t=0;t<a;t++){0!==t&&t%16384==0&&i.appendASCIIString("</span><span>"),s[t]=l,d[t]=c;const r=p;p=t+1<a?e.charCodeAt(t+1):0;let o=1,u=1;switch(r){case 9:o=n-c%n,u=o;for(let e=1;e<=o;e++)e<o?i.write1(160):i.appendASCII(32);break;case 32:32===p?i.write1(160):i.appendASCII(32);break;case 60:i.appendASCIIString("&lt;");break;case 62:i.appendASCIIString("&gt;");break;case 38:i.appendASCIIString("&amp;");break;case 0:i.appendASCIIString("&#00;");break;case 65279:case 8232:case 8233:case 133:i.write1(65533);break;default:strings.isFullWidthCharacter(r)&&u++,r<32?i.write1(9216+r):i.write1(r)}l+=o,c+=u}return i.appendASCIIString("</span>"),s[e.length]=l,d[e.length]=c,i.appendASCIIString("</div>"),[s,d]}function readLineBreaks(e,t,n,r){if(n.length<=1)return null;const i=Array.prototype.slice.call(t.children,0),o=[];try{discoverBreaks(e,i,r,0,null,n.length-1,null,o)}catch(e){return console.log(e),null}return 0===o.length?null:(o.push(n.length),o)}function discoverBreaks(e,t,n,r,i,o,a,c){if(r===o)return;if(i=i||readClientRect(e,t,n[r],n[r+1]),a=a||readClientRect(e,t,n[o],n[o+1]),Math.abs(i[0].top-a[0].top)<=.1)return;if(r+1===o)return void c.push(o);const l=r+(o-r)/2|0,s=readClientRect(e,t,n[l],n[l+1]);discoverBreaks(e,t,n,r,i,l,s,c),discoverBreaks(e,t,n,l,s,o,a,c)}function readClientRect(e,t,n,r){return e.setStart(t[n/16384|0].firstChild,n%16384),e.setEnd(t[r/16384|0].firstChild,r%16384),e.getClientRects()}
//# sourceMappingURL=/sm/34a0671042057f6b3e041d30b6c931d322901f5474824bfa6fc3ce1e3ff3c91e.map