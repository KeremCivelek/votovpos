/**
 * Minified by jsDelivr using Terser v5.7.1.
 * Original file: /npm/monaco-editor@0.27.0/esm/vs/language/html/_deps/vscode-html-languageservice/services/htmlCompletion.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __awaiter=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},__generator=this&&this.__generator||function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};import{createScanner}from"../parser/htmlScanner.js";import{ScannerState,TokenType,Position,CompletionItemKind,Range,TextEdit,InsertTextFormat,MarkupKind}from"../htmlLanguageTypes.js";import{entities}from"../parser/htmlEntities.js";import*as nls from"./../../../fillers/vscode-nls.js";import{isLetterOrDigit,endsWith,startsWith}from"../utils/strings.js";import{isVoidElement}from"../languageFacts/fact.js";import{isDefined}from"../utils/object.js";import{generateDocumentation}from"../languageFacts/dataProvider.js";import{PathCompletionParticipant}from"./pathCompletion.js";var localize=nls.loadMessageBundle(),HTMLCompletion=function(){function t(t,e){this.lsOptions=t,this.dataManager=e,this.completionParticipants=[]}return t.prototype.setCompletionParticipants=function(t){this.completionParticipants=t||[]},t.prototype.doComplete2=function(t,e,n,r,o){return __awaiter(this,void 0,void 0,(function(){var i,a,s,c;return __generator(this,(function(u){switch(u.label){case 0:if(!this.lsOptions.fileSystemProvider||!this.lsOptions.fileSystemProvider.readDirectory)return[2,this.doComplete(t,e,n,o)];i=new PathCompletionParticipant(this.lsOptions.fileSystemProvider.readDirectory),a=this.completionParticipants,this.completionParticipants=[i].concat(a),s=this.doComplete(t,e,n,o),u.label=1;case 1:return u.trys.push([1,,3,4]),[4,i.computeCompletions(t,r)];case 2:return c=u.sent(),[2,{isIncomplete:s.isIncomplete||c.isIncomplete,items:c.items.concat(s.items)}];case 3:return this.completionParticipants=a,[7];case 4:return[2]}}))}))},t.prototype.doComplete=function(t,e,n,r){var o=this._doComplete(t,e,n,r);return this.convertCompletionList(o)},t.prototype._doComplete=function(t,e,n,r){var o={isIncomplete:!1,items:[]},i=this.completionParticipants,a=this.dataManager.getDataProviders().filter((function(e){return e.isApplicable(t.languageId)&&(!r||!1!==r[e.getId()])})),s=this.doesSupportMarkdown(),c=t.getText(),u=t.offsetAt(e),l=n.findNodeBefore(u);if(!l)return o;var p,f=createScanner(c,l.start),d="";function m(e,n){return void 0===n&&(n=u),e>u&&(e=u),{start:t.positionAt(e),end:t.positionAt(n)}}function T(t,e){var n=m(t,e);return a.forEach((function(t){t.provideTags().forEach((function(t){o.items.push({label:t.name,kind:CompletionItemKind.Property,documentation:generateDocumentation(t,void 0,s),textEdit:TextEdit.replace(n,t.name),insertTextFormat:InsertTextFormat.PlainText})}))})),o}function g(t){for(var e=t;e>0;){var n=c.charAt(e-1);if("\n\r".indexOf(n)>=0)return c.substring(e,t);if(!isWhiteSpace(n))return null;e--}return c.substring(0,t)}function h(t,e,n){void 0===n&&(n=u);var r=m(t,n),i=isFollowedBy(c,n,ScannerState.WithinEndTag,TokenType.EndTagClose)?"":">",p=l;for(e&&(p=p.parent);p;){var f=p.tag;if(f&&(!p.closed||p.endTagStart&&p.endTagStart>u)){var d={label:"/"+f,kind:CompletionItemKind.Property,filterText:"/"+f,textEdit:TextEdit.replace(r,"/"+f+i),insertTextFormat:InsertTextFormat.PlainText},T=g(p.start),h=g(t-1);if(null!==T&&null!==h&&T!==h){var k=T+"</"+f+i;d.textEdit=TextEdit.replace(m(t-1-h.length),k),d.filterText=h+"</"+f}return o.items.push(d),o}p=p.parent}return e||a.forEach((function(t){t.provideTags().forEach((function(t){o.items.push({label:"/"+t.name,kind:CompletionItemKind.Property,documentation:generateDocumentation(t,void 0,s),filterText:"/"+t.name+i,textEdit:TextEdit.replace(r,"/"+t.name+i),insertTextFormat:InsertTextFormat.PlainText})}))})),o}function k(e,n){if(r&&r.hideAutoCompleteProposals)return o;if(!isVoidElement(n)){var i=t.positionAt(e);o.items.push({label:"</"+n+">",kind:CompletionItemKind.Property,filterText:"</"+n+">",textEdit:TextEdit.insert(i,"$0</"+n+">"),insertTextFormat:InsertTextFormat.Snippet})}return o}function v(t,e){return T(t,e),h(t,!0,e),o}function E(t,e){void 0===e&&(e=u);for(var r=u;r<e&&"<"!==c[r];)r++;var i,p=c.substring(t,e),f=m(t,r),T=isFollowedBy(c,e,ScannerState.AfterAttributeName,TokenType.DelimiterAssign)?"":'="$1"',g=(i=Object.create(null),l.attributeNames.forEach((function(t){i[t]=!0})),i);return g[p]=!1,a.forEach((function(t){t.provideAttributes(d).forEach((function(t){if(!g[t.name]){g[t.name]=!0;var e,n=t.name;"v"!==t.valueSet&&T.length&&(n+=T,(t.valueSet||"style"===t.name)&&(e={title:"Suggest",command:"editor.action.triggerSuggest"})),o.items.push({label:t.name,kind:"handler"===t.valueSet?CompletionItemKind.Function:CompletionItemKind.Value,documentation:generateDocumentation(t,void 0,s),textEdit:TextEdit.replace(f,n),insertTextFormat:InsertTextFormat.Snippet,command:e})}}))})),function(t,e){var r="data-",i={};function a(t){t.attributeNames.forEach((function(t){!startsWith(t,r)||i[t]||e[t]||(i[t]=t+'="$1"')})),t.children.forEach((function(t){return a(t)}))}i[r]=r+'$1="$2"',n&&n.roots.forEach((function(t){return a(t)}));Object.keys(i).forEach((function(e){return o.items.push({label:e,kind:CompletionItemKind.Value,textEdit:TextEdit.replace(t,i[e]),insertTextFormat:InsertTextFormat.Snippet})}))}(f,g),o}function x(n,r){var l,f,T;if(void 0===r&&(r=u),u>n&&u<=r&&isQuote(c[n])){var g=n+1,h=r;r>n&&c[r-1]===c[n]&&h--;var k=getWordStart(c,u,g),v=getWordEnd(c,u,h);l=m(k,v),T=u>=g&&u<=h?c.substring(g,u):"",f=!1}else l=m(n,r),T=c.substring(n,u),f=!0;if(i.length>0)for(var E=d.toLowerCase(),x=p.toLowerCase(),y=m(n,r),S=0,C=i;S<C.length;S++){var O=C[S];O.onHtmlAttributeValue&&O.onHtmlAttributeValue({document:t,position:e,tag:E,attribute:x,value:T,range:y})}return a.forEach((function(t){t.provideValues(d,p).forEach((function(t){var e=f?'"'+t.name+'"':t.name;o.items.push({label:t.name,filterText:e,kind:CompletionItemKind.Unit,documentation:generateDocumentation(t,void 0,s),textEdit:TextEdit.replace(l,e),insertTextFormat:InsertTextFormat.PlainText})}))})),b(),o}function y(t){return u===f.getTokenEnd()&&(O=f.scan())===t&&f.getTokenOffset()===u?f.getTokenEnd():u}function S(){for(var n=0,r=i;n<r.length;n++){var o=r[n];o.onHtmlContent&&o.onHtmlContent({document:t,position:e})}return b()}function b(){for(var t=u-1,n=e.character;t>=0&&isLetterOrDigit(c,t);)t--,n--;if(t>=0&&"&"===c[t]){var r=Range.create(Position.create(e.line,n-1),e);for(var i in entities)if(endsWith(i,";")){var a="&"+i;o.items.push({label:a,kind:CompletionItemKind.Keyword,documentation:localize("entity.propose","Character entity representing '"+entities[i]+"'"),textEdit:TextEdit.replace(r,a),insertTextFormat:InsertTextFormat.PlainText})}}return o}for(var C,O=f.scan();O!==TokenType.EOS&&f.getTokenOffset()<=u;){switch(O){case TokenType.StartTagOpen:if(f.getTokenEnd()===u){var P=y(TokenType.StartTag);return 0===e.line&&(C=void 0,C=m(u,P),o.items.push({label:"!DOCTYPE",kind:CompletionItemKind.Property,documentation:"A preamble for an HTML document.",textEdit:TextEdit.replace(C,"!DOCTYPE html>"),insertTextFormat:InsertTextFormat.PlainText})),v(u,P)}break;case TokenType.StartTag:if(f.getTokenOffset()<=u&&u<=f.getTokenEnd())return T(f.getTokenOffset(),f.getTokenEnd());d=f.getTokenText();break;case TokenType.AttributeName:if(f.getTokenOffset()<=u&&u<=f.getTokenEnd())return E(f.getTokenOffset(),f.getTokenEnd());p=f.getTokenText();break;case TokenType.DelimiterAssign:if(f.getTokenEnd()===u){P=y(TokenType.AttributeValue);return x(u,P)}break;case TokenType.AttributeValue:if(f.getTokenOffset()<=u&&u<=f.getTokenEnd())return x(f.getTokenOffset(),f.getTokenEnd());break;case TokenType.Whitespace:if(u<=f.getTokenEnd())switch(f.getScannerState()){case ScannerState.AfterOpeningStartTag:return v(f.getTokenOffset(),y(TokenType.StartTag));case ScannerState.WithinTag:case ScannerState.AfterAttributeName:return E(f.getTokenEnd());case ScannerState.BeforeAttributeValue:return x(f.getTokenEnd());case ScannerState.AfterOpeningEndTag:return h(f.getTokenOffset()-1,!1);case ScannerState.WithinContent:return S()}break;case TokenType.EndTagOpen:if(u<=f.getTokenEnd())return h(f.getTokenOffset()+1,!1,y(TokenType.EndTag));break;case TokenType.EndTag:if(u<=f.getTokenEnd())for(var w=f.getTokenOffset()-1;w>=0;){var A=c.charAt(w);if("/"===A)return h(w,!1,f.getTokenEnd());if(!isWhiteSpace(A))break;w--}break;case TokenType.StartTagClose:if(u<=f.getTokenEnd()&&d)return k(f.getTokenEnd(),d);break;case TokenType.Content:if(u<=f.getTokenEnd())return S();break;default:if(u<=f.getTokenEnd())return o}O=f.scan()}return o},t.prototype.doTagComplete=function(t,e,n){var r=t.offsetAt(e);if(r<=0)return null;var o=t.getText().charAt(r-1);if(">"===o){if((a=n.findNodeBefore(r))&&a.tag&&!isVoidElement(a.tag)&&a.start<r&&(!a.endTagStart||a.endTagStart>r))for(var i=(s=createScanner(t.getText(),a.start)).scan();i!==TokenType.EOS&&s.getTokenEnd()<=r;){if(i===TokenType.StartTagClose&&s.getTokenEnd()===r)return"$0</"+a.tag+">";i=s.scan()}}else if("/"===o){for(var a=n.findNodeBefore(r);a&&a.closed&&!(a.endTagStart&&a.endTagStart>r);)a=a.parent;if(a&&a.tag){var s;for(i=(s=createScanner(t.getText(),a.start)).scan();i!==TokenType.EOS&&s.getTokenEnd()<=r;){if(i===TokenType.EndTagOpen&&s.getTokenEnd()===r)return a.tag+">";i=s.scan()}}}return null},t.prototype.convertCompletionList=function(t){return this.doesSupportMarkdown()||t.items.forEach((function(t){t.documentation&&"string"!=typeof t.documentation&&(t.documentation={kind:"plaintext",value:t.documentation.value})})),t},t.prototype.doesSupportMarkdown=function(){var t,e,n;if(!isDefined(this.supportsMarkdown)){if(!isDefined(this.lsOptions.clientCapabilities))return this.supportsMarkdown=!0,this.supportsMarkdown;var r=null===(n=null===(e=null===(t=this.lsOptions.clientCapabilities.textDocument)||void 0===t?void 0:t.completion)||void 0===e?void 0:e.completionItem)||void 0===n?void 0:n.documentationFormat;this.supportsMarkdown=Array.isArray(r)&&-1!==r.indexOf(MarkupKind.Markdown)}return this.supportsMarkdown},t}();export{HTMLCompletion};function isQuote(t){return/^["']*$/.test(t)}function isWhiteSpace(t){return/^\s*$/.test(t)}function isFollowedBy(t,e,n,r){for(var o=createScanner(t,e,n),i=o.scan();i===TokenType.Whitespace;)i=o.scan();return i===r}function getWordStart(t,e,n){for(;e>n&&!isWhiteSpace(t[e-1]);)e--;return e}function getWordEnd(t,e,n){for(;e<n&&!isWhiteSpace(t[e]);)e++;return e}
//# sourceMappingURL=/sm/9b1d2a8f8cca49a7aaf54224a2cc666c37865e367dba9be0c50611fc5eeab652.map