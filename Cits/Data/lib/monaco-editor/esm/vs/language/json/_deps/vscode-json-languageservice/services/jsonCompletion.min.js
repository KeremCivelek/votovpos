/**
 * Minified by jsDelivr using Terser v5.7.1.
 * Original file: /npm/monaco-editor@0.27.0/esm/vs/language/json/_deps/vscode-json-languageservice/services/jsonCompletion.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as Parser from"../parser/jsonParser.js";import*as Json from"./../../jsonc-parser/main.js";import{stringifyObject}from"../utils/json.js";import{endsWith,extendedRegExp}from"../utils/strings.js";import{isDefined}from"../utils/objects.js";import{CompletionItem,CompletionItemKind,Range,TextEdit,InsertTextFormat,MarkupKind}from"../jsonLanguageTypes.js";import*as nls from"./../../../fillers/vscode-nls.js";var localize=nls.loadMessageBundle(),valueCommitCharacters=[",","}","]"],propertyCommitCharacters=[":"],JSONCompletion=function(){function e(e,t,r,o){void 0===t&&(t=[]),void 0===r&&(r=Promise),void 0===o&&(o={}),this.schemaService=e,this.contributions=t,this.promiseConstructor=r,this.clientCapabilities=o}return e.prototype.doResolve=function(e){for(var t=this.contributions.length-1;t>=0;t--){var r=this.contributions[t].resolveCompletion;if(r){var o=r(e);if(o)return o}}return this.promiseConstructor.resolve(e)},e.prototype.doComplete=function(e,t,r){var o=this,n={items:[],isIncomplete:!1},i=e.getText(),a=e.offsetAt(t),s=r.getNodeFromOffset(a,!0);if(this.isInComment(e,s?s.offset:0,a))return Promise.resolve(n);if(s&&a===s.offset+s.length&&a>0){var p=i[a-1];("object"===s.type&&"}"===p||"array"===s.type&&"]"===p)&&(s=s.parent)}var l,u=this.getCurrentWord(e,a);if(!s||"string"!==s.type&&"number"!==s.type&&"boolean"!==s.type&&"null"!==s.type){var c=a-u.length;c>0&&'"'===i[c-1]&&c--,l=Range.create(e.positionAt(c),t)}else l=Range.create(e.positionAt(s.offset),e.positionAt(s.offset+s.length));var d={},m={add:function(e){var t=e.label,r=d[t];if(r)r.documentation||(r.documentation=e.documentation),r.detail||(r.detail=e.detail);else{if((t=t.replace(/[\n]/g,"â†µ")).length>60){var o=t.substr(0,57).trim()+"...";d[o]||(t=o)}l&&void 0!==e.insertText&&(e.textEdit=TextEdit.replace(l,e.insertText)),e.label=t,d[t]=e,n.items.push(e)}},setAsIncomplete:function(){n.isIncomplete=!0},error:function(e){console.error(e)},log:function(e){console.log(e)},getNumberOfProposals:function(){return n.items.length}};return this.schemaService.getSchemaForResource(e.uri,r).then((function(t){var p=[],c=!0,f="",g=void 0;if(s&&"string"===s.type){var h=s.parent;h&&"property"===h.type&&h.keyNode===s&&(c=!h.valueNode,g=h,f=i.substr(s.offset+1,s.length-2),h&&(s=h.parent))}if(s&&"object"===s.type){if(s.offset===a)return n;s.properties.forEach((function(e){g&&g===e||(d[e.keyNode.value]=CompletionItem.create("__"))}));var y="";c&&(y=o.evaluateSeparatorAfter(e,e.offsetAt(l.end))),t?o.getPropertyCompletions(t,r,s,c,y,m):o.getSchemaLessPropertyCompletions(r,s,f,m);var x=Parser.getNodePath(s);o.contributions.forEach((function(t){var r=t.collectPropertyCompletions(e.uri,x,u,c,""===y,m);r&&p.push(r)})),!t&&u.length>0&&'"'!==i.charAt(a-u.length-1)&&(m.add({kind:CompletionItemKind.Property,label:o.getLabelForValue(u),insertText:o.getInsertTextForProperty(u,void 0,!1,y),insertTextFormat:InsertTextFormat.Snippet,documentation:""}),m.setAsIncomplete())}var v={};return t?o.getValueCompletions(t,r,s,a,e,m,v):o.getSchemaLessValueCompletions(r,s,a,e,m),o.contributions.length>0&&o.getContributedValueCompletions(r,s,a,e,m,p),o.promiseConstructor.all(p).then((function(){if(0===m.getNumberOfProposals()){var t=a;!s||"string"!==s.type&&"number"!==s.type&&"boolean"!==s.type&&"null"!==s.type||(t=s.offset+s.length);var r=o.evaluateSeparatorAfter(e,t);o.addFillerValueCompletions(v,r,m)}return n}))}))},e.prototype.getPropertyCompletions=function(e,t,r,o,n,i){var a=this;t.getMatchingSchemas(e.schema,r.offset).forEach((function(e){if(e.node===r&&!e.inverted){var t=e.schema.properties;t&&Object.keys(t).forEach((function(e){var r=t[e];if("object"==typeof r&&!r.deprecationMessage&&!r.doNotSuggest){var s={kind:CompletionItemKind.Property,label:e,insertText:a.getInsertTextForProperty(e,r,o,n),insertTextFormat:InsertTextFormat.Snippet,filterText:a.getFilterTextForValue(e),documentation:a.fromMarkup(r.markdownDescription)||r.description||""};void 0!==r.suggestSortText&&(s.sortText=r.suggestSortText),s.insertText&&endsWith(s.insertText,"$1"+n)&&(s.command={title:"Suggest",command:"editor.action.triggerSuggest"}),i.add(s)}}));var s=e.schema.propertyNames;if("object"==typeof s&&!s.deprecationMessage&&!s.doNotSuggest){var p=function(e,t){void 0===t&&(t=void 0);var r={kind:CompletionItemKind.Property,label:e,insertText:a.getInsertTextForProperty(e,void 0,o,n),insertTextFormat:InsertTextFormat.Snippet,filterText:a.getFilterTextForValue(e),documentation:t||a.fromMarkup(s.markdownDescription)||s.description||""};void 0!==s.suggestSortText&&(r.sortText=s.suggestSortText),r.insertText&&endsWith(r.insertText,"$1"+n)&&(r.command={title:"Suggest",command:"editor.action.triggerSuggest"}),i.add(r)};if(s.enum)for(var l=0;l<s.enum.length;l++){var u=void 0;s.markdownEnumDescriptions&&l<s.markdownEnumDescriptions.length?u=a.fromMarkup(s.markdownEnumDescriptions[l]):s.enumDescriptions&&l<s.enumDescriptions.length&&(u=s.enumDescriptions[l]),p(s.enum[l],u)}s.const&&p(s.const)}}}))},e.prototype.getSchemaLessPropertyCompletions=function(e,t,r,o){var n=this,i=function(e){e.properties.forEach((function(e){var t=e.keyNode.value;o.add({kind:CompletionItemKind.Property,label:t,insertText:n.getInsertTextForValue(t,""),insertTextFormat:InsertTextFormat.Snippet,filterText:n.getFilterTextForValue(t),documentation:""})}))};if(t.parent)if("property"===t.parent.type){var a=t.parent.keyNode.value;e.visit((function(e){return"property"===e.type&&e!==t.parent&&e.keyNode.value===a&&e.valueNode&&"object"===e.valueNode.type&&i(e.valueNode),!0}))}else"array"===t.parent.type&&t.parent.items.forEach((function(e){"object"===e.type&&e!==t&&i(e)}));else"object"===t.type&&o.add({kind:CompletionItemKind.Property,label:"$schema",insertText:this.getInsertTextForProperty("$schema",void 0,!0,""),insertTextFormat:InsertTextFormat.Snippet,documentation:"",filterText:this.getFilterTextForValue("$schema")})},e.prototype.getSchemaLessValueCompletions=function(e,t,r,o,n){var i=this,a=r;if(!t||"string"!==t.type&&"number"!==t.type&&"boolean"!==t.type&&"null"!==t.type||(a=t.offset+t.length,t=t.parent),!t)return n.add({kind:this.getSuggestionKind("object"),label:"Empty object",insertText:this.getInsertTextForValue({},""),insertTextFormat:InsertTextFormat.Snippet,documentation:""}),void n.add({kind:this.getSuggestionKind("array"),label:"Empty array",insertText:this.getInsertTextForValue([],""),insertTextFormat:InsertTextFormat.Snippet,documentation:""});var s=this.evaluateSeparatorAfter(o,a),p=function(e){e.parent&&!Parser.contains(e.parent,r,!0)&&n.add({kind:i.getSuggestionKind(e.type),label:i.getLabelTextForMatchingNode(e,o),insertText:i.getInsertTextForMatchingNode(e,o,s),insertTextFormat:InsertTextFormat.Snippet,documentation:""}),"boolean"===e.type&&i.addBooleanValueCompletion(!e.value,s,n)};if("property"===t.type&&r>(t.colonOffset||0)){var l=t.valueNode;if(l&&(r>l.offset+l.length||"object"===l.type||"array"===l.type))return;var u=t.keyNode.value;e.visit((function(e){return"property"===e.type&&e.keyNode.value===u&&e.valueNode&&p(e.valueNode),!0})),"$schema"===u&&t.parent&&!t.parent.parent&&this.addDollarSchemaCompletions(s,n)}if("array"===t.type)if(t.parent&&"property"===t.parent.type){var c=t.parent.keyNode.value;e.visit((function(e){return"property"===e.type&&e.keyNode.value===c&&e.valueNode&&"array"===e.valueNode.type&&e.valueNode.items.forEach(p),!0}))}else t.items.forEach(p)},e.prototype.getValueCompletions=function(e,t,r,o,n,i,a){var s=o,p=void 0,l=void 0;if(!r||"string"!==r.type&&"number"!==r.type&&"boolean"!==r.type&&"null"!==r.type||(s=r.offset+r.length,l=r,r=r.parent),r){if("property"===r.type&&o>(r.colonOffset||0)){var u=r.valueNode;if(u&&o>u.offset+u.length)return;p=r.keyNode.value,r=r.parent}if(r&&(void 0!==p||"array"===r.type)){for(var c=this.evaluateSeparatorAfter(n,s),d=0,m=t.getMatchingSchemas(e.schema,r.offset,l);d<m.length;d++){var f=m[d];if(f.node===r&&!f.inverted&&f.schema){if("array"===r.type&&f.schema.items)if(Array.isArray(f.schema.items)){var g=this.findItemAtOffset(r,n,o);g<f.schema.items.length&&this.addSchemaValueCompletions(f.schema.items[g],c,i,a)}else this.addSchemaValueCompletions(f.schema.items,c,i,a);if(void 0!==p){var h=!1;if(f.schema.properties)(T=f.schema.properties[p])&&(h=!0,this.addSchemaValueCompletions(T,c,i,a));if(f.schema.patternProperties&&!h)for(var y=0,x=Object.keys(f.schema.patternProperties);y<x.length;y++){var v=x[y];if(extendedRegExp(v).test(p)){h=!0;var T=f.schema.patternProperties[v];this.addSchemaValueCompletions(T,c,i,a)}}if(f.schema.additionalProperties&&!h){T=f.schema.additionalProperties;this.addSchemaValueCompletions(T,c,i,a)}}}}"$schema"!==p||r.parent||this.addDollarSchemaCompletions(c,i),a.boolean&&(this.addBooleanValueCompletion(!0,c,i),this.addBooleanValueCompletion(!1,c,i)),a.null&&this.addNullValueCompletion(c,i)}}else this.addSchemaValueCompletions(e.schema,"",i,a)},e.prototype.getContributedValueCompletions=function(e,t,r,o,n,i){if(t){if("string"!==t.type&&"number"!==t.type&&"boolean"!==t.type&&"null"!==t.type||(t=t.parent),t&&"property"===t.type&&r>(t.colonOffset||0)){var a=t.keyNode.value,s=t.valueNode;if((!s||r<=s.offset+s.length)&&t.parent){var p=Parser.getNodePath(t.parent);this.contributions.forEach((function(e){var t=e.collectValueCompletions(o.uri,p,a,n);t&&i.push(t)}))}}}else this.contributions.forEach((function(e){var t=e.collectDefaultCompletions(o.uri,n);t&&i.push(t)}))},e.prototype.addSchemaValueCompletions=function(e,t,r,o){var n=this;"object"==typeof e&&(this.addEnumValueCompletions(e,t,r),this.addDefaultValueCompletions(e,t,r),this.collectTypes(e,o),Array.isArray(e.allOf)&&e.allOf.forEach((function(e){return n.addSchemaValueCompletions(e,t,r,o)})),Array.isArray(e.anyOf)&&e.anyOf.forEach((function(e){return n.addSchemaValueCompletions(e,t,r,o)})),Array.isArray(e.oneOf)&&e.oneOf.forEach((function(e){return n.addSchemaValueCompletions(e,t,r,o)})))},e.prototype.addDefaultValueCompletions=function(e,t,r,o){var n=this;void 0===o&&(o=0);var i=!1;if(isDefined(e.default)){for(var a=e.type,s=e.default,p=o;p>0;p--)s=[s],a="array";r.add({kind:this.getSuggestionKind(a),label:this.getLabelForValue(s),insertText:this.getInsertTextForValue(s,t),insertTextFormat:InsertTextFormat.Snippet,detail:localize("json.suggest.default","Default value")}),i=!0}Array.isArray(e.examples)&&e.examples.forEach((function(a){for(var s=e.type,p=a,l=o;l>0;l--)p=[p],s="array";r.add({kind:n.getSuggestionKind(s),label:n.getLabelForValue(p),insertText:n.getInsertTextForValue(p,t),insertTextFormat:InsertTextFormat.Snippet}),i=!0})),Array.isArray(e.defaultSnippets)&&e.defaultSnippets.forEach((function(a){var s,p,l=e.type,u=a.body,c=a.label;if(isDefined(u)){e.type;for(var d=o;d>0;d--)u=[u],"array";s=n.getInsertTextForSnippetValue(u,t),p=n.getFilterTextForSnippetValue(u),c=c||n.getLabelForSnippetValue(u)}else{if("string"!=typeof a.bodyText)return;var m="",f="",g="";for(d=o;d>0;d--)m=m+g+"[\n",f=f+"\n"+g+"]",g+="\t",l="array";s=m+g+a.bodyText.split("\n").join("\n"+g)+f+t,c=c||s,p=s.replace(/[\n]/g,"")}r.add({kind:n.getSuggestionKind(l),label:c,documentation:n.fromMarkup(a.markdownDescription)||a.description,insertText:s,insertTextFormat:InsertTextFormat.Snippet,filterText:p}),i=!0})),!i&&"object"==typeof e.items&&!Array.isArray(e.items)&&o<5&&this.addDefaultValueCompletions(e.items,t,r,o+1)},e.prototype.addEnumValueCompletions=function(e,t,r){if(isDefined(e.const)&&r.add({kind:this.getSuggestionKind(e.type),label:this.getLabelForValue(e.const),insertText:this.getInsertTextForValue(e.const,t),insertTextFormat:InsertTextFormat.Snippet,documentation:this.fromMarkup(e.markdownDescription)||e.description}),Array.isArray(e.enum))for(var o=0,n=e.enum.length;o<n;o++){var i=e.enum[o],a=this.fromMarkup(e.markdownDescription)||e.description;e.markdownEnumDescriptions&&o<e.markdownEnumDescriptions.length&&this.doesSupportMarkdown()?a=this.fromMarkup(e.markdownEnumDescriptions[o]):e.enumDescriptions&&o<e.enumDescriptions.length&&(a=e.enumDescriptions[o]),r.add({kind:this.getSuggestionKind(e.type),label:this.getLabelForValue(i),insertText:this.getInsertTextForValue(i,t),insertTextFormat:InsertTextFormat.Snippet,documentation:a})}},e.prototype.collectTypes=function(e,t){if(!Array.isArray(e.enum)&&!isDefined(e.const)){var r=e.type;Array.isArray(r)?r.forEach((function(e){return t[e]=!0})):r&&(t[r]=!0)}},e.prototype.addFillerValueCompletions=function(e,t,r){e.object&&r.add({kind:this.getSuggestionKind("object"),label:"{}",insertText:this.getInsertTextForGuessedValue({},t),insertTextFormat:InsertTextFormat.Snippet,detail:localize("defaults.object","New object"),documentation:""}),e.array&&r.add({kind:this.getSuggestionKind("array"),label:"[]",insertText:this.getInsertTextForGuessedValue([],t),insertTextFormat:InsertTextFormat.Snippet,detail:localize("defaults.array","New array"),documentation:""})},e.prototype.addBooleanValueCompletion=function(e,t,r){r.add({kind:this.getSuggestionKind("boolean"),label:e?"true":"false",insertText:this.getInsertTextForValue(e,t),insertTextFormat:InsertTextFormat.Snippet,documentation:""})},e.prototype.addNullValueCompletion=function(e,t){t.add({kind:this.getSuggestionKind("null"),label:"null",insertText:"null"+e,insertTextFormat:InsertTextFormat.Snippet,documentation:""})},e.prototype.addDollarSchemaCompletions=function(e,t){var r=this;this.schemaService.getRegisteredSchemaIds((function(e){return"http"===e||"https"===e})).forEach((function(o){return t.add({kind:CompletionItemKind.Module,label:r.getLabelForValue(o),filterText:r.getFilterTextForValue(o),insertText:r.getInsertTextForValue(o,e),insertTextFormat:InsertTextFormat.Snippet,documentation:""})}))},e.prototype.getLabelForValue=function(e){return JSON.stringify(e)},e.prototype.getFilterTextForValue=function(e){return JSON.stringify(e)},e.prototype.getFilterTextForSnippetValue=function(e){return JSON.stringify(e).replace(/\$\{\d+:([^}]+)\}|\$\d+/g,"$1")},e.prototype.getLabelForSnippetValue=function(e){return JSON.stringify(e).replace(/\$\{\d+:([^}]+)\}|\$\d+/g,"$1")},e.prototype.getInsertTextForPlainText=function(e){return e.replace(/[\\\$\}]/g,"\\$&")},e.prototype.getInsertTextForValue=function(e,t){var r=JSON.stringify(e,null,"\t");return"{}"===r?"{$1}"+t:"[]"===r?"[$1]"+t:this.getInsertTextForPlainText(r+t)},e.prototype.getInsertTextForSnippetValue=function(e,t){return stringifyObject(e,"",(function(e){return"string"==typeof e&&"^"===e[0]?e.substr(1):JSON.stringify(e)}))+t},e.prototype.getInsertTextForGuessedValue=function(e,t){switch(typeof e){case"object":return null===e?"${1:null}"+t:this.getInsertTextForValue(e,t);case"string":var r=JSON.stringify(e);return r=r.substr(1,r.length-2),'"${1:'+(r=this.getInsertTextForPlainText(r))+'}"'+t;case"number":case"boolean":return"${1:"+JSON.stringify(e)+"}"+t}return this.getInsertTextForValue(e,t)},e.prototype.getSuggestionKind=function(e){if(Array.isArray(e)){var t=e;e=t.length>0?t[0]:void 0}if(!e)return CompletionItemKind.Value;switch(e){case"string":return CompletionItemKind.Value;case"object":return CompletionItemKind.Module;case"property":return CompletionItemKind.Property;default:return CompletionItemKind.Value}},e.prototype.getLabelTextForMatchingNode=function(e,t){switch(e.type){case"array":return"[]";case"object":return"{}";default:return t.getText().substr(e.offset,e.length)}},e.prototype.getInsertTextForMatchingNode=function(e,t,r){switch(e.type){case"array":return this.getInsertTextForValue([],r);case"object":return this.getInsertTextForValue({},r);default:var o=t.getText().substr(e.offset,e.length)+r;return this.getInsertTextForPlainText(o)}},e.prototype.getInsertTextForProperty=function(e,t,r,o){var n=this.getInsertTextForValue(e,"");if(!r)return n;var i,a=n+": ",s=0;if(t){if(Array.isArray(t.defaultSnippets)){if(1===t.defaultSnippets.length){var p=t.defaultSnippets[0].body;isDefined(p)&&(i=this.getInsertTextForSnippetValue(p,""))}s+=t.defaultSnippets.length}if(t.enum&&(i||1!==t.enum.length||(i=this.getInsertTextForGuessedValue(t.enum[0],"")),s+=t.enum.length),isDefined(t.default)&&(i||(i=this.getInsertTextForGuessedValue(t.default,"")),s++),Array.isArray(t.examples)&&t.examples.length&&(i||(i=this.getInsertTextForGuessedValue(t.examples[0],"")),s+=t.examples.length),0===s){var l=Array.isArray(t.type)?t.type[0]:t.type;switch(l||(t.properties?l="object":t.items&&(l="array")),l){case"boolean":i="$1";break;case"string":i='"$1"';break;case"object":i="{$1}";break;case"array":i="[$1]";break;case"number":case"integer":i="${1:0}";break;case"null":i="${1:null}";break;default:return n}}}return(!i||s>1)&&(i="$1"),a+i+o},e.prototype.getCurrentWord=function(e,t){for(var r=t-1,o=e.getText();r>=0&&-1===' \t\n\r\v":{[,]}'.indexOf(o.charAt(r));)r--;return o.substring(r+1,t)},e.prototype.evaluateSeparatorAfter=function(e,t){var r=Json.createScanner(e.getText(),!0);switch(r.setPosition(t),r.scan()){case 5:case 2:case 4:case 17:return"";default:return","}},e.prototype.findItemAtOffset=function(e,t,r){for(var o=Json.createScanner(t.getText(),!0),n=e.items,i=n.length-1;i>=0;i--){var a=n[i];if(r>a.offset+a.length)return o.setPosition(a.offset+a.length),5===o.scan()&&r>=o.getTokenOffset()+o.getTokenLength()?i+1:i;if(r>=a.offset)return i}return 0},e.prototype.isInComment=function(e,t,r){var o=Json.createScanner(e.getText(),!1);o.setPosition(t);for(var n=o.scan();17!==n&&o.getTokenOffset()+o.getTokenLength()<r;)n=o.scan();return(12===n||13===n)&&o.getTokenOffset()<=r},e.prototype.fromMarkup=function(e){if(e&&this.doesSupportMarkdown())return{kind:MarkupKind.Markdown,value:e}},e.prototype.doesSupportMarkdown=function(){if(!isDefined(this.supportsMarkdown)){var e=this.clientCapabilities.textDocument&&this.clientCapabilities.textDocument.completion;this.supportsMarkdown=e&&e.completionItem&&Array.isArray(e.completionItem.documentationFormat)&&-1!==e.completionItem.documentationFormat.indexOf(MarkupKind.Markdown)}return this.supportsMarkdown},e.prototype.doesSupportsCommitCharacters=function(){if(!isDefined(this.supportsCommitCharacters)){var e=this.clientCapabilities.textDocument&&this.clientCapabilities.textDocument.completion;this.supportsCommitCharacters=e&&e.completionItem&&!!e.completionItem.commitCharactersSupport}return this.supportsCommitCharacters},e}();export{JSONCompletion};
//# sourceMappingURL=/sm/7dc1c5a7c67a660ba239831b0bde658049eec28e46a4b8191e60a0a9b44205fb.map