/**
 * Minified by jsDelivr using Terser v5.7.1.
 * Original file: /npm/monaco-editor@0.27.0/esm/vs/language/json/_deps/vscode-json-languageservice/services/jsonValidation.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{UnresolvedSchema}from"./jsonSchemaService.js";import{ErrorCode,Diagnostic,DiagnosticSeverity,Range}from"../jsonLanguageTypes.js";import*as nls from"./../../../fillers/vscode-nls.js";import{isBoolean}from"../utils/objects.js";var localize=nls.loadMessageBundle(),JSONValidation=function(){function e(e,o){this.jsonSchemaService=e,this.promise=o,this.validationEnabled=!0}return e.prototype.configure=function(e){e&&(this.validationEnabled=!1!==e.validate,this.commentSeverity=e.allowComments?void 0:DiagnosticSeverity.Error)},e.prototype.doValidation=function(e,o,i,r){var t=this;if(!this.validationEnabled)return this.promise.resolve([]);var a=[],n={},s=function(e){var o=e.range.start.line+" "+e.range.start.character+" "+e.message;n[o]||(n[o]=!0,a.push(e))},l=function(r){var n=(null==i?void 0:i.trailingCommas)?toDiagnosticSeverity(i.trailingCommas):DiagnosticSeverity.Error,l=(null==i?void 0:i.comments)?toDiagnosticSeverity(i.comments):t.commentSeverity,m=(null==i?void 0:i.schemaValidation)?toDiagnosticSeverity(i.schemaValidation):DiagnosticSeverity.Warning,c=(null==i?void 0:i.schemaRequest)?toDiagnosticSeverity(i.schemaRequest):DiagnosticSeverity.Warning;if(r){if(r.errors.length&&o.root&&c){var v=o.root,f="object"===v.type?v.properties[0]:void 0;if(f&&"$schema"===f.keyNode.value){var u=f.valueNode||f,g=Range.create(e.positionAt(u.offset),e.positionAt(u.offset+u.length));s(Diagnostic.create(g,r.errors[0],c,ErrorCode.SchemaResolveError))}else{g=Range.create(e.positionAt(v.offset),e.positionAt(v.offset+1));s(Diagnostic.create(g,r.errors[0],c,ErrorCode.SchemaResolveError))}}else if(m){var h=o.validate(e,r.schema,m);h&&h.forEach(s)}schemaAllowsComments(r.schema)&&(l=void 0),schemaAllowsTrailingCommas(r.schema)&&(n=void 0)}for(var d=0,S=o.syntaxErrors;d<S.length;d++){var C=S[d];if(C.code===ErrorCode.TrailingComma){if("number"!=typeof n)continue;C.severity=n}s(C)}if("number"==typeof l){var p=localize("InvalidCommentToken","Comments are not permitted in JSON.");o.comments.forEach((function(e){s(Diagnostic.create(e,p,l,ErrorCode.CommentNotPermitted))}))}return a};if(r){var m=r.id||"schemaservice://untitled/"+idCounter++;return this.jsonSchemaService.resolveSchemaContent(new UnresolvedSchema(r),m,{}).then((function(e){return l(e)}))}return this.jsonSchemaService.getSchemaForResource(e.uri,o).then((function(e){return l(e)}))},e}();export{JSONValidation};var idCounter=0;function schemaAllowsComments(e){if(e&&"object"==typeof e){if(isBoolean(e.allowComments))return e.allowComments;if(e.allOf)for(var o=0,i=e.allOf;o<i.length;o++){var r=schemaAllowsComments(i[o]);if(isBoolean(r))return r}}}function schemaAllowsTrailingCommas(e){if(e&&"object"==typeof e){if(isBoolean(e.allowTrailingCommas))return e.allowTrailingCommas;var o=e;if(isBoolean(o.allowsTrailingCommas))return o.allowsTrailingCommas;if(e.allOf)for(var i=0,r=e.allOf;i<r.length;i++){var t=schemaAllowsTrailingCommas(r[i]);if(isBoolean(t))return t}}}function toDiagnosticSeverity(e){switch(e){case"error":return DiagnosticSeverity.Error;case"warning":return DiagnosticSeverity.Warning;case"ignore":return}}
//# sourceMappingURL=/sm/80d18c69decd6d82f5b2495a64c29fb4edcf235b98b169d9376a9823a4fcb823.map