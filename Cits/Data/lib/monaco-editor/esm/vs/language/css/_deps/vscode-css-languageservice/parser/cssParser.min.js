/**
 * Minified by jsDelivr using Terser v5.7.1.
 * Original file: /npm/monaco-editor@0.27.0/esm/vs/language/css/_deps/vscode-css-languageservice/parser/cssParser.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";import{TokenType,Scanner}from"./cssScanner.js";import*as nodes from"./cssNodes.js";import{ParseError}from"./cssErrors.js";import*as languageFacts from"../languageFacts/facts.js";import{isDefined}from"../utils/objects.js";var Parser=function(){function e(e){void 0===e&&(e=new Scanner),this.keyframeRegex=/^@(\-(webkit|ms|moz|o)\-)?keyframes$/i,this.scanner=e,this.token={type:TokenType.EOF,offset:-1,len:0,text:""},this.prevToken=void 0}return e.prototype.peekIdent=function(e){return TokenType.Ident===this.token.type&&e.length===this.token.text.length&&e===this.token.text.toLowerCase()},e.prototype.peekKeyword=function(e){return TokenType.AtKeyword===this.token.type&&e.length===this.token.text.length&&e===this.token.text.toLowerCase()},e.prototype.peekDelim=function(e){return TokenType.Delim===this.token.type&&e===this.token.text},e.prototype.peek=function(e){return e===this.token.type},e.prototype.peekOne=function(e){return-1!==e.indexOf(this.token.type)},e.prototype.peekRegExp=function(e,t){return e===this.token.type&&t.test(this.token.text)},e.prototype.hasWhitespace=function(){return!!this.prevToken&&this.prevToken.offset+this.prevToken.len!==this.token.offset},e.prototype.consumeToken=function(){this.prevToken=this.token,this.token=this.scanner.scan()},e.prototype.mark=function(){return{prev:this.prevToken,curr:this.token,pos:this.scanner.pos()}},e.prototype.restoreAtMark=function(e){this.prevToken=e.prev,this.token=e.curr,this.scanner.goBackTo(e.pos)},e.prototype.try=function(e){var t=this.mark(),r=e();return r||(this.restoreAtMark(t),null)},e.prototype.acceptOneKeyword=function(e){if(TokenType.AtKeyword===this.token.type)for(var t=0,r=e;t<r.length;t++){var i=r[t];if(i.length===this.token.text.length&&i===this.token.text.toLowerCase())return this.consumeToken(),!0}return!1},e.prototype.accept=function(e){return e===this.token.type&&(this.consumeToken(),!0)},e.prototype.acceptIdent=function(e){return!!this.peekIdent(e)&&(this.consumeToken(),!0)},e.prototype.acceptKeyword=function(e){return!!this.peekKeyword(e)&&(this.consumeToken(),!0)},e.prototype.acceptDelim=function(e){return!!this.peekDelim(e)&&(this.consumeToken(),!0)},e.prototype.acceptRegexp=function(e){return!!e.test(this.token.text)&&(this.consumeToken(),!0)},e.prototype._parseRegexp=function(e){var t=this.createNode(nodes.NodeType.Identifier);do{}while(this.acceptRegexp(e));return this.finish(t)},e.prototype.acceptUnquotedString=function(){var e=this.scanner.pos();this.scanner.goBackTo(this.token.offset);var t=this.scanner.scanUnquotedString();return t?(this.token=t,this.consumeToken(),!0):(this.scanner.goBackTo(e),!1)},e.prototype.resync=function(e,t){for(;;){if(e&&-1!==e.indexOf(this.token.type))return this.consumeToken(),!0;if(t&&-1!==t.indexOf(this.token.type))return!0;if(this.token.type===TokenType.EOF)return!1;this.token=this.scanner.scan()}},e.prototype.createNode=function(e){return new nodes.Node(this.token.offset,this.token.len,e)},e.prototype.create=function(e){return new e(this.token.offset,this.token.len)},e.prototype.finish=function(e,t,r,i){if(!(e instanceof nodes.Nodelist)&&(t&&this.markError(e,t,r,i),this.prevToken)){var s=this.prevToken.offset+this.prevToken.len;e.length=s>e.offset?s-e.offset:0}return e},e.prototype.markError=function(e,t,r,i){this.token!==this.lastErrorToken&&(e.addIssue(new nodes.Marker(e,t,nodes.Level.Error,void 0,this.token.offset,this.token.len)),this.lastErrorToken=this.token),(r||i)&&this.resync(r,i)},e.prototype.parseStylesheet=function(e){var t=e.version,r=e.getText();return this.internalParse(r,this._parseStylesheet,(function(i,s){if(e.version!==t)throw new Error("Underlying model has changed, AST is no longer valid");return r.substr(i,s)}))},e.prototype.internalParse=function(e,t,r){this.scanner.setSource(e),this.token=this.scanner.scan();var i=t.bind(this)();return i&&(i.textProvider=r||function(t,r){return e.substr(t,r)}),i},e.prototype._parseStylesheet=function(){for(var e=this.create(nodes.Stylesheet);e.addChild(this._parseStylesheetStart()););var t=!1;do{var r=!1;do{r=!1;var i=this._parseStylesheetStatement();for(i&&(e.addChild(i),r=!0,t=!1,this.peek(TokenType.EOF)||!this._needsSemicolonAfter(i)||this.accept(TokenType.SemiColon)||this.markError(e,ParseError.SemiColonExpected));this.accept(TokenType.SemiColon)||this.accept(TokenType.CDO)||this.accept(TokenType.CDC);)r=!0,t=!1}while(r);if(this.peek(TokenType.EOF))break;t||(this.peek(TokenType.AtKeyword)?this.markError(e,ParseError.UnknownAtRule):this.markError(e,ParseError.RuleOrSelectorExpected),t=!0),this.consumeToken()}while(!this.peek(TokenType.EOF));return this.finish(e)},e.prototype._parseStylesheetStart=function(){return this._parseCharset()},e.prototype._parseStylesheetStatement=function(e){return void 0===e&&(e=!1),this.peek(TokenType.AtKeyword)?this._parseStylesheetAtStatement(e):this._parseRuleset(e)},e.prototype._parseStylesheetAtStatement=function(e){return void 0===e&&(e=!1),this._parseImport()||this._parseMedia(e)||this._parsePage()||this._parseFontFace()||this._parseKeyframe()||this._parseSupports(e)||this._parseViewPort()||this._parseNamespace()||this._parseDocument()||this._parseUnknownAtRule()},e.prototype._tryParseRuleset=function(e){var t=this.mark();if(this._parseSelector(e)){for(;this.accept(TokenType.Comma)&&this._parseSelector(e););if(this.accept(TokenType.CurlyL))return this.restoreAtMark(t),this._parseRuleset(e)}return this.restoreAtMark(t),null},e.prototype._parseRuleset=function(e){void 0===e&&(e=!1);var t=this.create(nodes.RuleSet),r=t.getSelectors();if(!r.addChild(this._parseSelector(e)))return null;for(;this.accept(TokenType.Comma);)if(!r.addChild(this._parseSelector(e)))return this.finish(t,ParseError.SelectorExpected);return this._parseBody(t,this._parseRuleSetDeclaration.bind(this))},e.prototype._parseRuleSetDeclarationAtStatement=function(){return this._parseUnknownAtRule()},e.prototype._parseRuleSetDeclaration=function(){return this.peek(TokenType.AtKeyword)?this._parseRuleSetDeclarationAtStatement():this._parseDeclaration()},e.prototype._needsSemicolonAfter=function(e){switch(e.type){case nodes.NodeType.Keyframe:case nodes.NodeType.ViewPort:case nodes.NodeType.Media:case nodes.NodeType.Ruleset:case nodes.NodeType.Namespace:case nodes.NodeType.If:case nodes.NodeType.For:case nodes.NodeType.Each:case nodes.NodeType.While:case nodes.NodeType.MixinDeclaration:case nodes.NodeType.FunctionDeclaration:case nodes.NodeType.MixinContentDeclaration:return!1;case nodes.NodeType.ExtendsReference:case nodes.NodeType.MixinContentReference:case nodes.NodeType.ReturnStatement:case nodes.NodeType.MediaQuery:case nodes.NodeType.Debug:case nodes.NodeType.Import:case nodes.NodeType.AtApplyRule:case nodes.NodeType.CustomPropertyDeclaration:return!0;case nodes.NodeType.VariableDeclaration:return e.needsSemicolon;case nodes.NodeType.MixinReference:return!e.getContent();case nodes.NodeType.Declaration:return!e.getNestedProperties()}return!1},e.prototype._parseDeclarations=function(e){var t=this.create(nodes.Declarations);if(!this.accept(TokenType.CurlyL))return null;for(var r=e();t.addChild(r)&&!this.peek(TokenType.CurlyR);){if(this._needsSemicolonAfter(r)&&!this.accept(TokenType.SemiColon))return this.finish(t,ParseError.SemiColonExpected,[TokenType.SemiColon,TokenType.CurlyR]);for(r&&this.prevToken&&this.prevToken.type===TokenType.SemiColon&&(r.semicolonPosition=this.prevToken.offset);this.accept(TokenType.SemiColon););r=e()}return this.accept(TokenType.CurlyR)?this.finish(t):this.finish(t,ParseError.RightCurlyExpected,[TokenType.CurlyR,TokenType.SemiColon])},e.prototype._parseBody=function(e,t){return e.setDeclarations(this._parseDeclarations(t))?this.finish(e):this.finish(e,ParseError.LeftCurlyExpected,[TokenType.CurlyR,TokenType.SemiColon])},e.prototype._parseSelector=function(e){var t=this.create(nodes.Selector),r=!1;for(e&&(r=t.addChild(this._parseCombinator()));t.addChild(this._parseSimpleSelector());)r=!0,t.addChild(this._parseCombinator());return r?this.finish(t):null},e.prototype._parseDeclaration=function(e){var t=this._tryParseCustomPropertyDeclaration(e);if(t)return t;var r=this.create(nodes.Declaration);return r.setProperty(this._parseProperty())?this.accept(TokenType.Colon)?(this.prevToken&&(r.colonPosition=this.prevToken.offset),r.setValue(this._parseExpr())?(r.addChild(this._parsePrio()),this.peek(TokenType.SemiColon)&&(r.semicolonPosition=this.token.offset),this.finish(r)):this.finish(r,ParseError.PropertyValueExpected)):this.finish(r,ParseError.ColonExpected,[TokenType.Colon],e||[TokenType.SemiColon]):null},e.prototype._tryParseCustomPropertyDeclaration=function(e){if(!this.peekRegExp(TokenType.Ident,/^--/))return null;var t=this.create(nodes.CustomPropertyDeclaration);if(!t.setProperty(this._parseProperty()))return null;if(!this.accept(TokenType.Colon))return this.finish(t,ParseError.ColonExpected,[TokenType.Colon]);this.prevToken&&(t.colonPosition=this.prevToken.offset);var r=this.mark();if(this.peek(TokenType.CurlyL)){var i=this.create(nodes.CustomPropertySet),s=this._parseDeclarations(this._parseRuleSetDeclaration.bind(this));if(i.setDeclarations(s)&&!s.isErroneous(!0)&&(i.addChild(this._parsePrio()),this.peek(TokenType.SemiColon)))return this.finish(i),t.setPropertySet(i),t.semicolonPosition=this.token.offset,this.finish(t);this.restoreAtMark(r)}var n=this._parseExpr();return n&&!n.isErroneous(!0)&&(this._parsePrio(),this.peekOne(e||[TokenType.SemiColon]))?(t.setValue(n),t.semicolonPosition=this.token.offset,this.finish(t)):(this.restoreAtMark(r),t.addChild(this._parseCustomPropertyValue(e)),t.addChild(this._parsePrio()),isDefined(t.colonPosition)&&this.token.offset===t.colonPosition+1?this.finish(t,ParseError.PropertyValueExpected):this.finish(t))},e.prototype._parseCustomPropertyValue=function(e){var t=this;void 0===e&&(e=[TokenType.CurlyR]);var r=this.create(nodes.Node),i=function(){return 0===n&&0===o&&0===a},s=function(){return-1!==e.indexOf(t.token.type)},n=0,o=0,a=0;e:for(;;){switch(this.token.type){case TokenType.SemiColon:case TokenType.Exclamation:if(i())break e;break;case TokenType.CurlyL:n++;break;case TokenType.CurlyR:if(--n<0){if(s()&&0===o&&0===a)break e;return this.finish(r,ParseError.LeftCurlyExpected)}break;case TokenType.ParenthesisL:o++;break;case TokenType.ParenthesisR:if(--o<0){if(s()&&0===a&&0===n)break e;return this.finish(r,ParseError.LeftParenthesisExpected)}break;case TokenType.BracketL:a++;break;case TokenType.BracketR:if(--a<0)return this.finish(r,ParseError.LeftSquareBracketExpected);break;case TokenType.BadString:break e;case TokenType.EOF:var p=ParseError.RightCurlyExpected;return a>0?p=ParseError.RightSquareBracketExpected:o>0&&(p=ParseError.RightParenthesisExpected),this.finish(r,p)}this.consumeToken()}return this.finish(r)},e.prototype._tryToParseDeclaration=function(e){var t=this.mark();return this._parseProperty()&&this.accept(TokenType.Colon)?(this.restoreAtMark(t),this._parseDeclaration(e)):(this.restoreAtMark(t),null)},e.prototype._parseProperty=function(){var e=this.create(nodes.Property),t=this.mark();return(this.acceptDelim("*")||this.acceptDelim("_"))&&this.hasWhitespace()?(this.restoreAtMark(t),null):e.setIdentifier(this._parsePropertyIdentifier())?this.finish(e):null},e.prototype._parsePropertyIdentifier=function(){return this._parseIdent()},e.prototype._parseCharset=function(){if(!this.peek(TokenType.Charset))return null;var e=this.create(nodes.Node);return this.consumeToken(),this.accept(TokenType.String)?this.accept(TokenType.SemiColon)?this.finish(e):this.finish(e,ParseError.SemiColonExpected):this.finish(e,ParseError.IdentifierExpected)},e.prototype._parseImport=function(){if(!this.peekKeyword("@import"))return null;var e=this.create(nodes.Import);return this.consumeToken(),e.addChild(this._parseURILiteral())||e.addChild(this._parseStringLiteral())?(this.peek(TokenType.SemiColon)||this.peek(TokenType.EOF)||e.setMedialist(this._parseMediaQueryList()),this.finish(e)):this.finish(e,ParseError.URIOrStringExpected)},e.prototype._parseNamespace=function(){if(!this.peekKeyword("@namespace"))return null;var e=this.create(nodes.Namespace);return this.consumeToken(),e.addChild(this._parseURILiteral())||(e.addChild(this._parseIdent()),e.addChild(this._parseURILiteral())||e.addChild(this._parseStringLiteral()))?this.accept(TokenType.SemiColon)?this.finish(e):this.finish(e,ParseError.SemiColonExpected):this.finish(e,ParseError.URIExpected,[TokenType.SemiColon])},e.prototype._parseFontFace=function(){if(!this.peekKeyword("@font-face"))return null;var e=this.create(nodes.FontFace);return this.consumeToken(),this._parseBody(e,this._parseRuleSetDeclaration.bind(this))},e.prototype._parseViewPort=function(){if(!this.peekKeyword("@-ms-viewport")&&!this.peekKeyword("@-o-viewport")&&!this.peekKeyword("@viewport"))return null;var e=this.create(nodes.ViewPort);return this.consumeToken(),this._parseBody(e,this._parseRuleSetDeclaration.bind(this))},e.prototype._parseKeyframe=function(){if(!this.peekRegExp(TokenType.AtKeyword,this.keyframeRegex))return null;var e=this.create(nodes.Keyframe),t=this.create(nodes.Node);return this.consumeToken(),e.setKeyword(this.finish(t)),t.matches("@-ms-keyframes")&&this.markError(t,ParseError.UnknownKeyword),e.setIdentifier(this._parseKeyframeIdent())?this._parseBody(e,this._parseKeyframeSelector.bind(this)):this.finish(e,ParseError.IdentifierExpected,[TokenType.CurlyR])},e.prototype._parseKeyframeIdent=function(){return this._parseIdent([nodes.ReferenceType.Keyframe])},e.prototype._parseKeyframeSelector=function(){var e=this.create(nodes.KeyframeSelector);if(!e.addChild(this._parseIdent())&&!this.accept(TokenType.Percentage))return null;for(;this.accept(TokenType.Comma);)if(!e.addChild(this._parseIdent())&&!this.accept(TokenType.Percentage))return this.finish(e,ParseError.PercentageExpected);return this._parseBody(e,this._parseRuleSetDeclaration.bind(this))},e.prototype._tryParseKeyframeSelector=function(){var e=this.create(nodes.KeyframeSelector),t=this.mark();if(!e.addChild(this._parseIdent())&&!this.accept(TokenType.Percentage))return null;for(;this.accept(TokenType.Comma);)if(!e.addChild(this._parseIdent())&&!this.accept(TokenType.Percentage))return this.restoreAtMark(t),null;return this.peek(TokenType.CurlyL)?this._parseBody(e,this._parseRuleSetDeclaration.bind(this)):(this.restoreAtMark(t),null)},e.prototype._parseSupports=function(e){if(void 0===e&&(e=!1),!this.peekKeyword("@supports"))return null;var t=this.create(nodes.Supports);return this.consumeToken(),t.addChild(this._parseSupportsCondition()),this._parseBody(t,this._parseSupportsDeclaration.bind(this,e))},e.prototype._parseSupportsDeclaration=function(e){return void 0===e&&(e=!1),e?this._tryParseRuleset(!0)||this._tryToParseDeclaration()||this._parseStylesheetStatement(!0):this._parseStylesheetStatement(!1)},e.prototype._parseSupportsCondition=function(){var e=this.create(nodes.SupportsCondition);if(this.acceptIdent("not"))e.addChild(this._parseSupportsConditionInParens());else if(e.addChild(this._parseSupportsConditionInParens()),this.peekRegExp(TokenType.Ident,/^(and|or)$/i))for(var t=this.token.text.toLowerCase();this.acceptIdent(t);)e.addChild(this._parseSupportsConditionInParens());return this.finish(e)},e.prototype._parseSupportsConditionInParens=function(){var e=this.create(nodes.SupportsCondition);if(this.accept(TokenType.ParenthesisL))return this.prevToken&&(e.lParent=this.prevToken.offset),e.addChild(this._tryToParseDeclaration([TokenType.ParenthesisR]))||this._parseSupportsCondition()?this.accept(TokenType.ParenthesisR)?(this.prevToken&&(e.rParent=this.prevToken.offset),this.finish(e)):this.finish(e,ParseError.RightParenthesisExpected,[TokenType.ParenthesisR],[]):this.finish(e,ParseError.ConditionExpected);if(this.peek(TokenType.Ident)){var t=this.mark();if(this.consumeToken(),!this.hasWhitespace()&&this.accept(TokenType.ParenthesisL)){for(var r=1;this.token.type!==TokenType.EOF&&0!==r;)this.token.type===TokenType.ParenthesisL?r++:this.token.type===TokenType.ParenthesisR&&r--,this.consumeToken();return this.finish(e)}this.restoreAtMark(t)}return this.finish(e,ParseError.LeftParenthesisExpected,[],[TokenType.ParenthesisL])},e.prototype._parseMediaDeclaration=function(e){return void 0===e&&(e=!1),e?this._tryParseRuleset(!0)||this._tryToParseDeclaration()||this._parseStylesheetStatement(!0):this._parseStylesheetStatement(!1)},e.prototype._parseMedia=function(e){if(void 0===e&&(e=!1),!this.peekKeyword("@media"))return null;var t=this.create(nodes.Media);return this.consumeToken(),t.addChild(this._parseMediaQueryList())?this._parseBody(t,this._parseMediaDeclaration.bind(this,e)):this.finish(t,ParseError.MediaQueryExpected)},e.prototype._parseMediaQueryList=function(){var e=this.create(nodes.Medialist);if(!e.addChild(this._parseMediaQuery([TokenType.CurlyL])))return this.finish(e,ParseError.MediaQueryExpected);for(;this.accept(TokenType.Comma);)if(!e.addChild(this._parseMediaQuery([TokenType.CurlyL])))return this.finish(e,ParseError.MediaQueryExpected);return this.finish(e)},e.prototype._parseMediaQuery=function(e){var t=this.create(nodes.MediaQuery),r=!0,i=!1;if(!this.peek(TokenType.ParenthesisL)){if(this.acceptIdent("only")||this.acceptIdent("not"),!t.addChild(this._parseIdent()))return null;i=!0,r=this.acceptIdent("and")}for(;r;)if(t.addChild(this._parseMediaContentStart()))r=this.acceptIdent("and");else{if(!this.accept(TokenType.ParenthesisL))return i?this.finish(t,ParseError.LeftParenthesisExpected,[],e):null;if(!t.addChild(this._parseMediaFeatureName()))return this.finish(t,ParseError.IdentifierExpected,[],e);if(this.accept(TokenType.Colon)&&!t.addChild(this._parseExpr()))return this.finish(t,ParseError.TermExpected,[],e);if(!this.accept(TokenType.ParenthesisR))return this.finish(t,ParseError.RightParenthesisExpected,[],e);r=this.acceptIdent("and")}return this.finish(t)},e.prototype._parseMediaContentStart=function(){return null},e.prototype._parseMediaFeatureName=function(){return this._parseIdent()},e.prototype._parseMedium=function(){var e=this.create(nodes.Node);return e.addChild(this._parseIdent())?this.finish(e):null},e.prototype._parsePageDeclaration=function(){return this._parsePageMarginBox()||this._parseRuleSetDeclaration()},e.prototype._parsePage=function(){if(!this.peekKeyword("@page"))return null;var e=this.create(nodes.Page);if(this.consumeToken(),e.addChild(this._parsePageSelector()))for(;this.accept(TokenType.Comma);)if(!e.addChild(this._parsePageSelector()))return this.finish(e,ParseError.IdentifierExpected);return this._parseBody(e,this._parsePageDeclaration.bind(this))},e.prototype._parsePageMarginBox=function(){if(!this.peek(TokenType.AtKeyword))return null;var e=this.create(nodes.PageBoxMarginBox);return this.acceptOneKeyword(languageFacts.pageBoxDirectives)||this.markError(e,ParseError.UnknownAtRule,[],[TokenType.CurlyL]),this._parseBody(e,this._parseRuleSetDeclaration.bind(this))},e.prototype._parsePageSelector=function(){if(!this.peek(TokenType.Ident)&&!this.peek(TokenType.Colon))return null;var e=this.create(nodes.Node);return e.addChild(this._parseIdent()),this.accept(TokenType.Colon)&&!e.addChild(this._parseIdent())?this.finish(e,ParseError.IdentifierExpected):this.finish(e)},e.prototype._parseDocument=function(){if(!this.peekKeyword("@-moz-document"))return null;var e=this.create(nodes.Document);return this.consumeToken(),this.resync([],[TokenType.CurlyL]),this._parseBody(e,this._parseStylesheetStatement.bind(this))},e.prototype._parseUnknownAtRule=function(){if(!this.peek(TokenType.AtKeyword))return null;var e=this.create(nodes.UnknownAtRule);e.addChild(this._parseUnknownAtRuleName());var t=0,r=0,i=0,s=0;e:for(;;){switch(this.token.type){case TokenType.SemiColon:if(0===r&&0===i&&0===s)break e;break;case TokenType.EOF:return r>0?this.finish(e,ParseError.RightCurlyExpected):s>0?this.finish(e,ParseError.RightSquareBracketExpected):i>0?this.finish(e,ParseError.RightParenthesisExpected):this.finish(e);case TokenType.CurlyL:t++,r++;break;case TokenType.CurlyR:if(r--,t>0&&0===r){if(this.consumeToken(),s>0)return this.finish(e,ParseError.RightSquareBracketExpected);if(i>0)return this.finish(e,ParseError.RightParenthesisExpected);break e}if(r<0){if(0===i&&0===s)break e;return this.finish(e,ParseError.LeftCurlyExpected)}break;case TokenType.ParenthesisL:i++;break;case TokenType.ParenthesisR:if(--i<0)return this.finish(e,ParseError.LeftParenthesisExpected);break;case TokenType.BracketL:s++;break;case TokenType.BracketR:if(--s<0)return this.finish(e,ParseError.LeftSquareBracketExpected)}this.consumeToken()}return e},e.prototype._parseUnknownAtRuleName=function(){var e=this.create(nodes.Node);return this.accept(TokenType.AtKeyword)?this.finish(e):e},e.prototype._parseOperator=function(){if(this.peekDelim("/")||this.peekDelim("*")||this.peekDelim("+")||this.peekDelim("-")||this.peek(TokenType.Dashmatch)||this.peek(TokenType.Includes)||this.peek(TokenType.SubstringOperator)||this.peek(TokenType.PrefixOperator)||this.peek(TokenType.SuffixOperator)||this.peekDelim("=")){var e=this.createNode(nodes.NodeType.Operator);return this.consumeToken(),this.finish(e)}return null},e.prototype._parseUnaryOperator=function(){if(!this.peekDelim("+")&&!this.peekDelim("-"))return null;var e=this.create(nodes.Node);return this.consumeToken(),this.finish(e)},e.prototype._parseCombinator=function(){if(this.peekDelim(">")){var e=this.create(nodes.Node);this.consumeToken();var t=this.mark();if(!this.hasWhitespace()&&this.acceptDelim(">")){if(!this.hasWhitespace()&&this.acceptDelim(">"))return e.type=nodes.NodeType.SelectorCombinatorShadowPiercingDescendant,this.finish(e);this.restoreAtMark(t)}return e.type=nodes.NodeType.SelectorCombinatorParent,this.finish(e)}if(this.peekDelim("+")){e=this.create(nodes.Node);return this.consumeToken(),e.type=nodes.NodeType.SelectorCombinatorSibling,this.finish(e)}if(this.peekDelim("~")){e=this.create(nodes.Node);return this.consumeToken(),e.type=nodes.NodeType.SelectorCombinatorAllSiblings,this.finish(e)}if(this.peekDelim("/")){e=this.create(nodes.Node);this.consumeToken();t=this.mark();if(!this.hasWhitespace()&&this.acceptIdent("deep")&&!this.hasWhitespace()&&this.acceptDelim("/"))return e.type=nodes.NodeType.SelectorCombinatorShadowPiercingDescendant,this.finish(e);this.restoreAtMark(t)}return null},e.prototype._parseSimpleSelector=function(){var e=this.create(nodes.SimpleSelector),t=0;for(e.addChild(this._parseElementName())&&t++;(0===t||!this.hasWhitespace())&&e.addChild(this._parseSimpleSelectorBody());)t++;return t>0?this.finish(e):null},e.prototype._parseSimpleSelectorBody=function(){return this._parsePseudo()||this._parseHash()||this._parseClass()||this._parseAttrib()},e.prototype._parseSelectorIdent=function(){return this._parseIdent()},e.prototype._parseHash=function(){if(!this.peek(TokenType.Hash)&&!this.peekDelim("#"))return null;var e=this.createNode(nodes.NodeType.IdentifierSelector);if(this.acceptDelim("#")){if(this.hasWhitespace()||!e.addChild(this._parseSelectorIdent()))return this.finish(e,ParseError.IdentifierExpected)}else this.consumeToken();return this.finish(e)},e.prototype._parseClass=function(){if(!this.peekDelim("."))return null;var e=this.createNode(nodes.NodeType.ClassSelector);return this.consumeToken(),this.hasWhitespace()||!e.addChild(this._parseSelectorIdent())?this.finish(e,ParseError.IdentifierExpected):this.finish(e)},e.prototype._parseElementName=function(){var e=this.mark(),t=this.createNode(nodes.NodeType.ElementNameSelector);return t.addChild(this._parseNamespacePrefix()),t.addChild(this._parseSelectorIdent())||this.acceptDelim("*")?this.finish(t):(this.restoreAtMark(e),null)},e.prototype._parseNamespacePrefix=function(){var e=this.mark(),t=this.createNode(nodes.NodeType.NamespacePrefix);return!t.addChild(this._parseIdent())&&this.acceptDelim("*"),this.acceptDelim("|")?this.finish(t):(this.restoreAtMark(e),null)},e.prototype._parseAttrib=function(){if(!this.peek(TokenType.BracketL))return null;var e=this.create(nodes.AttributeSelector);return this.consumeToken(),e.setNamespacePrefix(this._parseNamespacePrefix()),e.setIdentifier(this._parseIdent())?(e.setOperator(this._parseOperator())&&(e.setValue(this._parseBinaryExpr()),this.acceptIdent("i")),this.accept(TokenType.BracketR)?this.finish(e):this.finish(e,ParseError.RightSquareBracketExpected)):this.finish(e,ParseError.IdentifierExpected)},e.prototype._parsePseudo=function(){var e=this,t=this._tryParsePseudoIdentifier();if(t){if(!this.hasWhitespace()&&this.accept(TokenType.ParenthesisL)){if(t.addChild(this.try((function(){var t=e.create(nodes.Node);if(!t.addChild(e._parseSelector(!1)))return null;for(;e.accept(TokenType.Comma)&&t.addChild(e._parseSelector(!1)););return e.peek(TokenType.ParenthesisR)?e.finish(t):null}))||this._parseBinaryExpr()),!this.accept(TokenType.ParenthesisR))return this.finish(t,ParseError.RightParenthesisExpected)}return this.finish(t)}return null},e.prototype._tryParsePseudoIdentifier=function(){if(!this.peek(TokenType.Colon))return null;var e=this.mark(),t=this.createNode(nodes.NodeType.PseudoSelector);return this.consumeToken(),this.hasWhitespace()?(this.restoreAtMark(e),null):(this.accept(TokenType.Colon),this.hasWhitespace()||!t.addChild(this._parseIdent())?this.finish(t,ParseError.IdentifierExpected):this.finish(t))},e.prototype._tryParsePrio=function(){var e=this.mark(),t=this._parsePrio();return t||(this.restoreAtMark(e),null)},e.prototype._parsePrio=function(){if(!this.peek(TokenType.Exclamation))return null;var e=this.createNode(nodes.NodeType.Prio);return this.accept(TokenType.Exclamation)&&this.acceptIdent("important")?this.finish(e):null},e.prototype._parseExpr=function(e){void 0===e&&(e=!1);var t=this.create(nodes.Expression);if(!t.addChild(this._parseBinaryExpr()))return null;for(;;){if(this.peek(TokenType.Comma)){if(e)return this.finish(t);this.consumeToken()}if(!t.addChild(this._parseBinaryExpr()))break}return this.finish(t)},e.prototype._parseNamedLine=function(){if(!this.peek(TokenType.BracketL))return null;var e=this.createNode(nodes.NodeType.GridLine);for(this.consumeToken();e.addChild(this._parseIdent()););return this.accept(TokenType.BracketR)?this.finish(e):this.finish(e,ParseError.RightSquareBracketExpected)},e.prototype._parseBinaryExpr=function(e,t){var r=this.create(nodes.BinaryExpression);if(!r.setLeft(e||this._parseTerm()))return null;if(!r.setOperator(t||this._parseOperator()))return this.finish(r);if(!r.setRight(this._parseTerm()))return this.finish(r,ParseError.TermExpected);r=this.finish(r);var i=this._parseOperator();return i&&(r=this._parseBinaryExpr(r,i)),this.finish(r)},e.prototype._parseTerm=function(){var e=this.create(nodes.Term);return e.setOperator(this._parseUnaryOperator()),e.setExpression(this._parseTermExpression())?this.finish(e):null},e.prototype._parseTermExpression=function(){return this._parseURILiteral()||this._parseFunction()||this._parseIdent()||this._parseStringLiteral()||this._parseNumeric()||this._parseHexColor()||this._parseOperation()||this._parseNamedLine()},e.prototype._parseOperation=function(){if(!this.peek(TokenType.ParenthesisL))return null;var e=this.create(nodes.Node);return this.consumeToken(),e.addChild(this._parseExpr()),this.accept(TokenType.ParenthesisR)?this.finish(e):this.finish(e,ParseError.RightParenthesisExpected)},e.prototype._parseNumeric=function(){if(this.peek(TokenType.Num)||this.peek(TokenType.Percentage)||this.peek(TokenType.Resolution)||this.peek(TokenType.Length)||this.peek(TokenType.EMS)||this.peek(TokenType.EXS)||this.peek(TokenType.Angle)||this.peek(TokenType.Time)||this.peek(TokenType.Dimension)||this.peek(TokenType.Freq)){var e=this.create(nodes.NumericValue);return this.consumeToken(),this.finish(e)}return null},e.prototype._parseStringLiteral=function(){if(!this.peek(TokenType.String)&&!this.peek(TokenType.BadString))return null;var e=this.createNode(nodes.NodeType.StringLiteral);return this.consumeToken(),this.finish(e)},e.prototype._parseURILiteral=function(){if(!this.peekRegExp(TokenType.Ident,/^url(-prefix)?$/i))return null;var e=this.mark(),t=this.createNode(nodes.NodeType.URILiteral);return this.accept(TokenType.Ident),this.hasWhitespace()||!this.peek(TokenType.ParenthesisL)?(this.restoreAtMark(e),null):(this.scanner.inURL=!0,this.consumeToken(),t.addChild(this._parseURLArgument()),this.scanner.inURL=!1,this.accept(TokenType.ParenthesisR)?this.finish(t):this.finish(t,ParseError.RightParenthesisExpected))},e.prototype._parseURLArgument=function(){var e=this.create(nodes.Node);return this.accept(TokenType.String)||this.accept(TokenType.BadString)||this.acceptUnquotedString()?this.finish(e):null},e.prototype._parseIdent=function(e){if(!this.peek(TokenType.Ident))return null;var t=this.create(nodes.Identifier);return e&&(t.referenceTypes=e),t.isCustomProperty=this.peekRegExp(TokenType.Ident,/^--/),this.consumeToken(),this.finish(t)},e.prototype._parseFunction=function(){var e=this.mark(),t=this.create(nodes.Function);if(!t.setIdentifier(this._parseFunctionIdentifier()))return null;if(this.hasWhitespace()||!this.accept(TokenType.ParenthesisL))return this.restoreAtMark(e),null;if(t.getArguments().addChild(this._parseFunctionArgument()))for(;this.accept(TokenType.Comma)&&!this.peek(TokenType.ParenthesisR);)t.getArguments().addChild(this._parseFunctionArgument())||this.markError(t,ParseError.ExpressionExpected);return this.accept(TokenType.ParenthesisR)?this.finish(t):this.finish(t,ParseError.RightParenthesisExpected)},e.prototype._parseFunctionIdentifier=function(){if(!this.peek(TokenType.Ident))return null;var e=this.create(nodes.Identifier);if(e.referenceTypes=[nodes.ReferenceType.Function],this.acceptIdent("progid")){if(this.accept(TokenType.Colon))for(;this.accept(TokenType.Ident)&&this.acceptDelim("."););return this.finish(e)}return this.consumeToken(),this.finish(e)},e.prototype._parseFunctionArgument=function(){var e=this.create(nodes.FunctionArgument);return e.setValue(this._parseExpr(!0))?this.finish(e):null},e.prototype._parseHexColor=function(){if(this.peekRegExp(TokenType.Hash,/^#([A-Fa-f0-9]{3}|[A-Fa-f0-9]{4}|[A-Fa-f0-9]{6}|[A-Fa-f0-9]{8})$/g)){var e=this.create(nodes.HexColorValue);return this.consumeToken(),this.finish(e)}return null},e}();export{Parser};
//# sourceMappingURL=/sm/dd419b19cf8eabd207cf6ad0aa9faaa27c62cfcf38e27a1d4ada68ae88106591.map