/**
 * Minified by jsDelivr using Terser v5.7.1.
 * Original file: /npm/monaco-editor@0.27.0/esm/vs/language/css/_deps/vscode-css-languageservice/services/lint.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";import*as nls from"./../../../fillers/vscode-nls.js";import*as languageFacts from"../languageFacts/facts.js";import*as nodes from"../parser/cssNodes.js";import{union}from"../utils/arrays.js";import{Rules,Settings}from"./lintRules.js";import calculateBoxModel,{Element}from"./lintUtil.js";var localize=nls.loadMessageBundle(),NodesByRootMap=function(){function e(){this.data={}}return e.prototype.add=function(e,t,r){var i=this.data[e];i||(i={nodes:[],names:[]},this.data[e]=i),i.names.push(t),r&&i.nodes.push(r)},e}(),LintVisitor=function(){function e(e,t,r){var i=this;this.cssDataManager=r,this.warnings=[],this.settings=t,this.documentText=e.getText(),this.keyframes=new NodesByRootMap,this.validProperties={};var n=t.getSetting(Settings.ValidProperties);Array.isArray(n)&&n.forEach((function(e){if("string"==typeof e){var t=e.trim().toLowerCase();t.length&&(i.validProperties[t]=!0)}}))}return e.entries=function(t,r,i,n,o){var a=new e(r,i,n);return t.acceptVisitor(a),a.completeValidations(),a.getEntries(o)},e.prototype.isValidPropertyDeclaration=function(e){var t=e.fullPropertyName;return this.validProperties[t]},e.prototype.fetch=function(e,t){for(var r=[],i=0,n=e;i<n.length;i++){var o=n[i];o.fullPropertyName===t&&r.push(o)}return r},e.prototype.fetchWithValue=function(e,t,r){for(var i=[],n=0,o=e;n<o.length;n++){var a=o[n];if(a.fullPropertyName===t){var s=a.node.getValue();s&&this.findValueInExpression(s,r)&&i.push(a)}}return i},e.prototype.findValueInExpression=function(e,t){var r=!1;return e.accept((function(e){return e.type===nodes.NodeType.Identifier&&e.matches(t)&&(r=!0),!r})),r},e.prototype.getEntries=function(e){return void 0===e&&(e=nodes.Level.Warning|nodes.Level.Error),this.warnings.filter((function(t){return 0!=(t.getLevel()&e)}))},e.prototype.addEntry=function(e,t,r){var i=new nodes.Marker(e,t,this.settings.getRule(t),r);this.warnings.push(i)},e.prototype.getMissingNames=function(e,t){for(var r=e.slice(0),i=0;i<t.length;i++){var n=r.indexOf(t[i]);-1!==n&&(r[n]=null)}var o=null;for(i=0;i<r.length;i++){var a=r[i];a&&(o=null===o?localize("namelist.single","'{0}'",a):localize("namelist.concatenated","{0}, '{1}'",o,a))}return o},e.prototype.visitNode=function(e){switch(e.type){case nodes.NodeType.UnknownAtRule:return this.visitUnknownAtRule(e);case nodes.NodeType.Keyframe:return this.visitKeyframe(e);case nodes.NodeType.FontFace:return this.visitFontFace(e);case nodes.NodeType.Ruleset:return this.visitRuleSet(e);case nodes.NodeType.SimpleSelector:return this.visitSimpleSelector(e);case nodes.NodeType.Function:return this.visitFunction(e);case nodes.NodeType.NumericValue:return this.visitNumericValue(e);case nodes.NodeType.Import:return this.visitImport(e);case nodes.NodeType.HexColorValue:return this.visitHexColorValue(e);case nodes.NodeType.Prio:return this.visitPrio(e);case nodes.NodeType.IdentifierSelector:return this.visitIdentifierSelector(e)}return!0},e.prototype.completeValidations=function(){this.validateKeyframes()},e.prototype.visitUnknownAtRule=function(e){var t=e.getChild(0);return!!t&&(!this.cssDataManager.getAtDirective(t.getText())&&(this.addEntry(t,Rules.UnknownAtRules,"Unknown at rule "+t.getText()),!0))},e.prototype.visitKeyframe=function(e){var t=e.getKeyword();if(!t)return!1;var r=t.getText();return this.keyframes.add(e.getName(),r,"@keyframes"!==r?t:null),!0},e.prototype.validateKeyframes=function(){var e=["@-webkit-keyframes","@-moz-keyframes","@-o-keyframes"];for(var t in this.keyframes.data){var r=this.keyframes.data[t].names,i=-1===r.indexOf("@keyframes");if(i||1!==r.length){var n=this.getMissingNames(e,r);if(n||i)for(var o=0,a=this.keyframes.data[t].nodes;o<a.length;o++){var s=a[o];if(i){var l=localize("keyframes.standardrule.missing","Always define standard rule '@keyframes' when defining keyframes.");this.addEntry(s,Rules.IncludeStandardPropertyWhenUsingVendorPrefix,l)}if(n){l=localize("keyframes.vendorspecific.missing","Always include all vendor specific rules: Missing: {0}",n);this.addEntry(s,Rules.AllVendorPrefixes,l)}}}}return!0},e.prototype.visitSimpleSelector=function(e){var t=this.documentText.charAt(e.offset);return 1===e.length&&"*"===t&&this.addEntry(e,Rules.UniversalSelector),!0},e.prototype.visitIdentifierSelector=function(e){return this.addEntry(e,Rules.AvoidIdSelector),!0},e.prototype.visitImport=function(e){return this.addEntry(e,Rules.ImportStatemement),!0},e.prototype.visitRuleSet=function(t){var r=t.getDeclarations();if(!r)return!1;r.hasChildren()||this.addEntry(t.getSelectors(),Rules.EmptyRuleSet);for(var i=[],n=0,o=r.getChildren();n<o.length;n++){(m=o[n])instanceof nodes.Declaration&&i.push(new Element(m))}var a=calculateBoxModel(i);if(a.width){var s=[];if(a.right.value&&(s=union(s,a.right.properties)),a.left.value&&(s=union(s,a.left.properties)),0!==s.length){for(var l=0,d=s;l<d.length;l++){var u=d[l];this.addEntry(u.node,Rules.BewareOfBoxModelSize)}this.addEntry(a.width.node,Rules.BewareOfBoxModelSize)}}if(a.height){s=[];if(a.top.value&&(s=union(s,a.top.properties)),a.bottom.value&&(s=union(s,a.bottom.properties)),0!==s.length){for(var p=0,f=s;p<f.length;p++){u=f[p];this.addEntry(u.node,Rules.BewareOfBoxModelSize)}this.addEntry(a.height.node,Rules.BewareOfBoxModelSize)}}var c=this.fetchWithValue(i,"display","inline-block");if(c.length>0)for(var h=this.fetch(i,"float"),y=0;y<h.length;y++){var g=h[y].node;(N=g.getValue())&&!N.matches("none")&&this.addEntry(g,Rules.PropertyIgnoredDueToDisplay,localize("rule.propertyIgnoredDueToDisplayInlineBlock","inline-block is ignored due to the float. If 'float' has a value other than 'none', the box is floated and 'display' is treated as 'block'"))}if((c=this.fetchWithValue(i,"display","block")).length>0)for(h=this.fetch(i,"vertical-align"),y=0;y<h.length;y++)this.addEntry(h[y].node,Rules.PropertyIgnoredDueToDisplay,localize("rule.propertyIgnoredDueToDisplayBlock","Property is ignored due to the display. With 'display: block', vertical-align should not be used."));var v=this.fetch(i,"float");for(y=0;y<v.length;y++){var m=v[y];this.isValidPropertyDeclaration(m)||this.addEntry(m.node,Rules.AvoidFloat)}for(var P=0;P<i.length;P++){var N;if("background"!==(m=i[P]).fullPropertyName&&!this.validProperties[m.fullPropertyName])if((N=m.node.getValue())&&"-"!==this.documentText.charAt(N.offset)){var R=this.fetch(i,m.fullPropertyName);if(R.length>1)for(var w=0;w<R.length;w++){var E=R[w].node.getValue();E&&"-"!==this.documentText.charAt(E.offset)&&R[w]!==m&&this.addEntry(m.node,Rules.DuplicateDeclarations)}}}if(!t.getSelectors().matches(":export")){for(var k=new NodesByRootMap,x=!1,S=0,V=i;S<V.length;S++){var D=(m=V[S]).node;if(this.isCSSDeclaration(D)){var T=m.fullPropertyName,I=T.charAt(0);if("-"===I){if("-"!==T.charAt(1)){this.cssDataManager.isKnownProperty(T)||this.validProperties[T]||this.addEntry(D.getProperty(),Rules.UnknownVendorSpecificProperty);var A=D.getNonPrefixedPropertyName();k.add(A,T,D.getProperty())}}else{var M=T;"*"!==I&&"_"!==I||(this.addEntry(D.getProperty(),Rules.IEStarHack),T=T.substr(1)),this.cssDataManager.isKnownProperty(M)||this.cssDataManager.isKnownProperty(T)||this.validProperties[T]||this.addEntry(D.getProperty(),Rules.UnknownProperty,localize("property.unknownproperty.detailed","Unknown property: '{0}'",D.getFullPropertyName())),k.add(T,T,null)}}else x=!0}if(!x)for(var F in k.data){var b=k.data[F],B=b.names,z=this.cssDataManager.isStandardProperty(F)&&-1===B.indexOf(F);if(z||1!==B.length){for(var C=[],U=(P=0,e.prefixes.length);P<U;P++){var L=e.prefixes[P];this.cssDataManager.isStandardProperty(L+F)&&C.push(L+F)}var K=this.getMissingNames(C,B);if(K||z)for(var O=0,W=b.nodes;O<W.length;O++){var j=W[O];if(z){var H=localize("property.standard.missing","Also define the standard property '{0}' for compatibility",F);this.addEntry(j,Rules.IncludeStandardPropertyWhenUsingVendorPrefix,H)}if(K){H=localize("property.vendorspecific.missing","Always include all vendor specific properties: Missing: {0}",K);this.addEntry(j,Rules.AllVendorPrefixes,H)}}}}}return!0},e.prototype.visitPrio=function(e){return this.addEntry(e,Rules.AvoidImportant),!0},e.prototype.visitNumericValue=function(e){var t=e.findParent(nodes.NodeType.Function);if(t&&"calc"===t.getName())return!0;var r=e.findParent(nodes.NodeType.Declaration);if(r&&r.getValue()){var i=e.getValue();if(!i.unit||-1===languageFacts.units.length.indexOf(i.unit.toLowerCase()))return!0;0===parseFloat(i.value)&&i.unit&&!this.validProperties[r.getFullPropertyName()]&&this.addEntry(e,Rules.ZeroWithUnit)}return!0},e.prototype.visitFontFace=function(e){var t=e.getDeclarations();if(!t)return!1;for(var r=!1,i=!1,n=!1,o=0,a=t.getChildren();o<a.length;o++){var s=a[o];if(this.isCSSDeclaration(s)){var l=s.getProperty().getName().toLowerCase();"src"===l&&(r=!0),"font-family"===l&&(i=!0)}else n=!0}return n||r&&i||this.addEntry(e,Rules.RequiredPropertiesForFontFace),!0},e.prototype.isCSSDeclaration=function(e){if(e instanceof nodes.Declaration){if(!e.getValue())return!1;var t=e.getProperty();if(!t)return!1;var r=t.getIdentifier();return!(!r||r.containsInterpolation())}return!1},e.prototype.visitHexColorValue=function(e){var t=e.length;return 9!==t&&7!==t&&5!==t&&4!==t&&this.addEntry(e,Rules.HexColorLength),!1},e.prototype.visitFunction=function(e){var t=e.getName().toLowerCase(),r=-1,i=0;switch(t){case"rgb(":case"hsl(":r=3;break;case"rgba(":case"hsla(":r=4}return-1!==r&&(e.getArguments().accept((function(e){return!(e instanceof nodes.BinaryExpression)||(i+=1,!1)})),i!==r&&this.addEntry(e,Rules.ArgsInColorFunction)),!0},e.prefixes=["-ms-","-moz-","-o-","-webkit-"],e}();export{LintVisitor};
//# sourceMappingURL=/sm/7eb8cdc1397f40fe3838036143cc336ab174d403f957ae1de7c056ad5bb0cce1.map